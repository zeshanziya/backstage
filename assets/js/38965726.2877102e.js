/*! For license information please see 38965726.2877102e.js.LICENSE.txt */
"use strict";(self.webpackChunkbackstage_microsite=self.webpackChunkbackstage_microsite||[]).push([[658449],{795511:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>c});var r=n(824246),s=n(511151);const i={id:"writing-templates",title:"Writing Templates",description:"Details around creating your own custom Software Templates"},a=void 0,o={id:"features/software-templates/writing-templates",title:"Writing Templates",description:"Details around creating your own custom Software Templates",source:"@site/../docs/features/software-templates/writing-templates.md",sourceDirName:"features/software-templates",slug:"/features/software-templates/writing-templates",permalink:"/docs/features/software-templates/writing-templates",draft:!1,unlisted:!1,editUrl:"https://github.com/backstage/backstage/edit/master/docs/../docs/features/software-templates/writing-templates.md",tags:[],version:"current",frontMatter:{id:"writing-templates",title:"Writing Templates",description:"Details around creating your own custom Software Templates"},sidebar:"docs",previous:{title:"Adding your own Templates",permalink:"/docs/features/software-templates/adding-templates"},next:{title:"Input Examples",permalink:"/docs/features/software-templates/input-examples"}},l={},c=[{value:"<code>spec.parameters</code> - <code>FormStep | FormStep[]</code>",id:"specparameters---formstep--formstep",level:2},{value:"Using Secrets",id:"using-secrets",level:3},{value:"Custom step layouts",id:"custom-step-layouts",level:3},{value:"Remove sections or fields based on feature flags",id:"remove-sections-or-fields-based-on-feature-flags",level:3},{value:"The Repository Picker",id:"the-repository-picker",level:3},{value:"Using the Users <code>oauth</code> token",id:"using-the-users-oauth-token",level:4},{value:"Accessing the signed-in users details",id:"accessing-the-signed-in-users-details",level:3},{value:"The Owner Picker",id:"the-owner-picker",level:3},{value:"<code>catalogFilter</code>",id:"catalogfilter",level:4},{value:"<code>spec.steps</code> - <code>Action[]</code>",id:"specsteps---action",level:2},{value:"Outputs",id:"outputs",level:2},{value:"The templating syntax",id:"the-templating-syntax",level:2},{value:"Built in Filters",id:"built-in-filters",level:2},{value:"parseRepoUrl",id:"parserepourl",level:3},{value:"parseEntityRef",id:"parseentityref",level:3},{value:"pick",id:"pick",level:3},{value:"projectSlug",id:"projectslug",level:3}];function d(e){const t=Object.assign({p:"p",strong:"strong",code:"code",pre:"pre",h2:"h2",a:"a",h3:"h3",h4:"h4",ul:"ul",li:"li",ol:"ol"},(0,s.ah)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(t.p,{children:["Templates are stored in the ",(0,r.jsx)(t.strong,{children:"Software Catalog"})," under a kind ",(0,r.jsx)(t.code,{children:"Template"}),". You\ncan create your own templates with a small ",(0,r.jsx)(t.code,{children:"yaml"})," definition which describes the\ntemplate and its metadata, along with some input variables that your template\nwill need, and then a list of actions which are then executed by the scaffolding\nservice."]}),"\n",(0,r.jsx)(t.p,{children:"Let's take a look at a simple example:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"# Notice the v1beta3 version\napiVersion: scaffolder.backstage.io/v1beta3\nkind: Template\n# some metadata about the template itself\nmetadata:\n  name: v1beta3-demo\n  title: Test Action template\n  description: scaffolder v1beta3 template demo\nspec:\n  owner: backstage/techdocs-core\n  type: service\n\n  # these are the steps which are rendered in the frontend with the form input\n  parameters:\n    - title: Fill in some steps\n      required:\n        - name\n      properties:\n        name:\n          title: Name\n          type: string\n          description: Unique name of the component\n          ui:autofocus: true\n          ui:options:\n            rows: 5\n        owner:\n          title: Owner\n          type: string\n          description: Owner of the component\n          ui:field: OwnerPicker\n          ui:options:\n            catalogFilter:\n              kind: Group\n    - title: Choose a location\n      required:\n        - repoUrl\n      properties:\n        repoUrl:\n          title: Repository Location\n          type: string\n          ui:field: RepoUrlPicker\n          ui:options:\n            allowedHosts:\n              - github.com\n\n  # here's the steps that are executed in series in the scaffolder backend\n  steps:\n    - id: fetch-base\n      name: Fetch Base\n      action: fetch:template\n      input:\n        url: ./template\n        values:\n          name: ${{ parameters.name }}\n          owner: ${{ parameters.owner }}\n\n    - id: fetch-docs\n      name: Fetch Docs\n      action: fetch:plain\n      input:\n        targetPath: ./community\n        url: https://github.com/backstage/community/tree/main/backstage-community-sessions\n\n    - id: publish\n      name: Publish\n      action: publish:github\n      input:\n        allowedHosts: ['github.com']\n        description: This is ${{ parameters.name }}\n        repoUrl: ${{ parameters.repoUrl }}\n\n    - id: register\n      name: Register\n      action: catalog:register\n      input:\n        repoContentsUrl: ${{ steps['publish'].output.repoContentsUrl }}\n        catalogInfoPath: '/catalog-info.yaml'\n\n  # some outputs which are saved along with the job for use in the frontend\n  output:\n    links:\n      - title: Repository\n        url: ${{ steps['publish'].output.remoteUrl }}\n      - title: Open in catalog\n        icon: catalog\n        entityRef: ${{ steps['register'].output.entityRef }}\n"})}),"\n",(0,r.jsx)(t.p,{children:"Let's dive in and pick apart what each of these sections do and what they are."}),"\n",(0,r.jsxs)(t.h2,{id:"specparameters---formstep--formstep",children:[(0,r.jsx)(t.code,{children:"spec.parameters"})," - ",(0,r.jsx)(t.code,{children:"FormStep | FormStep[]"})]}),"\n",(0,r.jsxs)(t.p,{children:["These ",(0,r.jsx)(t.code,{children:"parameters"})," are template variables which can be modified in the frontend\nas a sequence. It can either be one ",(0,r.jsx)(t.code,{children:"Step"})," if you just want one big list of\ndifferent fields in the frontend, or it can be broken up into multiple different\nsteps which would be rendered as different steps in the scaffolder plugin\nfrontend."]}),"\n",(0,r.jsxs)(t.p,{children:["Each ",(0,r.jsx)(t.code,{children:"Step"})," is ",(0,r.jsx)(t.code,{children:"JSONSchema"})," with some extra goodies for styling what it might\nlook like in the frontend. For these steps we rely very heavily on this\n",(0,r.jsx)(t.a,{href:"https://github.com/rjsf-team/react-jsonschema-form",children:"library"}),". They have some\n",(0,r.jsx)(t.a,{href:"https://rjsf-team.github.io/react-jsonschema-form/docs/",children:"great docs"})," and a\n",(0,r.jsx)(t.a,{href:"https://rjsf-team.github.io/react-jsonschema-form",children:"playground"})," where you can\nplay around with some examples."]}),"\n",(0,r.jsxs)(t.p,{children:["There's another option for that library called ",(0,r.jsx)(t.code,{children:"uiSchema"})," which we've taken\nadvantage of, and we've merged it with the existing ",(0,r.jsx)(t.code,{children:"JSONSchema"})," that you\nprovide to the library. These are the little ",(0,r.jsx)(t.code,{children:"ui:*"})," properties that you can see\nin the step definitions."]}),"\n",(0,r.jsxs)(t.p,{children:["For example if we take the ",(0,r.jsx)(t.strong,{children:"simple"})," example from the playground it looks like\nthis:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-json",children:'// jsonSchema:\n{\n  "title": "A registration form",\n  "description": "A simple form example.",\n  "type": "object",\n  "required": [\n    "firstName",\n    "lastName"\n  ],\n  "properties": {\n    "firstName": {\n      "type": "string",\n      "title": "First name",\n      "default": "Chuck"\n    },\n    "lastName": {\n      "type": "string",\n      "title": "Last name"\n    },\n    "nicknames":{\n      "type": "array",\n      "items": {\n        "type": "string"\n      }\n    },\n    "telephone": {\n      "type": "string",\n      "title": "Telephone",\n      "minLength": 10\n    }\n  }\n}\n\n// uiSchema:\n{\n  "firstName": {\n    "ui:autofocus": true,\n    "ui:emptyValue": "",\n    "ui:autocomplete": "given-name"\n  },\n  "lastName": {\n    "ui:emptyValue": "",\n    "ui:autocomplete": "family-name"\n  },\n  "nicknames": {\n    "ui:options":{\n      "orderable": false\n    }\n  },\n  "telephone": {\n    "ui:options": {\n      "inputType": "tel"\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(t.p,{children:"It would look something like the following in a template:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"apiVersion: scaffolder.backstage.io/v1beta3\nkind: Template\nmetadata:\n  name: v1beta3-demo\n  title: Test Action template\n  description: scaffolder v1beta3 template demo\nspec:\n  owner: backstage/techdocs-core\n  type: service\n\n  parameters:\n    - title: A registration form\n      description: A simple form example.\n      type: object\n      required:\n        - firstName\n        - lastName\n      properties:\n        firstName:\n          type: string\n          title: First name\n          default: Chuck\n          ui:autofocus: true\n          ui:emptyValue: ''\n          ui:autocomplete: given-name\n        lastName:\n          type: string\n          title: Last name\n          ui:emptyValue: ''\n          ui:autocomplete: family-name\n        nicknames:\n          type: array\n          items:\n            type: string\n          ui:options:\n            orderable: false\n        telephone:\n          type: string\n          title: Telephone\n          minLength: 10\n          ui:options:\n            inputType: tel\n"})}),"\n",(0,r.jsx)(t.h3,{id:"using-secrets",children:"Using Secrets"}),"\n",(0,r.jsxs)(t.p,{children:["You may want to mark things as secret and make sure that these values are protected and not available through REST endpoints. You can do this by using the built in ",(0,r.jsx)(t.code,{children:"ui:field: Secret"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["You can define this property as any normal parameter, however the consumption of this parameter will not be available through ",(0,r.jsx)(t.code,{children:"${{ parameters.myKey }}"})," you will instead need to use ",(0,r.jsx)(t.code,{children:"${{ secrets.myKey }}"})," in your ",(0,r.jsx)(t.code,{children:"template.yaml"}),"."]}),"\n",(0,r.jsx)(t.p,{children:"Parameters will be automatically masked in the review step."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"apiVersion: scaffolder.backstage.io/v1beta3\nkind: Template\nmetadata:\n  name: v1beta3-demo\n  title: Test Action template\n  description: scaffolder v1beta3 template demo\nspec:\n  owner: backstage/techdocs-core\n  type: service\n\n  parameters:\n    - title: Authenticaion\n      description: Provide authentication for the resource\n      required:\n        - username\n        - password\n      properties:\n        username:\n          type: string\n          # use the built in Secret field extension\n          ui:field: Secret\n        password:\n          type: string\n          ui:field: Secret\n\n  steps:\n    - id: setupAuthentication\n      action: auth:create\n      input:\n        # make sure to use ${{ secrets.parameterName }} to reference these values\n        username: ${{ secrets.username }}\n        password: ${{ secrets.password }}\n"})}),"\n",(0,r.jsx)(t.h3,{id:"custom-step-layouts",children:"Custom step layouts"}),"\n",(0,r.jsxs)(t.p,{children:["If you find that the default layout of the form used in a particular step does not meet your needs then you can supply your own ",(0,r.jsx)(t.a,{href:"/docs/features/software-templates/writing-custom-step-layouts",children:"custom step layout"}),"."]}),"\n",(0,r.jsx)(t.h3,{id:"remove-sections-or-fields-based-on-feature-flags",children:"Remove sections or fields based on feature flags"}),"\n",(0,r.jsx)(t.p,{children:"Based on feature flags you can hide sections or even only fields of your\ntemplate. This is a good use case if you want to test experimental parameters in\na production environment. To use it let's look at the following template:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"spec:\n  type: website\n  owner: team-a\n  parameters:\n    - name: Enter some stuff\n      description: Enter some stuff\n      backstage:featureFlag: experimental-feature\n      properties:\n        inputString:\n          type: string\n          title: string input test\n        inputObject:\n          type: object\n          title: object input test\n          description: a little nested thing never hurt anyone right?\n          properties:\n            first:\n              type: string\n              title: first\n              backstage:featureFlag: nested-experimental-feature\n            second:\n              type: number\n              title: second\n"})}),"\n",(0,r.jsxs)(t.p,{children:["If you have a feature flag ",(0,r.jsx)(t.code,{children:"experimental-feature"})," active then\nyour first step would be shown. The same goes for the nested properties in the\nspec. Make sure to use the key ",(0,r.jsx)(t.code,{children:"backstage:featureFlag"})," in your templates if\nyou want to use this functionality."]}),"\n",(0,r.jsx)(t.h3,{id:"the-repository-picker",children:"The Repository Picker"}),"\n",(0,r.jsxs)(t.p,{children:["In order to make working with repository providers easier, we've built a custom\npicker that can be used by overriding the ",(0,r.jsx)(t.code,{children:"ui:field"})," option in the ",(0,r.jsx)(t.code,{children:"uiSchema"}),"\nfor a ",(0,r.jsx)(t.code,{children:"string"})," field. Instead of displaying a text input block it will render\nour custom component that we've built which makes it easy to select a repository\nprovider, and insert a project or owner, and repository name."]}),"\n",(0,r.jsx)(t.p,{children:"You can see it in the above full example which is a separate step and it looks a\nlittle like this:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"- title: Choose a location\n  required:\n    - repoUrl\n  properties:\n    repoUrl:\n      title: Repository Location\n      type: string\n      ui:field: RepoUrlPicker\n      ui:options:\n        allowedHosts:\n          - github.com\n"})}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"allowedHosts"})," part should be set to where you wish to enable this template\nto publish to. And it can be any host that is listed in your ",(0,r.jsx)(t.code,{children:"integrations"}),"\nconfig in ",(0,r.jsx)(t.code,{children:"app-config.yaml"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["Besides specifying ",(0,r.jsx)(t.code,{children:"allowedHosts"})," you can also restrict the template to publish to\nrepositories owned by specific users/groups/namespaces by setting the ",(0,r.jsx)(t.code,{children:"allowedOwners"}),"\noption. With the ",(0,r.jsx)(t.code,{children:"allowedRepos"})," option you are able to narrow it down further to a\nspecific set of repository names. A full example could look like this:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"- title: Choose a location\n  required:\n    - repoUrl\n  properties:\n    repoUrl:\n      title: Repository Location\n      type: string\n      ui:field: RepoUrlPicker\n      ui:options:\n        allowedHosts:\n          - github.com\n        allowedOwners:\n          - backstage\n          - someGithubUser\n        allowedRepos:\n          - backstage\n"})}),"\n",(0,r.jsxs)(t.p,{children:["For a list of all possible ",(0,r.jsx)(t.code,{children:"ui:options"})," input props for ",(0,r.jsx)(t.code,{children:"RepoUrlPicker"}),", please visit ",(0,r.jsx)(t.a,{href:"/docs/features/software-templates/ui-options-examples#repourlpicker",children:"here"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"RepoUrlPicker"})," is a custom field that we provide part of the\n",(0,r.jsx)(t.code,{children:"plugin-scaffolder"}),". You can provide your own custom fields by\n",(0,r.jsx)(t.a,{href:"/docs/features/software-templates/writing-custom-field-extensions",children:"writing your own Custom Field Extensions"})]}),"\n",(0,r.jsxs)(t.h4,{id:"using-the-users-oauth-token",children:["Using the Users ",(0,r.jsx)(t.code,{children:"oauth"})," token"]}),"\n",(0,r.jsxs)(t.p,{children:["There's a little bit of extra magic that you get out of the box when using the\n",(0,r.jsx)(t.code,{children:"RepoUrlPicker"})," as a field input. You can provide some additional options under\n",(0,r.jsx)(t.code,{children:"ui:options"})," to allow the ",(0,r.jsx)(t.code,{children:"RepoUrlPicker"})," to grab an ",(0,r.jsx)(t.code,{children:"oauth"})," token for the user\nfor the required ",(0,r.jsx)(t.code,{children:"repository"}),"."]}),"\n",(0,r.jsx)(t.p,{children:"This is great for when you are wanting to create a new repository, or wanting to\nperform operations on top of an existing repository."}),"\n",(0,r.jsx)(t.p,{children:"A sample template that takes advantage of this is like so:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"apiVersion: scaffolder.backstage.io/v1beta3\nkind: Template\nmetadata:\n  name: v1beta3-demo\n  title: Test Action template\n  description: scaffolder v1beta3 template demo\nspec:\n  owner: backstage/techdocs-core\n  type: service\n\n  parameters:\n    ...\n\n    - title: Choose a location\n      required:\n        - repoUrl\n      properties:\n        repoUrl:\n          title: Repository Location\n          type: string\n          ui:field: RepoUrlPicker\n          ui:options:\n            # Here's the option you can pass to the RepoUrlPicker\n            requestUserCredentials:\n              secretsKey: USER_OAUTH_TOKEN\n              additionalScopes:\n                github:\n                  - workflow\n            allowedHosts:\n              - github.com\n    ...\n\n  steps:\n    ...\n\n    - id: publish\n      name: Publish\n      action: publish:github\n      input:\n        allowedHosts: ['github.com']\n        description: This is ${{ parameters.name }}\n        repoUrl: ${{ parameters.repoUrl }}\n        # here's where the secret can be used\n        token: ${{ secrets.USER_OAUTH_TOKEN }}\n\n    ...\n"})}),"\n",(0,r.jsxs)(t.p,{children:["You will see from above that there is an additional ",(0,r.jsx)(t.code,{children:"requestUserCredentials"}),"\nobject that is passed to the ",(0,r.jsx)(t.code,{children:"RepoUrlPicker"}),". This object defines what the\nreturned ",(0,r.jsx)(t.code,{children:"secret"})," should be stored as when accessing using\n",(0,r.jsx)(t.code,{children:"${{ secrets.secretName }}"}),", in this case it is ",(0,r.jsx)(t.code,{children:"USER_OAUTH_TOKEN"}),". And then you\nwill see that there is an additional ",(0,r.jsx)(t.code,{children:"input"})," field into the ",(0,r.jsx)(t.code,{children:"publish:github"}),"\naction called ",(0,r.jsx)(t.code,{children:"token"}),", in which you can use the ",(0,r.jsx)(t.code,{children:"secret"})," like so:\n",(0,r.jsx)(t.code,{children:"token: ${{ secrets.USER_OAUTH_TOKEN }}"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["There's also the ability to pass additional scopes when requesting the ",(0,r.jsx)(t.code,{children:"oauth"}),"\ntoken from the user, which you can do on a per-provider basis, in case your\ntemplate can be published to multiple providers."]}),"\n",(0,r.jsxs)(t.p,{children:["Note, that you will need to configure an ",(0,r.jsx)(t.a,{href:"/docs/auth/#configuring-authentication-providers",children:"authentication provider"}),", alongside the\n",(0,r.jsx)(t.a,{href:"/docs/auth/#scaffolder-configuration-software-templates",children:(0,r.jsx)(t.code,{children:"ScmAuthApi"})})," for your source code management (SCM) service to make this feature work."]}),"\n",(0,r.jsx)(t.h3,{id:"accessing-the-signed-in-users-details",children:"Accessing the signed-in users details"}),"\n",(0,r.jsxs)(t.p,{children:["Sometimes when authoring templates, you'll want to access the user that is running the template, and get details from the profile or the users ",(0,r.jsx)(t.code,{children:"Entity"})," in the Catalog."]}),"\n",(0,r.jsxs)(t.p,{children:["If you have enabled a sign in provider and have a ",(0,r.jsx)(t.a,{href:"/docs/auth/identity-resolver",children:"sign in resolver"})," that points to a user in the Catalog, then you can use the ",(0,r.jsx)(t.code,{children:"${{ user.entity }}"})," templating expression to access the raw entity from the Catalog."]}),"\n",(0,r.jsxs)(t.p,{children:["This can be particularly useful if you have processors setup in the Catalog to write ",(0,r.jsx)(t.code,{children:"spec.profile.email"})," of the ",(0,r.jsx)(t.code,{children:"User Entities"})," to reference them and pass them into actions like below:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"  steps:\n    action: publish:github\n    ...\n    input:\n        ...\n        gitAuthorName: ${{ user.entity.metadata.name }}\n        gitAuthorEmail: ${{ user.entity.spec.profile.email }}\n"})}),"\n",(0,r.jsxs)(t.p,{children:["You also have access to ",(0,r.jsx)(t.code,{children:"user.entity.metadata.annotations"})," too, so if you have some other additional information stored in there, you reference those too."]}),"\n",(0,r.jsx)(t.h3,{id:"the-owner-picker",children:"The Owner Picker"}),"\n",(0,r.jsxs)(t.p,{children:["When the scaffolder needs to add new components to the catalog, it needs to have\nan owner for them. Ideally, users should be able to select an owner when they go\nthrough the scaffolder form from the users and groups already known to\nBackstage. The ",(0,r.jsx)(t.code,{children:"OwnerPicker"})," is a custom field that generates a searchable list\nof groups and/or users already in the catalog to pick an owner from. You can\nspecify which of the two kinds (or both) are listed in the ",(0,r.jsx)(t.code,{children:"catalogFilter.kind"})," option:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"owner:\n  title: Owner\n  type: string\n  description: Owner of the component\n  ui:field: OwnerPicker\n  ui:options:\n    catalogFilter:\n      kind: [Group, User]\n"})}),"\n",(0,r.jsxs)(t.p,{children:["For a list of all possible ",(0,r.jsx)(t.code,{children:"ui:options"})," input props for ",(0,r.jsx)(t.code,{children:"OwnerPicker"}),", please visit ",(0,r.jsx)(t.a,{href:"/docs/features/software-templates/ui-options-examples#ownerpicker",children:"here"}),"."]}),"\n",(0,r.jsx)(t.h4,{id:"catalogfilter",children:(0,r.jsx)(t.code,{children:"catalogFilter"})}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"catalogFilter"})," allow you to filter the list entities using any of the ",(0,r.jsx)(t.a,{href:"https://backstage.io/docs/features/software-catalog/software-catalog-api#filtering",children:"catalog api filters"}),":"]}),"\n",(0,r.jsxs)(t.p,{children:["For example, if you want to show users in the ",(0,r.jsx)(t.code,{children:"default"})," namespace, and groups with the ",(0,r.jsx)(t.code,{children:"github.com/team-slug"})," annotation, you can do the following:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"catalogFilter:\n  - kind: [User]\n    metadata.namespace: default\n  - kind: [Group]\n    metadata.annotations.github.com/team-slug: { exists: true }\n"})}),"\n",(0,r.jsxs)(t.h2,{id:"specsteps---action",children:[(0,r.jsx)(t.code,{children:"spec.steps"})," - ",(0,r.jsx)(t.code,{children:"Action[]"})]}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"steps"})," is an array of the things that you want to happen part of this\ntemplate. These follow the same standard format:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"- id: fetch-base # A unique id for the step\n  name: Fetch Base # A title displayed in the frontend\n  if: ${{ parameters.name }} # Optional condition, skip the step if not truthy\n  each: ${{ parameters.iterable }} # Optional iterable, run the same step multiple times\n  action: fetch:template # An action to call\n  input: # Input that is passed as arguments to the action handler\n    url: ./template\n    values:\n      name: ${{ parameters.name }}\n"})}),"\n",(0,r.jsxs)(t.p,{children:["By default we ship some ",(0,r.jsx)(t.a,{href:"/docs/features/software-templates/builtin-actions",children:"built in actions"})," that you can\ntake a look at, or you can\n",(0,r.jsx)(t.a,{href:"/docs/features/software-templates/writing-custom-actions",children:"create your own custom actions"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["When ",(0,r.jsx)(t.code,{children:"each"})," is provided, the current iteration value is available in the ",(0,r.jsx)(t.code,{children:"${{ each }}"})," input."]}),"\n",(0,r.jsx)(t.p,{children:"Examples:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"each: ['apples', 'oranges']\ninput:\n  values:\n    fruit: ${{ each.value }}\n"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"each: [{ name: 'apple', count: 3 }, { name: 'orange', count: 1 }]\ninput:\n  values:\n    fruit: ${{ each.value.name }}\n    count: ${{ each.value.count }}\n"})}),"\n",(0,r.jsxs)(t.p,{children:["When ",(0,r.jsx)(t.code,{children:"each"})," is used, the outputs of a repeated step are returned as an array of outputs from each iteration."]}),"\n",(0,r.jsx)(t.h2,{id:"outputs",children:"Outputs"}),"\n",(0,r.jsx)(t.p,{children:"Each individual step can output some variables that can be used in the\nscaffolder frontend for after the job is finished. This is useful for things\nlike linking to the entity that has been created with the backend, linking\nto the created repository, or showing Markdown text blobs."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"output:\n  links:\n    - title: Repository\n      url: ${{ steps['publish'].output.remoteUrl }} # link to the remote repository\n    - title: Open in catalog\n      icon: catalog\n      entityRef: ${{ steps['register'].output.entityRef }} # link to the entity that has been ingested to the catalog\n  text:\n    - title: More information\n      content: |\n        **Entity URL:** `${{ steps['publish'].output.remoteUrl }}`\n"})}),"\n",(0,r.jsx)(t.h2,{id:"the-templating-syntax",children:"The templating syntax"}),"\n",(0,r.jsxs)(t.p,{children:["You might have noticed variables wrapped in ",(0,r.jsx)(t.code,{children:"${{ }}"})," in the examples. These are\ntemplate strings for linking and gluing the different parts of the template\ntogether. All the form inputs from the ",(0,r.jsx)(t.code,{children:"parameters"})," section will be available by\nusing this template syntax (for example, ",(0,r.jsx)(t.code,{children:"${{ parameters.firstName }}"})," inserts\nthe value of ",(0,r.jsx)(t.code,{children:"firstName"})," from the parameters). This is great for passing the\nvalues from the form into different steps and reusing these input variables.\nThese template strings preserve the type of the parameter."]}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"${{ parameters.firstName }}"})," pattern will work only in the template file.\nIf you want to start using values provided from the UI in your code, you will have to use\nthe ",(0,r.jsx)(t.code,{children:"${{ values.firstName }}"})," pattern. Additionally, you have to pass\nthe parameters from the UI to the input of the ",(0,r.jsx)(t.code,{children:"fetch:template"})," step."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"apiVersion: scaffolder.backstage.io/v1beta3\nkind: Template\nmetadata:\n  name: v1beta3-demo\n  title: Test Action\n  description: scaffolder v1beta3 template demo\nspec:\n  owner: backstage/techdocs-core\n  type: service\n  parameters:\n    - title: Fill in some steps\n      required:\n        - name\n      properties:\n        name:\n          title: Name\n          type: string\n          description: Unique name of your project\n        urlParameter:\n          title: URL endpoint\n          type: string\n          description: URL endpoint at which the component can be reached\n          default: 'https://www.example.com'\n        enabledDB:\n          title: Enable Database\n          type: boolean\n          default: false\n  ...\n  steps:\n    - id: fetch-base\n      name: Fetch Base\n      action: fetch:template\n      input:\n        url: ./template\n        values:\n          name: ${{ parameters.name }}\n          url: ${{ parameters.urlParameter }}\n          enabledDB: ${{ parameters.enabledDB }}\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Afterwards, if you are using the builtin templating action, you can start using\nthe variables in your code. You can use also any other templating functions from\n",(0,r.jsx)(t.a,{href:"https://mozilla.github.io/nunjucks/templating.html#tags",children:"Nunjucks"})," as well."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:'#!/bin/bash\necho "Hi my name is ${{ values.name }}, and you can fine me at ${{ values.url }}!"\n{% if values.enabledDB %}\necho "You have enabled your database!"\n{% endif %}\n'})}),"\n",(0,r.jsxs)(t.p,{children:["As you can see above in the ",(0,r.jsx)(t.code,{children:"Outputs"})," section, ",(0,r.jsx)(t.code,{children:"actions"})," and ",(0,r.jsx)(t.code,{children:"steps"})," can also\noutput things. You can grab that output using ",(0,r.jsx)(t.code,{children:"steps.$stepId.output.$property"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["You can read more about all the ",(0,r.jsx)(t.code,{children:"inputs"})," and ",(0,r.jsx)(t.code,{children:"outputs"})," defined in the actions in\ncode part of the ",(0,r.jsx)(t.code,{children:"JSONSchema"}),", or you can read more about our\n",(0,r.jsx)(t.a,{href:"/docs/features/software-templates/builtin-actions",children:"built in actions"}),"."]}),"\n",(0,r.jsx)(t.h2,{id:"built-in-filters",children:"Built in Filters"}),"\n",(0,r.jsx)(t.p,{children:"Template filters are functions that help you transform data, extract specific information,\nand perform various operations in Scaffolder Templates."}),"\n",(0,r.jsxs)(t.p,{children:["This section introduces the built-in filters provided by Backstage and offers examples of\nhow to use them in the Scaffolder templates. It's important to mention that Backstage also leverages the\nnative filters from the Nunjucks library. For a complete list of these native filters and their usage,\nrefer to the ",(0,r.jsx)(t.a,{href:"https://mozilla.github.io/nunjucks/templating.html#builtin-filters",children:"Nunjucks documentation"}),"."]}),"\n",(0,r.jsx)(t.h3,{id:"parserepourl",children:"parseRepoUrl"}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"parseRepoUrl"})," filter parse a repository URL into\nits components, such as ",(0,r.jsx)(t.code,{children:"owner"}),", repository ",(0,r.jsx)(t.code,{children:"name"}),", and more."]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"Usage Example:"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"- id: log\n  name: Parse Repo URL\n  action: debug:log\n  input:\n    extra: ${{ parameters.repoUrl | parseRepoUrl }}\n"})}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Input"}),": ",(0,r.jsx)(t.code,{children:"github.com?repo=backstage&org=backstage"})]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Output"}),": ",(0,r.jsx)(t.a,{href:"https://github.com/backstage/backstage/blob/v1.17.2/plugins/scaffolder-backend/src/scaffolder/actions/builtin/publish/util.ts#L39",children:"RepoSpec"})]}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"parseentityref",children:"parseEntityRef"}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"parseEntityRef"})," filter allows you to extract different parts of\nan entity reference, such as the ",(0,r.jsx)(t.code,{children:"kind"}),", ",(0,r.jsx)(t.code,{children:"namespace"}),", and ",(0,r.jsx)(t.code,{children:"name"}),"."]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"Usage example"})}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:"Without context"}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"- id: log\n  name: Parse Entity Reference\n  action: debug:log\n  input:\n    extra: ${{ parameters.owner | parseEntityRef }}\n"})}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Input"}),": ",(0,r.jsx)(t.code,{children:"group:techdocs"})]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Output"}),": ",(0,r.jsx)(t.a,{href:"https://github.com/backstage/backstage/blob/v1.17.2/packages/catalog-model/src/types.ts#L23",children:"CompoundEntityRef"})]}),"\n"]}),"\n",(0,r.jsxs)(t.ol,{start:"2",children:["\n",(0,r.jsx)(t.li,{children:"With context"}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:'- id: log\n  name: Parse Entity Reference\n  action: debug:log\n  input:\n    extra: ${{ parameters.owner | parseEntityRef({ defaultKind:"group", defaultNamespace:"another-namespace" }) }}\n'})}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Input"}),": ",(0,r.jsx)(t.code,{children:"techdocs"})]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Output"}),": ",(0,r.jsx)(t.a,{href:"https://github.com/backstage/backstage/blob/v1.17.2/packages/catalog-model/src/types.ts#L23",children:"CompoundEntityRef"})]}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"pick",children:"pick"}),"\n",(0,r.jsxs)(t.p,{children:["This ",(0,r.jsx)(t.code,{children:"pick"})," filter allows you to select specific properties from an object."]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"Usage Example"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"- id: log\n  name: Pick\n  action: debug:log\n  input:\n    extra: ${{ parameters.owner | parseEntityRef | pick('name') }}\n"})}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Input"}),": ",(0,r.jsx)(t.code,{children:"{ kind: 'Group', namespace: 'default', name: 'techdocs' }"})]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Output"}),": ",(0,r.jsx)(t.code,{children:"techdocs"})]}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"projectslug",children:"projectSlug"}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"projectSlug"})," filter generates a project slug from a repository URL"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"Usage Example"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"- id: log\n  name: Project Slug\n  action: debug:log\n  input:\n    extra: ${{ parameters.repoUrl | projectSlug }}\n"})}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Input"}),": ",(0,r.jsx)(t.code,{children:"github.com?repo=backstage&org=backstage"})]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Output"}),": ",(0,r.jsx)(t.code,{children:"backstage/backstage"})]}),"\n"]})]})}const u=function(e={}){const{wrapper:t}=Object.assign({},(0,s.ah)(),e.components);return t?(0,r.jsx)(t,Object.assign({},e,{children:(0,r.jsx)(d,e)})):d(e)}},371426:(e,t,n)=>{var r=n(827378),s=Symbol.for("react.element"),i=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,i={},c=null,d=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)a.call(t,r)&&!l.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:s,type:e,key:c,ref:d,props:i,_owner:o.current}}t.Fragment=i,t.jsx=c,t.jsxs=c},541535:(e,t)=>{var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),h=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}function x(){}function j(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},x.prototype=y.prototype;var b=j.prototype=new x;b.constructor=j,m(b,y.prototype),b.isPureReactComponent=!0;var w=Array.isArray,v=Object.prototype.hasOwnProperty,k={current:null},S={key:!0,ref:!0,__self:!0,__source:!0};function R(e,t,r){var s,i={},a=null,o=null;if(null!=t)for(s in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(a=""+t.key),t)v.call(t,s)&&!S.hasOwnProperty(s)&&(i[s]=t[s]);var l=arguments.length-2;if(1===l)i.children=r;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];i.children=c}if(e&&e.defaultProps)for(s in l=e.defaultProps)void 0===i[s]&&(i[s]=l[s]);return{$$typeof:n,type:e,key:a,ref:o,props:i,_owner:k.current}}function T(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}var U=/\/+/g;function _(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function $(e,t,s,i,a){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var l=!1;if(null===e)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case r:l=!0}}if(l)return a=a(l=e),e=""===i?"."+_(l,0):i,w(a)?(s="",null!=e&&(s=e.replace(U,"$&/")+"/"),$(a,t,s,"",(function(e){return e}))):null!=a&&(T(a)&&(a=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,s+(!a.key||l&&l.key===a.key?"":(""+a.key).replace(U,"$&/")+"/")+e)),t.push(a)),1;if(l=0,i=""===i?".":i+":",w(e))for(var c=0;c<e.length;c++){var d=i+_(o=e[c],c);l+=$(o,t,s,d,a)}else if(d=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=h&&e[h]||e["@@iterator"])?e:null}(e),"function"==typeof d)for(e=d.call(e),c=0;!(o=e.next()).done;)l+=$(o=o.value,t,s,d=i+_(o,c++),a);else if("object"===o)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function E(e,t,n){if(null==e)return e;var r=[],s=0;return $(e,r,"","",(function(e){return t.call(n,e,s++)})),r}function N(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var O={current:null},P={transition:null},C={ReactCurrentDispatcher:O,ReactCurrentBatchConfig:P,ReactCurrentOwner:k};t.Children={map:E,forEach:function(e,t,n){E(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return E(e,(function(){t++})),t},toArray:function(e){return E(e,(function(e){return e}))||[]},only:function(e){if(!T(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=y,t.Fragment=s,t.Profiler=a,t.PureComponent=j,t.StrictMode=i,t.Suspense=d,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=C,t.cloneElement=function(e,t,r){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var s=m({},e.props),i=e.key,a=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,o=k.current),void 0!==t.key&&(i=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)v.call(t,c)&&!S.hasOwnProperty(c)&&(s[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)s.children=r;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];s.children=l}return{$$typeof:n,type:e.type,key:i,ref:a,props:s,_owner:o}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=R,t.createFactory=function(e){var t=R.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=T,t.lazy=function(e){return{$$typeof:p,_payload:{_status:-1,_result:e},_init:N}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=P.transition;P.transition={};try{e()}finally{P.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return O.current.useCallback(e,t)},t.useContext=function(e){return O.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return O.current.useDeferredValue(e)},t.useEffect=function(e,t){return O.current.useEffect(e,t)},t.useId=function(){return O.current.useId()},t.useImperativeHandle=function(e,t,n){return O.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return O.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return O.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return O.current.useMemo(e,t)},t.useReducer=function(e,t,n){return O.current.useReducer(e,t,n)},t.useRef=function(e){return O.current.useRef(e)},t.useState=function(e){return O.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return O.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return O.current.useTransition()},t.version="18.2.0"},827378:(e,t,n)=>{e.exports=n(541535)},824246:(e,t,n)=>{e.exports=n(371426)},511151:(e,t,n)=>{n.d(t,{Zo:()=>o,ah:()=>i});var r=n(667294);const s=r.createContext({});function i(e){const t=r.useContext(s);return r.useMemo((()=>"function"==typeof e?e(t):{...t,...e}),[t,e])}const a={};function o({components:e,children:t,disableParentContext:n}){let o;return o=n?"function"==typeof e?e({}):e||a:i(e),r.createElement(s.Provider,{value:o},t)}}}]);