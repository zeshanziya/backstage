/*! For license information please see 874dee16.aabaa6a5.js.LICENSE.txt */
"use strict";(self.webpackChunkbackstage_microsite=self.webpackChunkbackstage_microsite||[]).push([[400367],{148722:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>a,toc:()=>l});var r=t(824246),i=t(511151);const o={id:"testing",title:"Frontend System Testing Plugins",sidebar_label:"Testing",description:"Testing plugins in the frontend system"},s="Testing Frontend Plugins",a={id:"frontend-system/building-plugins/testing",title:"Frontend System Testing Plugins",description:"Testing plugins in the frontend system",source:"@site/../docs/frontend-system/building-plugins/02-testing.md",sourceDirName:"frontend-system/building-plugins",slug:"/frontend-system/building-plugins/testing",permalink:"/docs/frontend-system/building-plugins/testing",draft:!1,unlisted:!1,editUrl:"https://github.com/backstage/backstage/edit/master/docs/../docs/frontend-system/building-plugins/02-testing.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{id:"testing",title:"Frontend System Testing Plugins",sidebar_label:"Testing",description:"Testing plugins in the frontend system"},sidebar:"docs",previous:{title:"Overview",permalink:"/docs/frontend-system/building-plugins/index"},next:{title:"Extension Types",permalink:"/docs/frontend-system/building-plugins/extension-types"}},c={},l=[{value:"Testing React components",id:"testing-react-components",level:2},{value:"Testing extensions",id:"testing-extensions",level:2},{value:"Single extension",id:"single-extension",level:3},{value:"Extension preset",id:"extension-preset",level:3},{value:"Mocking apis",id:"mocking-apis",level:3},{value:"Setting configuration",id:"setting-configuration",level:3},{value:"Missing something?",id:"missing-something",level:2}];function u(e){const n=Object.assign({blockquote:"blockquote",p:"p",strong:"strong",h1:"h1",code:"code",h2:"h2",pre:"pre",a:"a",h3:"h3"},(0,i.ah)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"NOTE: The new frontend system is in alpha and is only supported by a small number of plugins."})}),"\n"]}),"\n",(0,r.jsx)(n.h1,{id:"testing-frontend-plugins",children:"Testing Frontend Plugins"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"NOTE: The new frontend system is in alpha, and some plugins do not yet fully implement it."}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Utilities for testing frontend features and components are available in ",(0,r.jsx)(n.code,{children:"@backstage/frontend-test-utils"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"testing-react-components",children:"Testing React components"}),"\n",(0,r.jsx)(n.p,{children:"A component can be used for more than one extension, and it should be tested independently of an extension environment."}),"\n",(0,r.jsxs)(n.p,{children:["Use the ",(0,r.jsx)(n.code,{children:"renderInTestApp"})," helper to render a given component inside a Backstage test app:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"import React from 'react';\nimport { screen } from '@testing-library/react';\nimport { renderInTestApp } from '@backstage/frontend-test-utils';\nimport { EntityDetails } from './plugin';\n\ndescribe('Entity details component', () => {\n  it('should render the entity name and owner', async () => {\n    await renderInTestApp(<EntityDetails owner=\"tools\" name=\"test\" />);\n\n    await expect(\n      screen.findByText('The entity \"test\" is owned by \"tools\"'),\n    ).resolves.toBeInTheDocument();\n  });\n});\n"})}),"\n",(0,r.jsxs)(n.p,{children:["To mock ",(0,r.jsx)(n.a,{href:"/docs/frontend-system/architecture/utility-apis",children:"Utility APIs"})," that are used by your component you can use the ",(0,r.jsx)(n.code,{children:"TestApiProvider"})," to override individual API implementations. In the snippet below, we wrap the component within a ",(0,r.jsx)(n.code,{children:"TestApiProvider"})," in order to mock the catalog client API:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"import React from 'react';\nimport { screen } from '@testing-library/react';\nimport {\n  renderInTestApp,\n  TestApiProvider,\n} from '@backstage/frontend-test-utils';\nimport { stringifyEntityRef } from '@backstage/catalog-model';\nimport { CatalogApi, catalogApiRef } from '@backstage/plugin-catalog-react';\nimport { EntityDetails } from './plugin';\n\ndescribe('Entity details component', () => {\n  it('should render the entity name and owner', async () => {\n    const catalogApiMock = {\n      async getEntityFacets() {\n        return {\n          facets: {\n            'relations.ownedBy': [{ count: 1, value: 'group:default/tools' }],\n          },\n        },\n      }\n    } satisfies Partial<typeof catalogApiRef.T>;\n\n    const entityRef = stringifyEntityRef({\n      kind: 'Component',\n      namespace: 'default',\n      name: 'test',\n    });\n\n    await renderInTestApp(\n      <TestApiProvider apis={[[catalogApiRef, catalogApiMock]]}>\n        <EntityDetails entityRef={entityRef} />\n      </TestApiProvider>,\n    );\n\n    await expect(\n      screen.findByText('The entity \"test\" is owned by \"tools\"'),\n    ).resolves.toBeInTheDocument();\n  });\n});\n"})}),"\n",(0,r.jsx)(n.h2,{id:"testing-extensions",children:"Testing extensions"}),"\n",(0,r.jsxs)(n.p,{children:["To facilitate testing of frontend extensions, the ",(0,r.jsx)(n.code,{children:"@backstage/frontend-test-utils"})," package provides a tester class which starts up an entire frontend harness, complete with a number of default features. You can then provide overrides for extensions whose behavior you need to adjust for the test run."]}),"\n",(0,r.jsx)(n.p,{children:"A number of features (frontend extensions and overrides) are also accepted by the tester. Here are some examples of how these facilities can be useful:"}),"\n",(0,r.jsx)(n.h3,{id:"single-extension",children:"Single extension"}),"\n",(0,r.jsx)(n.p,{children:"In order to test an extension in isolation, you simply need to pass it into the tester factory, then call the render method on the returned instance:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"import { screen } from '@testing-library/react';\nimport { createExtensionTester } from '@backstage/frontend-test-utils';\nimport { indexPageExtension } from './plugin';\n\ndescribe('Index page', () => {\n  it('should render a the index page', () => {\n    createExtensionTester(indexPageExtension).render();\n\n    expect(screen.getByText('Index Page')).toBeInTheDocument();\n  });\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"extension-preset",children:"Extension preset"}),"\n",(0,r.jsx)(n.p,{children:"There are some extensions that rely on other extensions existence, such as a page that links to another page. In that case, you can add more than one extension to the preset of features you want to render in the test, as shown below:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"import { screen } from '@testing-library/react';\nimport userEvent from '@testing-library/user-event';\nimport { createExtensionTester } from '@backstage/frontend-test-utils';\nimport { indexPageExtension, detailsPageExtension } from './plugin';\n\ndescribe('Index page', async () => {\n  it('should link to the details page', () => {\n    createExtensionTester(indexPageExtension)\n      // Adding more extensions to the preset being tested\n      .add(detailsPageExtension)\n      .render();\n\n    await expect(screen.findByText('Index Page')).toBeInTheDocument();\n\n    await userEvent.click(screen.getByRole('link', { name: 'See details' }));\n\n    await expect(\n      screen.findByText('Details Page'),\n    ).resolves.toBeInTheDocument();\n  });\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"mocking-apis",children:"Mocking apis"}),"\n",(0,r.jsx)(n.p,{children:"If your extensions requires implementation of APIs that aren't wired up by default, you'll have to add overrides to the preset of features being tested:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"import { screen } from '@testing-library/react';\nimport userEvent from '@testing-library/user-event';\nimport { createApiFactory } from '@backestage/core-plugin-api';\nimport {\n  createExtensionOverrides,\n  configApiRef,\n  analyticsApiRef,\n} from '@backstage/frontend-plugin-api';\nimport {\n  createExtensionTester,\n  MockConfigApi,\n  MockAnalyticsApi,\n} from '@backstage/frontend-test-utils';\nimport { indexPageExtension } from './plugin';\n\ndescribe('Index page', () => {\n  it('should capture click events in analytics', async () => {\n    // Mocking the analytics api implementation\n    const analyticsApiMock = new MockAnalyticsApi();\n\n    const analyticsApiOverride = createApiExtension({\n      factory: createApiFactory({\n        api: analyticsApiRef,\n        factory: () => analyticsApiMock,\n      }),\n    });\n\n    createExtensionTester(indexPageExtension)\n      // Overriding the analytics api extension\n      .add(analyticsApiOverride)\n      .render();\n\n    await userEvent.click(\n      await screen.findByRole('link', { name: 'See details' }),\n    );\n\n    expect(analyticsApiMock.getEvents()[0]).toMatchObject({\n      action: 'click',\n      subject: 'See details',\n    });\n  });\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"setting-configuration",children:"Setting configuration"}),"\n",(0,r.jsx)(n.p,{children:"In the case that your extension can be configured, you can test this capability by passing configuration values as follows:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"import { screen } from '@testing-library/react';\nimport userEvent from '@testing-library/user-event';\nimport { createExtensionTester } from '@backstage/frontend-test-utils';\nimport { indexPageExtension, detailsPageExtension } from './plugin';\n\ndescribe('Index page', () => {\n  it('should accepts a custom title via config', async () => {\n    createExtensionTester(indexPageExtension, {\n      // Configuration specific of index page\n      config: { title: 'Custom index' },\n    })\n      .add(detailsExtensionPage, {\n        // Configuration specific of details page\n        config: { title: 'Custom details' },\n      })\n      .render({\n        // Configuration specific of the instance\n        config: {\n          app: {\n            title: 'Custom app',\n          },\n        },\n      });\n\n    await expect(\n      screen.findByRole('heading', { name: 'Custom app' }),\n    ).resolves.toBeInTheDocument();\n\n    await expect(\n      screen.findByRole('heading', { name: 'Custom index' }),\n    ).resolves.toBeInTheDocument();\n\n    await userEvent.click(screen.getByRole('link', { name: 'See details' }));\n\n    await expect(\n      screen.findByText('Custom details'),\n    ).resolves.toBeInTheDocument();\n  });\n});\n"})}),"\n",(0,r.jsx)(n.p,{children:"That's all for testing features!"}),"\n",(0,r.jsx)(n.h2,{id:"missing-something",children:"Missing something?"}),"\n",(0,r.jsx)(n.p,{children:"If there's anything else you think needs to be covered in the docs or that you think isn't covered by the test utilities, please create an issue in the Backstage repository. You are always welcome to contribute as well!"})]})}const d=function(e={}){const{wrapper:n}=Object.assign({},(0,i.ah)(),e.components);return n?(0,r.jsx)(n,Object.assign({},e,{children:(0,r.jsx)(u,e)})):u(e)}},371426:(e,n,t)=>{var r=t(827378),i=Symbol.for("react.element"),o=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,a=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function l(e,n,t){var r,o={},l=null,u=null;for(r in void 0!==t&&(l=""+t),void 0!==n.key&&(l=""+n.key),void 0!==n.ref&&(u=n.ref),n)s.call(n,r)&&!c.hasOwnProperty(r)&&(o[r]=n[r]);if(e&&e.defaultProps)for(r in n=e.defaultProps)void 0===o[r]&&(o[r]=n[r]);return{$$typeof:i,type:e,key:l,ref:u,props:o,_owner:a.current}}n.Fragment=o,n.jsx=l,n.jsxs=l},541535:(e,n)=>{var t=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),c=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),f=Symbol.iterator;var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,m={};function h(e,n,t){this.props=e,this.context=n,this.refs=m,this.updater=t||g}function x(){}function b(e,n,t){this.props=e,this.context=n,this.refs=m,this.updater=t||g}h.prototype.isReactComponent={},h.prototype.setState=function(e,n){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,n,"setState")},h.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},x.prototype=h.prototype;var v=b.prototype=new x;v.constructor=b,y(v,h.prototype),v.isPureReactComponent=!0;var k=Array.isArray,E=Object.prototype.hasOwnProperty,j={current:null},T={key:!0,ref:!0,__self:!0,__source:!0};function _(e,n,r){var i,o={},s=null,a=null;if(null!=n)for(i in void 0!==n.ref&&(a=n.ref),void 0!==n.key&&(s=""+n.key),n)E.call(n,i)&&!T.hasOwnProperty(i)&&(o[i]=n[i]);var c=arguments.length-2;if(1===c)o.children=r;else if(1<c){for(var l=Array(c),u=0;u<c;u++)l[u]=arguments[u+2];o.children=l}if(e&&e.defaultProps)for(i in c=e.defaultProps)void 0===o[i]&&(o[i]=c[i]);return{$$typeof:t,type:e,key:s,ref:a,props:o,_owner:j.current}}function w(e){return"object"==typeof e&&null!==e&&e.$$typeof===t}var P=/\/+/g;function S(e,n){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var n={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return n[e]}))}(""+e.key):n.toString(36)}function R(e,n,i,o,s){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var c=!1;if(null===e)c=!0;else switch(a){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case t:case r:c=!0}}if(c)return s=s(c=e),e=""===o?"."+S(c,0):o,k(s)?(i="",null!=e&&(i=e.replace(P,"$&/")+"/"),R(s,n,i,"",(function(e){return e}))):null!=s&&(w(s)&&(s=function(e,n){return{$$typeof:t,type:e.type,key:n,ref:e.ref,props:e.props,_owner:e._owner}}(s,i+(!s.key||c&&c.key===s.key?"":(""+s.key).replace(P,"$&/")+"/")+e)),n.push(s)),1;if(c=0,o=""===o?".":o+":",k(e))for(var l=0;l<e.length;l++){var u=o+S(a=e[l],l);c+=R(a,n,i,u,s)}else if(u=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"==typeof u)for(e=u.call(e),l=0;!(a=e.next()).done;)c+=R(a=a.value,n,i,u=o+S(a,l++),s);else if("object"===a)throw n=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===n?"object with keys {"+Object.keys(e).join(", ")+"}":n)+"). If you meant to render a collection of children, use an array instead.");return c}function A(e,n,t){if(null==e)return e;var r=[],i=0;return R(e,r,"","",(function(e){return n.call(t,e,i++)})),r}function I(e){if(-1===e._status){var n=e._result;(n=n()).then((function(n){0!==e._status&&-1!==e._status||(e._status=1,e._result=n)}),(function(n){0!==e._status&&-1!==e._status||(e._status=2,e._result=n)})),-1===e._status&&(e._status=0,e._result=n)}if(1===e._status)return e._result.default;throw e._result}var C={current:null},O={transition:null},B={ReactCurrentDispatcher:C,ReactCurrentBatchConfig:O,ReactCurrentOwner:j};n.Children={map:A,forEach:function(e,n,t){A(e,(function(){n.apply(this,arguments)}),t)},count:function(e){var n=0;return A(e,(function(){n++})),n},toArray:function(e){return A(e,(function(e){return e}))||[]},only:function(e){if(!w(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},n.Component=h,n.Fragment=i,n.Profiler=s,n.PureComponent=b,n.StrictMode=o,n.Suspense=u,n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=B,n.cloneElement=function(e,n,r){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=y({},e.props),o=e.key,s=e.ref,a=e._owner;if(null!=n){if(void 0!==n.ref&&(s=n.ref,a=j.current),void 0!==n.key&&(o=""+n.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(l in n)E.call(n,l)&&!T.hasOwnProperty(l)&&(i[l]=void 0===n[l]&&void 0!==c?c[l]:n[l])}var l=arguments.length-2;if(1===l)i.children=r;else if(1<l){c=Array(l);for(var u=0;u<l;u++)c[u]=arguments[u+2];i.children=c}return{$$typeof:t,type:e.type,key:o,ref:s,props:i,_owner:a}},n.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},n.createElement=_,n.createFactory=function(e){var n=_.bind(null,e);return n.type=e,n},n.createRef=function(){return{current:null}},n.forwardRef=function(e){return{$$typeof:l,render:e}},n.isValidElement=w,n.lazy=function(e){return{$$typeof:p,_payload:{_status:-1,_result:e},_init:I}},n.memo=function(e,n){return{$$typeof:d,type:e,compare:void 0===n?null:n}},n.startTransition=function(e){var n=O.transition;O.transition={};try{e()}finally{O.transition=n}},n.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},n.useCallback=function(e,n){return C.current.useCallback(e,n)},n.useContext=function(e){return C.current.useContext(e)},n.useDebugValue=function(){},n.useDeferredValue=function(e){return C.current.useDeferredValue(e)},n.useEffect=function(e,n){return C.current.useEffect(e,n)},n.useId=function(){return C.current.useId()},n.useImperativeHandle=function(e,n,t){return C.current.useImperativeHandle(e,n,t)},n.useInsertionEffect=function(e,n){return C.current.useInsertionEffect(e,n)},n.useLayoutEffect=function(e,n){return C.current.useLayoutEffect(e,n)},n.useMemo=function(e,n){return C.current.useMemo(e,n)},n.useReducer=function(e,n,t){return C.current.useReducer(e,n,t)},n.useRef=function(e){return C.current.useRef(e)},n.useState=function(e){return C.current.useState(e)},n.useSyncExternalStore=function(e,n,t){return C.current.useSyncExternalStore(e,n,t)},n.useTransition=function(){return C.current.useTransition()},n.version="18.2.0"},827378:(e,n,t)=>{e.exports=t(541535)},824246:(e,n,t)=>{e.exports=t(371426)},511151:(e,n,t)=>{t.d(n,{Zo:()=>a,ah:()=>o});var r=t(667294);const i=r.createContext({});function o(e){const n=r.useContext(i);return r.useMemo((()=>"function"==typeof e?e(n):{...n,...e}),[n,e])}const s={};function a({components:e,children:n,disableParentContext:t}){let a;return a=t?"function"==typeof e?e({}):e||s:o(e),r.createElement(i.Provider,{value:a},n)}}}]);