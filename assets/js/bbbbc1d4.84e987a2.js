/*! For license information please see bbbbc1d4.84e987a2.js.LICENSE.txt */
"use strict";(self.webpackChunkbackstage_microsite=self.webpackChunkbackstage_microsite||[]).push([[338319],{610629:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>d,frontMatter:()=>i,metadata:()=>a,toc:()=>u});var r=n(824246),o=n(511151);const i={id:"provider",title:"Microsoft Azure Authentication Provider",sidebar_label:"Azure",description:"Adding Microsoft Azure as an authentication provider in Backstage"},s=void 0,a={id:"auth/microsoft/provider",title:"Microsoft Azure Authentication Provider",description:"Adding Microsoft Azure as an authentication provider in Backstage",source:"@site/../docs/auth/microsoft/provider.md",sourceDirName:"auth/microsoft",slug:"/auth/microsoft/provider",permalink:"/docs/auth/microsoft/provider",draft:!1,unlisted:!1,editUrl:"https://github.com/backstage/backstage/edit/master/docs/../docs/auth/microsoft/provider.md",tags:[],version:"current",frontMatter:{id:"provider",title:"Microsoft Azure Authentication Provider",sidebar_label:"Azure",description:"Adding Microsoft Azure as an authentication provider in Backstage"},sidebar:"docs",previous:{title:"Atlassian",permalink:"/docs/auth/atlassian/provider"},next:{title:"Azure Easy Auth",permalink:"/docs/auth/microsoft/easy-auth"}},c={},u=[{value:"Configure App Registration on Azure",id:"configure-app-registration-on-azure",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Adding the provider to the Backstage frontend",id:"adding-the-provider-to-the-backstage-frontend",level:2},{value:"Outbound Network Access",id:"outbound-network-access",level:2}];function l(e){const t={a:"a",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(t.p,{children:["The Backstage ",(0,r.jsx)(t.code,{children:"core-plugin-api"})," package comes with a Microsoft authentication\nprovider that can authenticate users using Azure OAuth."]}),"\n",(0,r.jsx)(t.h2,{id:"configure-app-registration-on-azure",children:"Configure App Registration on Azure"}),"\n",(0,r.jsx)(t.p,{children:"Depending on how locked down your company is, you may need a directory administrator to do some or all of these instructions."}),"\n",(0,r.jsxs)(t.p,{children:["Go to ",(0,r.jsx)(t.a,{href:"https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationsListBlade",children:"Azure Portal > App registrations"})," and find your existing app registration, or create a new one.\nIf you have an existing App Registration for Backstage, use that rather than create a new one."]}),"\n",(0,r.jsxs)(t.p,{children:["On your app registration's overview page, add a new ",(0,r.jsx)(t.code,{children:"Web"})," platform configuration, with the configuration:"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Redirect URI"}),": ",(0,r.jsx)(t.code,{children:"https://your-backstage.com/api/auth/microsoft/handler/frame"})," (for local dev, typically ",(0,r.jsx)(t.code,{children:"http://localhost:7007/api/auth/microsoft/handler/frame"}),")"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Front-channel logout Url"}),": blank"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Implicit grant and hybrid flows"}),": All unchecked"]}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["On the ",(0,r.jsx)(t.strong,{children:"API permissions"})," tab, click on ",(0,r.jsx)(t.code,{children:"Add Permission"}),", then add the following ",(0,r.jsx)(t.code,{children:"Delegated"})," permission for the ",(0,r.jsx)(t.code,{children:"Microsoft Graph"})," API."]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.code,{children:"email"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.code,{children:"offline_access"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.code,{children:"openid"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.code,{children:"profile"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.code,{children:"User.Read"})}),"\n",(0,r.jsxs)(t.li,{children:["Optional custom scopes of the ",(0,r.jsx)(t.code,{children:"Microsoft Graph"})," API defined in the app-config.yaml file."]}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["Your company may require you to grant ",(0,r.jsx)(t.a,{href:"https://learn.microsoft.com/en-us/azure/active-directory/manage-apps/user-admin-consent-overview",children:"admin consent"})," for these permissions.\nEven if your company doesn't require admin consent, you may wish to do so as it means users don't need to individually consent the first time they access backstage.\nTo grant admin consent, a directory admin will need to come to this page and click on the ",(0,r.jsx)(t.strong,{children:"Grant admin consent for COMPANY NAME"})," button."]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"App Registration Permissions",src:n(540852).Z+"",width:"1534",height:"773"})}),"\n",(0,r.jsxs)(t.p,{children:["If you're using an existing app registration, and backstage already has a client secret, you can re-use that.\nIf not, go to the ",(0,r.jsx)(t.strong,{children:"Certificates & Secrets"})," page, then the ",(0,r.jsx)(t.strong,{children:"Client secrets"})," tab and create a new client secret.\nMake a note of this value as you'll need it in the next section."]}),"\n",(0,r.jsx)(t.h2,{id:"configuration",children:"Configuration"}),"\n",(0,r.jsxs)(t.p,{children:["The provider configuration can then be added to your ",(0,r.jsx)(t.code,{children:"app-config.yaml"})," under the\nroot ",(0,r.jsx)(t.code,{children:"auth"})," configuration:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"auth:\n  environment: development\n  providers:\n    microsoft:\n      development:\n        clientId: ${AZURE_CLIENT_ID}\n        clientSecret: ${AZURE_CLIENT_SECRET}\n        tenantId: ${AZURE_TENANT_ID}\n        domainHint: ${AZURE_TENANT_ID}\n        additionalScopes:\n          - Mail.Send\n"})}),"\n",(0,r.jsx)(t.p,{children:"The Microsoft provider is a structure with three mandatory configuration keys:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"clientId"}),": Application (client) ID, found on App Registration > Overview"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"clientSecret"}),": Secret, found on App Registration > Certificates & secrets"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"tenantId"}),": Directory (tenant) ID, found on App Registration > Overview"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"domainHint"})," (optional): Typically the same as ",(0,r.jsx)(t.code,{children:"tenantId"}),".\nLeave blank if your app registration is multi tenant.\nWhen specified, this reduces login friction for users with accounts in multiple tenants by automatically filtering away accounts from other tenants.\nFor more details, see ",(0,r.jsx)(t.a,{href:"https://learn.microsoft.com/en-us/azure/active-directory/manage-apps/home-realm-discovery-policy",children:"Home Realm Discovery"})]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"additionalScopes"})," (optional): List of scopes for the App Registration. The default and mandatory value is ['user.read']."]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"adding-the-provider-to-the-backstage-frontend",children:"Adding the provider to the Backstage frontend"}),"\n",(0,r.jsxs)(t.p,{children:["To add the provider to the frontend, add the ",(0,r.jsx)(t.code,{children:"microsoftAuthApiRef"})," reference and\n",(0,r.jsx)(t.code,{children:"SignInPage"})," component as shown in\n",(0,r.jsx)(t.a,{href:"/docs/auth/#adding-the-provider-to-the-sign-in-page",children:"Adding the provider to the sign-in page"}),"."]}),"\n",(0,r.jsx)(t.h2,{id:"outbound-network-access",children:"Outbound Network Access"}),"\n",(0,r.jsx)(t.p,{children:"If your environment has restrictions on outgoing access (e.g. through\nfirewall rules), make sure your Backstage backend has access to the following\nhosts:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"login.microsoftonline.com"}),", to get and exchange authorization codes and access\ntokens"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"graph.microsoft.com"}),", to fetch user profile information (as seen\nin ",(0,r.jsx)(t.a,{href:"https://github.com/seanfisher/passport-microsoft/blob/0456aa9bce05579c18e77f51330176eb26373658/lib/strategy.js#L93-L95",children:"this source\ncode"}),").\nIf this host is unreachable, users may see an ",(0,r.jsx)(t.code,{children:"Authentication failed, failed to fetch user profile"})," error when they attempt to log in."]}),"\n"]})]})}function d(e={}){const{wrapper:t}={...(0,o.a)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},540852:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/permissions-1b98f6b542dfb1313b29e075e8ab8094.png"},371426:(e,t,n)=>{var r=n(827378),o=Symbol.for("react.element"),i=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,a=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function u(e,t,n){var r,i={},u=null,l=null;for(r in void 0!==n&&(u=""+n),void 0!==t.key&&(u=""+t.key),void 0!==t.ref&&(l=t.ref),t)s.call(t,r)&&!c.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:o,type:e,key:u,ref:l,props:i,_owner:a.current}}t.Fragment=i,t.jsx=u,t.jsxs=u},541535:(e,t)=>{var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),c=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),p=Symbol.iterator;var h={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,y={};function g(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||h}function v(){}function x(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||h}g.prototype.isReactComponent={},g.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=g.prototype;var j=x.prototype=new v;j.constructor=x,m(j,g.prototype),j.isPureReactComponent=!0;var b=Array.isArray,_=Object.prototype.hasOwnProperty,k={current:null},A={key:!0,ref:!0,__self:!0,__source:!0};function w(e,t,r){var o,i={},s=null,a=null;if(null!=t)for(o in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(s=""+t.key),t)_.call(t,o)&&!A.hasOwnProperty(o)&&(i[o]=t[o]);var c=arguments.length-2;if(1===c)i.children=r;else if(1<c){for(var u=Array(c),l=0;l<c;l++)u[l]=arguments[l+2];i.children=u}if(e&&e.defaultProps)for(o in c=e.defaultProps)void 0===i[o]&&(i[o]=c[o]);return{$$typeof:n,type:e,key:s,ref:a,props:i,_owner:k.current}}function S(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}var R=/\/+/g;function E(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function C(e,t,o,i,s){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var c=!1;if(null===e)c=!0;else switch(a){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case n:case r:c=!0}}if(c)return s=s(c=e),e=""===i?"."+E(c,0):i,b(s)?(o="",null!=e&&(o=e.replace(R,"$&/")+"/"),C(s,t,o,"",(function(e){return e}))):null!=s&&(S(s)&&(s=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(s,o+(!s.key||c&&c.key===s.key?"":(""+s.key).replace(R,"$&/")+"/")+e)),t.push(s)),1;if(c=0,i=""===i?".":i+":",b(e))for(var u=0;u<e.length;u++){var l=i+E(a=e[u],u);c+=C(a,t,o,l,s)}else if(l=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"==typeof l)for(e=l.call(e),u=0;!(a=e.next()).done;)c+=C(a=a.value,t,o,l=i+E(a,u++),s);else if("object"===a)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return c}function I(e,t,n){if(null==e)return e;var r=[],o=0;return C(e,r,"","",(function(e){return t.call(n,e,o++)})),r}function O(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var P={current:null},$={transition:null},T={ReactCurrentDispatcher:P,ReactCurrentBatchConfig:$,ReactCurrentOwner:k};t.Children={map:I,forEach:function(e,t,n){I(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return I(e,(function(){t++})),t},toArray:function(e){return I(e,(function(e){return e}))||[]},only:function(e){if(!S(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=g,t.Fragment=o,t.Profiler=s,t.PureComponent=x,t.StrictMode=i,t.Suspense=l,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=T,t.cloneElement=function(e,t,r){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var o=m({},e.props),i=e.key,s=e.ref,a=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,a=k.current),void 0!==t.key&&(i=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(u in t)_.call(t,u)&&!A.hasOwnProperty(u)&&(o[u]=void 0===t[u]&&void 0!==c?c[u]:t[u])}var u=arguments.length-2;if(1===u)o.children=r;else if(1<u){c=Array(u);for(var l=0;l<u;l++)c[l]=arguments[l+2];o.children=c}return{$$typeof:n,type:e.type,key:i,ref:s,props:o,_owner:a}},t.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},t.createElement=w,t.createFactory=function(e){var t=w.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:u,render:e}},t.isValidElement=S,t.lazy=function(e){return{$$typeof:f,_payload:{_status:-1,_result:e},_init:O}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=$.transition;$.transition={};try{e()}finally{$.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return P.current.useCallback(e,t)},t.useContext=function(e){return P.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return P.current.useDeferredValue(e)},t.useEffect=function(e,t){return P.current.useEffect(e,t)},t.useId=function(){return P.current.useId()},t.useImperativeHandle=function(e,t,n){return P.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return P.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return P.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return P.current.useMemo(e,t)},t.useReducer=function(e,t,n){return P.current.useReducer(e,t,n)},t.useRef=function(e){return P.current.useRef(e)},t.useState=function(e){return P.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return P.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return P.current.useTransition()},t.version="18.2.0"},827378:(e,t,n)=>{e.exports=n(541535)},824246:(e,t,n)=>{e.exports=n(371426)},511151:(e,t,n)=>{n.d(t,{Z:()=>a,a:()=>s});var r=n(667294);const o={},i=r.createContext(o);function s(e){const t=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),r.createElement(i.Provider,{value:t},e.children)}}}]);