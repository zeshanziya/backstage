/*! For license information please see fa0f8330.3fdfe863.js.LICENSE.txt */
"use strict";(self.webpackChunkbackstage_microsite=self.webpackChunkbackstage_microsite||[]).push([[51533],{243561:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>a,contentTitle:()=>c,default:()=>d,frontMatter:()=>s,metadata:()=>i,toc:()=>l});var r=n(824246),o=n(511151);const s={id:"configuring-ci-cd",title:"Configuring CI/CD to generate and publish TechDocs sites",description:"Configuring CI/CD to generate and publish TechDocs sites to cloud storage"},c=void 0,i={id:"features/techdocs/configuring-ci-cd",title:"Configuring CI/CD to generate and publish TechDocs sites",description:"Configuring CI/CD to generate and publish TechDocs sites to cloud storage",source:"@site/../docs/features/techdocs/configuring-ci-cd.md",sourceDirName:"features/techdocs",slug:"/features/techdocs/configuring-ci-cd",permalink:"/docs/features/techdocs/configuring-ci-cd",draft:!1,unlisted:!1,editUrl:"https://github.com/backstage/backstage/edit/master/docs/../docs/features/techdocs/configuring-ci-cd.md",tags:[],version:"current",frontMatter:{id:"configuring-ci-cd",title:"Configuring CI/CD to generate and publish TechDocs sites",description:"Configuring CI/CD to generate and publish TechDocs sites to cloud storage"},sidebar:"docs",previous:{title:"Using Cloud Storage for TechDocs generated files",permalink:"/docs/features/techdocs/using-cloud-storage"},next:{title:"TechDocs CLI",permalink:"/docs/features/techdocs/cli"}},a={},l=[{value:"Steps",id:"steps",level:2},{value:"1. Setup a workflow",id:"1-setup-a-workflow",level:3},{value:"2. Prepare step",id:"2-prepare-step",level:3},{value:"3. Generate step",id:"3-generate-step",level:3},{value:"4. Publish step",id:"4-publish-step",level:3},{value:"Example: GitHub Actions CI and AWS S3",id:"example-github-actions-ci-and-aws-s3",level:2}];function u(e){const t=Object.assign({p:"p",a:"a",code:"code",pre:"pre",h2:"h2",h3:"h3",ul:"ul",li:"li"},(0,o.ah)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(t.p,{children:["In the ",(0,r.jsx)(t.a,{href:"/docs/features/techdocs/architecture#recommended-deployment",children:"Recommended deployment setup"}),",\nTechDocs reads the static generated documentation files from a cloud storage\nbucket (GCS, AWS S3, etc.). The documentation site is generated on the CI/CD\nworkflow associated with the repository containing the documentation files. This\ndocument explains the steps needed to generate docs on CI and publish to a cloud\nstorage using ",(0,r.jsx)(t.a,{href:"/docs/features/techdocs/cli",children:(0,r.jsx)(t.code,{children:"techdocs-cli"})}),"."]}),"\n",(0,r.jsx)(t.p,{children:"The steps here target all kinds of CI providers (GitHub Actions, CircleCI,\nJenkins, etc.). Specific tools for individual providers will also be made\navailable here for simplicity (e.g. a GitHub Actions runner, CircleCI orb,\netc.)."}),"\n",(0,r.jsx)(t.p,{children:"A summary of the instructions below looks like this -"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-sh",children:"# This is an example script\n\n# Prepare\nREPOSITORY_URL='https://github.com/org/repo'\ngit clone $REPOSITORY_URL\ncd repo\n\n# Install @techdocs/cli, mkdocs and mkdocs plugins\nnpm install -g @techdocs/cli\npip install \"mkdocs-techdocs-core==1.*\"\n\n# Generate\ntechdocs-cli generate --no-docker\n\n# Publish\ntechdocs-cli publish --publisher-type awsS3 --storage-name <bucket/container> --entity <Namespace/Kind/Name>\n"})}),"\n",(0,r.jsx)(t.p,{children:"That's it!"}),"\n",(0,r.jsxs)(t.p,{children:["Take a look at ",(0,r.jsx)(t.a,{href:"/docs/features/techdocs/cli",children:(0,r.jsx)(t.code,{children:"techdocs-cli"})})," for the complete command reference,\ndetails, and options."]}),"\n",(0,r.jsx)(t.h2,{id:"steps",children:"Steps"}),"\n",(0,r.jsx)(t.h3,{id:"1-setup-a-workflow",children:"1. Setup a workflow"}),"\n",(0,r.jsxs)(t.p,{children:["The TechDocs workflow should trigger on CI when any changes are made in the\nrepository containing the documentation files. You can be specific and configure\nthe workflow to be triggered only when files inside the ",(0,r.jsx)(t.code,{children:"docs/"})," directory or\n",(0,r.jsx)(t.code,{children:"mkdocs.yml"})," are changed."]}),"\n",(0,r.jsx)(t.h3,{id:"2-prepare-step",children:"2. Prepare step"}),"\n",(0,r.jsx)(t.p,{children:"The first step on the CI is to clone your documentation source repository in a\nworking directory. This is almost always the first step in most CI workflows."}),"\n",(0,r.jsx)(t.p,{children:"On GitHub Actions, you can add a step"}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.a,{href:"https://github.com/actions/checkout",children:(0,r.jsx)(t.code,{children:"- uses: actions@checkout@v3"})}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["On CircleCI, you can add a special\n",(0,r.jsx)(t.a,{href:"https://circleci.com/docs/2.0/configuration-reference/#checkout",children:(0,r.jsx)(t.code,{children:"checkout"})}),"\nstep."]}),"\n",(0,r.jsxs)(t.p,{children:["Eventually we are trying to do a ",(0,r.jsx)(t.code,{children:"git clone <https://path/to/docs-repository/>"}),"."]}),"\n",(0,r.jsx)(t.h3,{id:"3-generate-step",children:"3. Generate step"}),"\n",(0,r.jsxs)(t.p,{children:["Install ",(0,r.jsx)(t.a,{href:"https://www.npmjs.com/package/npx",children:(0,r.jsx)(t.code,{children:"npx"})})," to use it for running\n",(0,r.jsx)(t.code,{children:"techdocs-cli"}),". Or you can install using ",(0,r.jsx)(t.code,{children:"npm install -g @techdocs/cli"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["We are going to use the\n",(0,r.jsx)(t.a,{href:"/docs/features/techdocs/cli#generate-techdocs-site-from-a-documentation-project",children:(0,r.jsx)(t.code,{children:"techdocs-cli generate"})}),"\ncommand in this step."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-sh",children:"npx @techdocs/cli generate --no-docker --source-dir PATH_TO_REPO --output-dir ./site\n"})}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.code,{children:"PATH_TO_REPO"})," should be the location in the file path where the prepare step\nabove clones the repository."]}),"\n",(0,r.jsx)(t.h3,{id:"4-publish-step",children:"4. Publish step"}),"\n",(0,r.jsx)(t.p,{children:"Depending on your cloud storage provider (AWS, Google Cloud, or Azure), set the\nnecessary authentication environment variables."}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"https://cloud.google.com/storage/docs/authentication#libauth",children:"Google Cloud authentication"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"https://docs.aws.amazon.com/sdk-for-javascript/v3/developer-guide/loading-node-credentials-environment.html",children:"AWS authentication"})}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["And then run the\n",(0,r.jsx)(t.a,{href:"/docs/features/techdocs/cli#publish-generated-techdocs-sites",children:(0,r.jsx)(t.code,{children:"techdocs-cli publish"})})," command."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-sh",children:"npx @techdocs/cli publish --publisher-type <awsS3|googleGcs> --storage-name <bucket/container> --entity <namespace/kind/name> --directory ./site\n"})}),"\n",(0,r.jsx)(t.p,{children:"The updated TechDocs site built in this workflow is now ready to be served by\nthe TechDocs plugin in your Backstage app."}),"\n",(0,r.jsx)(t.h2,{id:"example-github-actions-ci-and-aws-s3",children:"Example: GitHub Actions CI and AWS S3"}),"\n",(0,r.jsxs)(t.p,{children:["Here is an example workflow using GitHub Actions CI and AWS S3 storage. You can\nuse any CI and any other\n",(0,r.jsx)(t.a,{href:"/docs/features/techdocs/#platforms-supported",children:"TechDocs supported cloud storage providers"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["Add a ",(0,r.jsx)(t.code,{children:".github/workflows/techdocs.yml"})," file in your\n",(0,r.jsx)(t.a,{href:"/docs/features/software-templates/",children:"Software Template(s)"})," like this -"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"name: Publish TechDocs Site\n\non:\n  push:\n    branches: [main]\n    # You can even set it to run only when TechDocs related files are updated.\n    # paths:\n    #   - \"docs/**\"\n    #   - \"mkdocs.yml\"\n\njobs:\n  publish-techdocs-site:\n    runs-on: ubuntu-latest\n\n    # The following secrets are required in your CI environment for publishing files to AWS S3.\n    # e.g. You can use GitHub Organization secrets to set them for all existing and new repositories.\n    env:\n      TECHDOCS_S3_BUCKET_NAME: ${{ secrets.TECHDOCS_S3_BUCKET_NAME }}\n      AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}\n      AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}\n      AWS_REGION: ${{ secrets.AWS_REGION }}\n      ENTITY_NAMESPACE: 'default'\n      ENTITY_KIND: 'Component'\n      ENTITY_NAME: 'my-doc-entity'\n      # In a Software template, Scaffolder will replace {{cookiecutter.component_id | jsonify}}\n      # with the correct entity name. This is same as metadata.name in the entity's catalog-info.yaml\n      # ENTITY_NAME: '{{ cookiecutter.component_id | jsonify }}'\n\n    steps:\n      - name: Checkout code\n        uses: actions/checkout@v3\n\n      - uses: actions/setup-node@v3\n      - uses: actions/setup-python@v4\n        with:\n          python-version: '3.9'\n\n      # the 2 steps below can be removed if you aren't using plantuml in your documentation\n      - name: setup java\n        uses: actions/setup-java@v3\n        with:\n          distribution: 'zulu'\n          java-version: '11'\n      - name: download, validate, install plantuml and its dependencies\n        run: |\n          curl -o plantuml.jar -L http://sourceforge.net/projects/plantuml/files/plantuml.1.2021.4.jar/download\n          echo \"be498123d20eaea95a94b174d770ef94adfdca18  plantuml.jar\" | sha1sum -c -\n          mv plantuml.jar /opt/plantuml.jar\n          mkdir -p \"$HOME/.local/bin\"\n          echo $'#!/bin/sh\\n\\njava -jar '/opt/plantuml.jar' ${@}' >> \"$HOME/.local/bin/plantuml\"\n          chmod +x \"$HOME/.local/bin/plantuml\"\n          echo \"$HOME/.local/bin\" >> $GITHUB_PATH\n          sudo apt-get install -y graphviz\n\n      - name: Install techdocs-cli\n        run: sudo npm install -g @techdocs/cli\n\n      - name: Install mkdocs and mkdocs plugins\n        run: python -m pip install mkdocs-techdocs-core==1.*\n\n      - name: Generate docs site\n        run: techdocs-cli generate --no-docker --verbose\n\n      - name: Publish docs site\n        run: techdocs-cli publish --publisher-type awsS3 --storage-name $TECHDOCS_S3_BUCKET_NAME --entity $ENTITY_NAMESPACE/$ENTITY_KIND/$ENTITY_NAME\n"})}),"\n",(0,r.jsx)(t.p,{children:"When the new repository is scaffolded or new documentation updates are\ncommitted, the GitHub Action workflow will publish the TechDocs site, which can\nbe viewed in your Backstage app."})]})}const d=function(e={}){const{wrapper:t}=Object.assign({},(0,o.ah)(),e.components);return t?(0,r.jsx)(t,Object.assign({},e,{children:(0,r.jsx)(u,e)})):u(e)}},371426:(e,t,n)=>{var r=n(827378),o=Symbol.for("react.element"),s=Symbol.for("react.fragment"),c=Object.prototype.hasOwnProperty,i=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,n){var r,s={},l=null,u=null;for(r in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(u=t.ref),t)c.call(t,r)&&!a.hasOwnProperty(r)&&(s[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===s[r]&&(s[r]=t[r]);return{$$typeof:o,type:e,key:l,ref:u,props:s,_owner:i.current}}t.Fragment=s,t.jsx=l,t.jsxs=l},541535:(e,t)=>{var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),c=Symbol.for("react.profiler"),i=Symbol.for("react.provider"),a=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),h=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,y={};function g(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||f}function b(){}function j(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||f}g.prototype.isReactComponent={},g.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=g.prototype;var _=j.prototype=new b;_.constructor=j,m(_,g.prototype),_.isPureReactComponent=!0;var v=Array.isArray,x=Object.prototype.hasOwnProperty,w={current:null},C={key:!0,ref:!0,__self:!0,__source:!0};function S(e,t,r){var o,s={},c=null,i=null;if(null!=t)for(o in void 0!==t.ref&&(i=t.ref),void 0!==t.key&&(c=""+t.key),t)x.call(t,o)&&!C.hasOwnProperty(o)&&(s[o]=t[o]);var a=arguments.length-2;if(1===a)s.children=r;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];s.children=l}if(e&&e.defaultProps)for(o in a=e.defaultProps)void 0===s[o]&&(s[o]=a[o]);return{$$typeof:n,type:e,key:c,ref:i,props:s,_owner:w.current}}function k(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}var E=/\/+/g;function T(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function I(e,t,o,s,c){var i=typeof e;"undefined"!==i&&"boolean"!==i||(e=null);var a=!1;if(null===e)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case n:case r:a=!0}}if(a)return c=c(a=e),e=""===s?"."+T(a,0):s,v(c)?(o="",null!=e&&(o=e.replace(E,"$&/")+"/"),I(c,t,o,"",(function(e){return e}))):null!=c&&(k(c)&&(c=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(c,o+(!c.key||a&&a.key===c.key?"":(""+c.key).replace(E,"$&/")+"/")+e)),t.push(c)),1;if(a=0,s=""===s?".":s+":",v(e))for(var l=0;l<e.length;l++){var u=s+T(i=e[l],l);a+=I(i,t,o,u,c)}else if(u=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=h&&e[h]||e["@@iterator"])?e:null}(e),"function"==typeof u)for(e=u.call(e),l=0;!(i=e.next()).done;)a+=I(i=i.value,t,o,u=s+T(i,l++),c);else if("object"===i)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return a}function A(e,t,n){if(null==e)return e;var r=[],o=0;return I(e,r,"","",(function(e){return t.call(n,e,o++)})),r}function O(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var $={current:null},D={transition:null},R={ReactCurrentDispatcher:$,ReactCurrentBatchConfig:D,ReactCurrentOwner:w};t.Children={map:A,forEach:function(e,t,n){A(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return A(e,(function(){t++})),t},toArray:function(e){return A(e,(function(e){return e}))||[]},only:function(e){if(!k(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=g,t.Fragment=o,t.Profiler=c,t.PureComponent=j,t.StrictMode=s,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=R,t.cloneElement=function(e,t,r){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var o=m({},e.props),s=e.key,c=e.ref,i=e._owner;if(null!=t){if(void 0!==t.ref&&(c=t.ref,i=w.current),void 0!==t.key&&(s=""+t.key),e.type&&e.type.defaultProps)var a=e.type.defaultProps;for(l in t)x.call(t,l)&&!C.hasOwnProperty(l)&&(o[l]=void 0===t[l]&&void 0!==a?a[l]:t[l])}var l=arguments.length-2;if(1===l)o.children=r;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];o.children=a}return{$$typeof:n,type:e.type,key:s,ref:c,props:o,_owner:i}},t.createContext=function(e){return(e={$$typeof:a,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:i,_context:e},e.Consumer=e},t.createElement=S,t.createFactory=function(e){var t=S.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=k,t.lazy=function(e){return{$$typeof:p,_payload:{_status:-1,_result:e},_init:O}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=D.transition;D.transition={};try{e()}finally{D.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return $.current.useCallback(e,t)},t.useContext=function(e){return $.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return $.current.useDeferredValue(e)},t.useEffect=function(e,t){return $.current.useEffect(e,t)},t.useId=function(){return $.current.useId()},t.useImperativeHandle=function(e,t,n){return $.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return $.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return $.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return $.current.useMemo(e,t)},t.useReducer=function(e,t,n){return $.current.useReducer(e,t,n)},t.useRef=function(e){return $.current.useRef(e)},t.useState=function(e){return $.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return $.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return $.current.useTransition()},t.version="18.2.0"},827378:(e,t,n)=>{e.exports=n(541535)},824246:(e,t,n)=>{e.exports=n(371426)},511151:(e,t,n)=>{n.d(t,{Zo:()=>i,ah:()=>s});var r=n(667294);const o=r.createContext({});function s(e){const t=r.useContext(o);return r.useMemo((()=>"function"==typeof e?e(t):{...t,...e}),[t,e])}const c={};function i({components:e,children:t,disableParentContext:n}){let i;return i=n?"function"==typeof e?e({}):e||c:s(e),r.createElement(o.Provider,{value:i},t)}}}]);