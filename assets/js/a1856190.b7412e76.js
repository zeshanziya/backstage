/*! For license information please see a1856190.b7412e76.js.LICENSE.txt */
"use strict";(self.webpackChunkbackstage_microsite=self.webpackChunkbackstage_microsite||[]).push([[441630],{719758:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>a,toc:()=>u});var r=n(824246),s=n(511151);const o={id:"authentication",title:"Kubernetes Authentication",description:"Authentication in Kubernetes plugin"},i=void 0,a={id:"features/kubernetes/authentication",title:"Kubernetes Authentication",description:"Authentication in Kubernetes plugin",source:"@site/../docs/features/kubernetes/authentication.md",sourceDirName:"features/kubernetes",slug:"/features/kubernetes/authentication",permalink:"/docs/features/kubernetes/authentication",draft:!1,unlisted:!1,editUrl:"https://github.com/backstage/backstage/edit/master/docs/../docs/features/kubernetes/authentication.md",tags:[],version:"current",frontMatter:{id:"authentication",title:"Kubernetes Authentication",description:"Authentication in Kubernetes plugin"},sidebar:"docs",previous:{title:"Configuration",permalink:"/docs/features/kubernetes/configuration"},next:{title:"Authentication Strategies",permalink:"/docs/features/kubernetes/authentication-strategies"}},c={},u=[{value:"Server Side Providers",id:"server-side-providers",level:2},{value:"AWS",id:"aws",level:3},{value:"Azure",id:"azure",level:3},{value:"Client Side Providers",id:"client-side-providers",level:2}];function l(e){const t={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(t.p,{children:["The authentication process in Kubernetes relies on ",(0,r.jsx)(t.code,{children:"KubernetesAuthProviders"})," --\nwhich are not the same as the application's auth providers. the default\nproviders are defined in\n",(0,r.jsx)(t.code,{children:"plugins/kubernetes-react/src/kubernetes-auth-provider/KubernetesAuthProviders.ts"}),";\nyou can add custom providers there if needed."]}),"\n",(0,r.jsx)(t.p,{children:"These providers are configured so your Kubernetes plugin can locate and access\nthe clusters you have access to, some of them have special requirements in the\nthird party in question, like Microsoft Entra ID (formerly Azure Active\nDirectory) subscription or Azure RBAC support active on the cluster."}),"\n",(0,r.jsx)(t.p,{children:"The providers currently available are summarized below:"}),"\n",(0,r.jsx)(t.h2,{id:"server-side-providers",children:"Server Side Providers"}),"\n",(0,r.jsxs)(t.p,{children:["These providers authenticate your ",(0,r.jsx)(t.em,{children:"application"})," with the cluster, meaning anyone\nthat is logged in into your Backstage app will be granted the same access to\nKubernetes objects, including guest users."]}),"\n",(0,r.jsx)(t.p,{children:"The server side providers are:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.code,{children:"aws"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.code,{children:"azure"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.code,{children:"googleServiceAccount"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.code,{children:"localKubectlProxy"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.code,{children:"serviceAccount"})}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"aws",children:"AWS"}),"\n",(0,r.jsxs)(t.p,{children:["For AWS, in addition to Kubernetes configuration, you will have to set up\nAWS authentication. The AWS server-side authentication provider uses ",(0,r.jsx)(t.a,{href:"https://docs.aws.amazon.com/IAM/latest/UserGuide/when-to-use-iam.html",children:"AWS\nIdentity and Access Management (IAM)"})," to authenticate to the target\nAccount(s); you can read more about it on the page for the ",(0,r.jsx)(t.a,{href:"https://github.com/backstage/backstage/blob/master/packages/integration-aws-node/README.md",children:"Integration AWS\nnode"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["Using the plugin, you can authenticate to several AWS accounts using either\n",(0,r.jsx)(t.a,{href:"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html",children:"static AWS Access keys"})," or short-lived Access keys generated by ",(0,r.jsx)(t.a,{href:"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use.html",children:"assuming a\nrole"}),", for either case you will need to install the ",(0,r.jsx)(t.a,{href:"https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html",children:"AWS CLI utility"})," and\nset it up following the steps in the linked documentation."]}),"\n",(0,r.jsx)(t.p,{children:"If you have generated static AWS security credentials, the configuration block\nfor AWS will look like this:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"aws:\n  mainAccount:\n  accounts:\n    - accountId: '<account-number>'\n      accessKeyId: ${AWS_ACCESS_KEY_ID}\n      secretAccessKey: ${AWS_SECRET_ACCESS_KEY}\n      region: <region>\n  accountDefaults:\n"})}),"\n",(0,r.jsx)(t.p,{children:"If your environment is set up to assume a role, the configuration would instead\nlook like this:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"aws:\n  mainAccount:\n    roleName: <name-of-the-role-to-assume>\n    region: <region>\n  accounts:\n  accountDefaults:\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Either of these sections needs to be present for the Kubernetes configuration to\nuse the ",(0,r.jsx)(t.code,{children:"aws"})," ",(0,r.jsx)(t.code,{children:"authProvider"}),". The Kubernetes configuration looks like this:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"kubernetes:\n  serviceLocatorMethod:\n    type: 'multiTenant'\n  clusterLocatorMethods:\n    - type: 'config'\n      clusters:\n        - url: https://<unique-identifier>.<region>.eks.amazonaws.com\n          name: ${CLUSTER_NAME_TO_DISPLAY}\n          authProvider: 'aws'\n          caData: ${EKS_CA_DATA}\n          authMetadata:\n            kubernetes.io/aws-assume-role: ${ROLE_ARN_TO_ASSUME}\n            kubernetes.io/aws-external-id: ${ID_FROM_AWS_ADMIN}\n            kubernetes.io/x-k8s-aws-id: ${CLUSTER_NAME_IN_AWS_CONSOLE}\n"})}),"\n",(0,r.jsxs)(t.p,{children:["You get both the cluster URL and CA directly from the AWS console by going to\n",(0,r.jsx)(t.code,{children:"EKS"})," > ",(0,r.jsx)(t.code,{children:"Your cluster"})," > ",(0,r.jsx)(t.code,{children:"Overview"})," > ",(0,r.jsx)(t.code,{children:"Details"}),". You will find them under 'API\nserver endpoint' and 'Certificate authority' respectively."]}),"\n",(0,r.jsxs)(t.p,{children:["If Backstage needs to assume a role when authenticating with EKS clusters, the\n",(0,r.jsx)(t.code,{children:"kubernetes.io/aws-assume-role"})," parameter can be set to the ARN of the desired\nrole. the ",(0,r.jsx)(t.code,{children:"kubernetes.io/aws-external-id"})," parameter in the config corresponds to\nthe ",(0,r.jsx)(t.code,{children:"ExternalId"})," parameter of the ",(0,r.jsxs)(t.a,{href:"https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html#API_AssumeRole_RequestParameters",children:[(0,r.jsx)(t.code,{children:"AssumeRole"})," API in STS"]}),"."]}),"\n",(0,r.jsx)(t.h3,{id:"azure",children:"Azure"}),"\n",(0,r.jsxs)(t.p,{children:["The Azure provider works by authenticating on the server with the Azure CLI,\nplease note that ",(0,r.jsx)(t.a,{href:"https://docs.microsoft.com/en-us/azure/aks/managed-aad",children:"Microsoft Entra authentication"})," is a requirement and has to\nbe enabled in your AKS cluster, then follow these steps:"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.a,{href:"https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest",children:"Install the Azure CLI"})," in the environment where the backstage application\nwill run."]}),"\n",(0,r.jsxs)(t.li,{children:["Login with your Azure/Microsoft account with ",(0,r.jsx)(t.code,{children:"az login"})," in the server's\nterminal."]}),"\n",(0,r.jsxs)(t.li,{children:["Go to your AKS cluster's resource page in Azure Console and follow the steps\nin the ",(0,r.jsx)(t.code,{children:"Connect"})," tab to set the subscription and get your credentials for\n",(0,r.jsx)(t.code,{children:"kubectl"})," integration."]}),"\n",(0,r.jsxs)(t.li,{children:["Configure your cluster to use the ",(0,r.jsx)(t.code,{children:"azure"})," auth provider like this:"]}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"kubernetes:\n  clusterLocatorMethods:\n    - type: 'config'\n      clusters:\n        - name: My AKS cluster\n          url: ${AZURE_CLUSTER_API_SERVER_ADDRESS}\n          authProvider: azure\n          skipTLSVerify: true\n"})}),"\n",(0,r.jsxs)(t.p,{children:["To get the API server address for your Azure cluster, go to the Azure console\npage for the cluster resource, go to ",(0,r.jsx)(t.code,{children:"Overview"})," > ",(0,r.jsx)(t.code,{children:"Properties"})," tab >\n",(0,r.jsx)(t.code,{children:"Networking"})," section and copy paste the API server address directly in that\n",(0,r.jsx)(t.code,{children:"url"})," field."]}),"\n",(0,r.jsx)(t.h2,{id:"client-side-providers",children:"Client Side Providers"}),"\n",(0,r.jsxs)(t.p,{children:["These providers authenticate a ",(0,r.jsx)(t.em,{children:"user"})," with the cluster. Each Backstage user will\nbe prompted for credentials and will have access to the clusters as long as the\nuser has been authorized to access said cluster. If Backstage is configured to\ncommunicate with a cluster but the user isn't authorized to access it, they will\nsee the cluster listed but will not see any resources in the plugin page for\nthat cluster. The error will show as ",(0,r.jsx)(t.code,{children:"401"})," or similar."]}),"\n",(0,r.jsx)(t.p,{children:"The providers available as client side are:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.code,{children:"aks"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.code,{children:"google"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.code,{children:"oidc"})}),"\n"]})]})}function d(e={}){const{wrapper:t}={...(0,s.a)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},371426:(e,t,n)=>{var r=n(827378),s=Symbol.for("react.element"),o=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,a=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function u(e,t,n){var r,o={},u=null,l=null;for(r in void 0!==n&&(u=""+n),void 0!==t.key&&(u=""+t.key),void 0!==t.ref&&(l=t.ref),t)i.call(t,r)&&!c.hasOwnProperty(r)&&(o[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===o[r]&&(o[r]=t[r]);return{$$typeof:s,type:e,key:u,ref:l,props:o,_owner:a.current}}t.Fragment=o,t.jsx=u,t.jsxs=u},541535:(e,t)=>{var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),c=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),f=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,m={};function v(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||p}function b(){}function g(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||p}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=v.prototype;var x=g.prototype=new b;x.constructor=g,y(x,v.prototype),x.isPureReactComponent=!0;var j=Array.isArray,_=Object.prototype.hasOwnProperty,A={current:null},S={key:!0,ref:!0,__self:!0,__source:!0};function k(e,t,r){var s,o={},i=null,a=null;if(null!=t)for(s in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(i=""+t.key),t)_.call(t,s)&&!S.hasOwnProperty(s)&&(o[s]=t[s]);var c=arguments.length-2;if(1===c)o.children=r;else if(1<c){for(var u=Array(c),l=0;l<c;l++)u[l]=arguments[l+2];o.children=u}if(e&&e.defaultProps)for(s in c=e.defaultProps)void 0===o[s]&&(o[s]=c[s]);return{$$typeof:n,type:e,key:i,ref:a,props:o,_owner:A.current}}function w(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}var E=/\/+/g;function C(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function R(e,t,s,o,i){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var c=!1;if(null===e)c=!0;else switch(a){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case n:case r:c=!0}}if(c)return i=i(c=e),e=""===o?"."+C(c,0):o,j(i)?(s="",null!=e&&(s=e.replace(E,"$&/")+"/"),R(i,t,s,"",(function(e){return e}))):null!=i&&(w(i)&&(i=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(i,s+(!i.key||c&&c.key===i.key?"":(""+i.key).replace(E,"$&/")+"/")+e)),t.push(i)),1;if(c=0,o=""===o?".":o+":",j(e))for(var u=0;u<e.length;u++){var l=o+C(a=e[u],u);c+=R(a,t,s,l,i)}else if(l=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"==typeof l)for(e=l.call(e),u=0;!(a=e.next()).done;)c+=R(a=a.value,t,s,l=o+C(a,u++),i);else if("object"===a)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return c}function I(e,t,n){if(null==e)return e;var r=[],s=0;return R(e,r,"","",(function(e){return t.call(n,e,s++)})),r}function P(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var T={current:null},$={transition:null},z={ReactCurrentDispatcher:T,ReactCurrentBatchConfig:$,ReactCurrentOwner:A};t.Children={map:I,forEach:function(e,t,n){I(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return I(e,(function(){t++})),t},toArray:function(e){return I(e,(function(e){return e}))||[]},only:function(e){if(!w(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=s,t.Profiler=i,t.PureComponent=g,t.StrictMode=o,t.Suspense=l,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=z,t.cloneElement=function(e,t,r){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var s=y({},e.props),o=e.key,i=e.ref,a=e._owner;if(null!=t){if(void 0!==t.ref&&(i=t.ref,a=A.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(u in t)_.call(t,u)&&!S.hasOwnProperty(u)&&(s[u]=void 0===t[u]&&void 0!==c?c[u]:t[u])}var u=arguments.length-2;if(1===u)s.children=r;else if(1<u){c=Array(u);for(var l=0;l<u;l++)c[l]=arguments[l+2];s.children=c}return{$$typeof:n,type:e.type,key:o,ref:i,props:s,_owner:a}},t.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},t.createElement=k,t.createFactory=function(e){var t=k.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:u,render:e}},t.isValidElement=w,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:P}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=$.transition;$.transition={};try{e()}finally{$.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return T.current.useCallback(e,t)},t.useContext=function(e){return T.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return T.current.useDeferredValue(e)},t.useEffect=function(e,t){return T.current.useEffect(e,t)},t.useId=function(){return T.current.useId()},t.useImperativeHandle=function(e,t,n){return T.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return T.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return T.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return T.current.useMemo(e,t)},t.useReducer=function(e,t,n){return T.current.useReducer(e,t,n)},t.useRef=function(e){return T.current.useRef(e)},t.useState=function(e){return T.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return T.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return T.current.useTransition()},t.version="18.2.0"},827378:(e,t,n)=>{e.exports=n(541535)},824246:(e,t,n)=>{e.exports=n(371426)},511151:(e,t,n)=>{n.d(t,{Z:()=>a,a:()=>i});var r=n(667294);const s={},o=r.createContext(s);function i(e){const t=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),r.createElement(o.Provider,{value:t},e.children)}}}]);