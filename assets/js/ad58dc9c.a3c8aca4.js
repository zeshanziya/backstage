/*! For license information please see ad58dc9c.a3c8aca4.js.LICENSE.txt */
"use strict";(self.webpackChunkbackstage_microsite=self.webpackChunkbackstage_microsite||[]).push([[751527],{828066:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>c,toc:()=>l});var o=t(824246),s=t(511151);const i={id:"how-to-guides",title:"TechDocs How-To guides",sidebar_label:"How-To guides",description:"TechDocs How-To guides related to TechDocs"},r=void 0,c={id:"features/techdocs/how-to-guides",title:"TechDocs How-To guides",description:"TechDocs How-To guides related to TechDocs",source:"@site/../docs/features/techdocs/how-to-guides.md",sourceDirName:"features/techdocs",slug:"/features/techdocs/how-to-guides",permalink:"/docs/features/techdocs/how-to-guides",draft:!1,unlisted:!1,editUrl:"https://github.com/backstage/backstage/edit/master/docs/../docs/features/techdocs/how-to-guides.md",tags:[],version:"current",frontMatter:{id:"how-to-guides",title:"TechDocs How-To guides",sidebar_label:"How-To guides",description:"TechDocs How-To guides related to TechDocs"},sidebar:"docs",previous:{title:"TechDocs CLI",permalink:"/docs/features/techdocs/cli"},next:{title:"Troubleshooting",permalink:"/docs/features/techdocs/troubleshooting"}},a={},l=[{value:"How to migrate from TechDocs Basic to Recommended deployment approach?",id:"how-to-migrate-from-techdocs-basic-to-recommended-deployment-approach",level:2},{value:"1. Prepare a cloud storage",id:"1-prepare-a-cloud-storage",level:3},{value:"2. Publish to storage from CI/CD",id:"2-publish-to-storage-from-cicd",level:3},{value:"3. Switch TechDocs to read-only mode",id:"3-switch-techdocs-to-read-only-mode",level:3},{value:"How to understand techdocs-ref annotation values",id:"how-to-understand-techdocs-ref-annotation-values",level:2},{value:"Why is URL Reader faster than a git clone?",id:"why-is-url-reader-faster-than-a-git-clone",level:3},{value:"How to customize the TechDocs home page?",id:"how-to-customize-the-techdocs-home-page",level:2},{value:"Using TechDocsCustomHome",id:"using-techdocscustomhome",level:3},{value:"Building a Custom home page",id:"building-a-custom-home-page",level:3},{value:"How to customize the TechDocs reader page?",id:"how-to-customize-the-techdocs-reader-page",level:2},{value:"How to migrate from TechDocs Alpha to Beta",id:"how-to-migrate-from-techdocs-alpha-to-beta",level:2},{value:"How to implement your own TechDocs APIs",id:"how-to-implement-your-own-techdocs-apis",level:2},{value:"How to add the documentation setup to your software templates",id:"how-to-add-the-documentation-setup-to-your-software-templates",level:2},{value:"Prevent download of Google fonts",id:"prevent-download-of-google-fonts",level:3},{value:"How to enable iframes in TechDocs",id:"how-to-enable-iframes-in-techdocs",level:2},{value:"How to render PlantUML diagram in TechDocs",id:"how-to-render-plantuml-diagram-in-techdocs",level:2},{value:"UML Diagram Details:-",id:"uml-diagram-details-",level:3},{value:"Embedded PlantUML Diagram Example",id:"embedded-plantuml-diagram-example",level:4},{value:"Referenced PlantUML Diagram Example",id:"referenced-plantuml-diagram-example",level:4},{value:"How to add Mermaid support in TechDocs",id:"how-to-add-mermaid-support-in-techdocs",level:2},{value:"How to implement a hybrid build strategy",id:"how-to-implement-a-hybrid-build-strategy",level:2},{value:"How to use other mkdocs plugins?",id:"how-to-use-other-mkdocs-plugins",level:2},{value:"Install the plugin",id:"install-the-plugin",level:3},{value:"With CI generation",id:"with-ci-generation",level:4},{value:"With local generation",id:"with-local-generation",level:4},{value:"Specify the plugin in the mkdocs config",id:"specify-the-plugin-in-the-mkdocs-config",level:3},{value:"Reference another components TechDocs",id:"reference-another-components-techdocs",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h2,{id:"how-to-migrate-from-techdocs-basic-to-recommended-deployment-approach",children:"How to migrate from TechDocs Basic to Recommended deployment approach?"}),"\n",(0,o.jsxs)(n.p,{children:["The main difference between TechDocs Basic and Recommended deployment approach\nis where the docs are generated and stored. In Basic or the out-of-the-box\nsetup, docs are generated and stored at the server running your Backstage\ninstance. But the recommended setup is to generate docs on CI/CD and store the\ngenerated sites to an external storage (e.g. AWS S3 or GCS). TechDocs in your\nBackstage instance should turn into read-only mode. Read more details and the\nbenefits in the ",(0,o.jsx)(n.a,{href:"/docs/features/techdocs/architecture",children:"TechDocs Architecture"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"Here are the steps needed to switch from the Basic to Recommended setup -"}),"\n",(0,o.jsx)(n.h3,{id:"1-prepare-a-cloud-storage",children:"1. Prepare a cloud storage"}),"\n",(0,o.jsxs)(n.p,{children:["Choose a cloud storage provider like AWS, Google Cloud or Microsoft Azure.\nFollow the detailed instructions for\n",(0,o.jsx)(n.a,{href:"/docs/features/techdocs/using-cloud-storage",children:"using cloud storage"})," in TechDocs."]}),"\n",(0,o.jsx)(n.h3,{id:"2-publish-to-storage-from-cicd",children:"2. Publish to storage from CI/CD"}),"\n",(0,o.jsxs)(n.p,{children:["Start publishing your TechDocs sites from the CI/CD workflow of each repository\ncontaining the source markdown files. Read the detailed instructions for\n",(0,o.jsx)(n.a,{href:"/docs/features/techdocs/configuring-ci-cd",children:"configuring CI/CD"}),"."]}),"\n",(0,o.jsx)(n.h3,{id:"3-switch-techdocs-to-read-only-mode",children:"3. Switch TechDocs to read-only mode"}),"\n",(0,o.jsxs)(n.p,{children:["In your Backstage instance's ",(0,o.jsx)(n.code,{children:"app-config.yaml"}),", set ",(0,o.jsx)(n.code,{children:"techdocs.builder"})," from\n",(0,o.jsx)(n.code,{children:"'local'"})," to ",(0,o.jsx)(n.code,{children:"'external'"}),". By doing this, TechDocs will not try to generate\ndocs. Look at ",(0,o.jsx)(n.a,{href:"/docs/features/techdocs/configuration",children:"TechDocs configuration"})," for reference."]}),"\n",(0,o.jsx)(n.h2,{id:"how-to-understand-techdocs-ref-annotation-values",children:"How to understand techdocs-ref annotation values"}),"\n",(0,o.jsxs)(n.p,{children:["If TechDocs is configured to generate docs, it will first download source files\nbased on the value of the ",(0,o.jsx)(n.code,{children:"backstage.io/techdocs-ref"})," annotation defined in the\nEntity's ",(0,o.jsx)(n.code,{children:"catalog-info.yaml"})," file. This is also called the\n",(0,o.jsx)(n.a,{href:"/docs/features/techdocs/concepts#techdocs-preparer",children:"Prepare"})," step."]}),"\n",(0,o.jsxs)(n.p,{children:["We strongly recommend that the ",(0,o.jsx)(n.code,{children:"backstage.io/techdocs-ref"})," annotation in each\ndocumented catalog entity's ",(0,o.jsx)(n.code,{children:"catalog-info.yaml"})," be set to ",(0,o.jsx)(n.code,{children:"dir:."}),' in almost all\nsituations. This is because TechDocs is aligned with the "docs like code"\nphilosophy, whereby documentation should be authored and managed alongside the\nsource code of the underlying software itself.']}),"\n",(0,o.jsxs)(n.p,{children:["When you see ",(0,o.jsx)(n.code,{children:"dir:."}),", you can translate it to mean:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["That the documentation source code lives in the same location as the\n",(0,o.jsx)(n.code,{children:"catalog-info.yaml"})," file."]}),"\n",(0,o.jsxs)(n.li,{children:["That, in particular, the ",(0,o.jsx)(n.code,{children:"mkdocs.yml"})," file is a sibling of ",(0,o.jsx)(n.code,{children:"catalog-info.yaml"}),"\n(meaning, it is in the same directory)"]}),"\n",(0,o.jsx)(n.li,{children:"And that all of the source content of the documentation would be available if\none were to download the directory containing those two files (as well as all\nsub-directories)."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"The directory tree of the entity would look something like this:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"\u251c\u2500\u2500 catalog-info.yaml\n\u251c\u2500\u2500 mkdocs.yml\n\u2514\u2500\u2500 docs\n    \u2514\u2500\u2500 index.md\n"})}),"\n",(0,o.jsxs)(n.p,{children:["If, for example, you wanted to keep a lean root directory, you could place your\n",(0,o.jsx)(n.code,{children:"mkdocs.yml"})," file in a subdirectory and update the ",(0,o.jsx)(n.code,{children:"backstage.io/techdocs-ref"}),"\nannotation value accordingly, e.g. to ",(0,o.jsx)(n.code,{children:"dir:./sub-folder"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"\u251c\u2500\u2500 catalog-info.yaml\n\u2514\u2500\u2500 sub-folder\n    \u251c\u2500\u2500 mkdocs.yml\n    \u2514\u2500\u2500 docs\n        \u2514\u2500\u2500 index.md\n"})}),"\n",(0,o.jsxs)(n.p,{children:["In rare situations where your TechDocs source content is managed and stored in a\nlocation completely separate from your ",(0,o.jsx)(n.code,{children:"catalog-info.yaml"}),", you can instead\nspecify a URL location reference, the exact value of which will vary based on\nthe source code hosting provider. Notice that instead of the ",(0,o.jsx)(n.code,{children:"dir:"})," prefix, the\n",(0,o.jsx)(n.code,{children:"url:"})," prefix is used instead. For example:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"GitHub"}),": ",(0,o.jsx)(n.code,{children:"url:https://githubhost.com/org/repo/tree/<branch_name>"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"GitLab"}),": ",(0,o.jsx)(n.code,{children:"url:https://gitlabhost.com/org/repo/tree/<branch_name>"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Bitbucket"}),": ",(0,o.jsx)(n.code,{children:"url:https://bitbuckethost.com/project/repo/src/<branch_name>"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Azure"}),": ",(0,o.jsx)(n.code,{children:"url:https://azurehost.com/organization/project/_git/repository"})]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Note, just as it's possible to specify a subdirectory with the ",(0,o.jsx)(n.code,{children:"dir:"})," prefix,\nyou can also provide a path to a non-root directory inside the repository which\ncontains the ",(0,o.jsx)(n.code,{children:"mkdocs.yml"})," file and ",(0,o.jsx)(n.code,{children:"docs/"})," directory."]}),"\n",(0,o.jsxs)(n.p,{children:["e.g.\n",(0,o.jsx)(n.code,{children:"url:https://github.com/backstage/backstage/tree/master/plugins/techdocs-backend/examples/documented-component"})]}),"\n",(0,o.jsx)(n.h3,{id:"why-is-url-reader-faster-than-a-git-clone",children:"Why is URL Reader faster than a git clone?"}),"\n",(0,o.jsx)(n.p,{children:"URL Reader uses the source code hosting provider to download a zip or tarball of\nthe repository. The archive does not have any git history attached to it. Also\nit is a compressed file. Hence the file size is significantly smaller than how\nmuch data git clone has to transfer."}),"\n",(0,o.jsx)(n.h2,{id:"how-to-customize-the-techdocs-home-page",children:"How to customize the TechDocs home page?"}),"\n",(0,o.jsxs)(n.p,{children:["TechDocs uses a composability pattern similar to the Search and Catalog plugins\nin Backstage. While a default table experience, similar to the one provided by\nthe Catalog plugin, is made available for ease-of-use, it's possible for you to\nprovide a completely custom experience, tailored to the needs of your\norganization. For example, TechDocs comes with an alternative grid based layout\n(",(0,o.jsx)(n.code,{children:"<EntityListDocsGrid>"}),") and panel layout (",(0,o.jsx)(n.code,{children:"TechDocsCustomHome"}),")."]}),"\n",(0,o.jsxs)(n.p,{children:["This is done in your ",(0,o.jsx)(n.code,{children:"app"})," package. By default, you might see something like\nthis in your ",(0,o.jsx)(n.code,{children:"App.tsx"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-tsx",children:'const AppRoutes = () => {\n  <FlatRoutes>\n    <Route path="/docs" element={<TechDocsIndexPage />}>\n      <DefaultTechDocsHome />\n    </Route>\n  </FlatRoutes>;\n};\n'})}),"\n",(0,o.jsx)(n.h3,{id:"using-techdocscustomhome",children:"Using TechDocsCustomHome"}),"\n",(0,o.jsxs)(n.p,{children:["You can easily customize the TechDocs home page using TechDocs panel layout\n(",(0,o.jsx)(n.code,{children:"<TechDocsCustomHome />"}),")."]}),"\n",(0,o.jsxs)(n.p,{children:["Modify your ",(0,o.jsx)(n.code,{children:"App.tsx"})," as follows:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-tsx",children:"import { TechDocsCustomHome } from '@backstage/plugin-techdocs';\n//...\n\nconst techDocsTabsConfig = [\n  {\n    label: 'Recommended Documentation',\n    panels: [\n      {\n        title: 'Golden Path',\n        description: 'Documentation about standards to follow',\n        panelType: 'DocsCardGrid',\n        filterPredicate: entity =>\n          entity?.metadata?.tags?.includes('recommended') ?? false,\n      },\n    ],\n  },\n];\n\nconst AppRoutes = () => {\n  <FlatRoutes>\n    <Route\n      path=\"/docs\"\n      element={<TechDocsCustomHome tabsConfig={techDocsTabsConfig} />}\n    />\n  </FlatRoutes>;\n};\n"})}),"\n",(0,o.jsx)(n.h3,{id:"building-a-custom-home-page",children:"Building a Custom home page"}),"\n",(0,o.jsxs)(n.p,{children:["But you can replace ",(0,o.jsx)(n.code,{children:"<DefaultTechDocsHome />"})," with any React component, which\nwill be rendered in its place. Most likely, you would want to create and\nmaintain such a component in a new directory at\n",(0,o.jsx)(n.code,{children:"packages/app/src/components/techdocs"}),", and import and use it in ",(0,o.jsx)(n.code,{children:"App.tsx"}),":"]}),"\n",(0,o.jsx)(n.p,{children:"For example, you can define the following Custom home page component:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-tsx",children:"import React from 'react';\n\nimport { Content } from '@backstage/core-components';\nimport {\n  CatalogFilterLayout,\n  EntityOwnerPicker,\n  EntityTagPicker,\n  UserListPicker,\n  EntityListProvider,\n} from '@backstage/plugin-catalog-react';\nimport {\n  TechDocsPageWrapper,\n  TechDocsPicker,\n} from '@backstage/plugin-techdocs';\nimport { Entity } from '@backstage/catalog-model';\n\nimport { EntityListDocsGrid } from '@backstage/plugin-techdocs';\n\nexport type CustomTechDocsHomeProps = {\n  groups?: Array<{\n    title: React.ReactNode;\n    filterPredicate: ((entity: Entity) => boolean) | string;\n  }>;\n};\n\nexport const CustomTechDocsHome = ({ groups }: CustomTechDocsHomeProps) => {\n  return (\n    <TechDocsPageWrapper>\n      <Content>\n        <EntityListProvider>\n          <CatalogFilterLayout>\n            <CatalogFilterLayout.Filters>\n              <TechDocsPicker />\n              <UserListPicker initialFilter=\"all\" />\n              <EntityOwnerPicker />\n              <EntityTagPicker />\n            </CatalogFilterLayout.Filters>\n            <CatalogFilterLayout.Content>\n              <EntityListDocsGrid groups={groups} />\n            </CatalogFilterLayout.Content>\n          </CatalogFilterLayout>\n        </EntityListProvider>\n      </Content>\n    </TechDocsPageWrapper>\n  );\n};\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Then you can add the following to your ",(0,o.jsx)(n.code,{children:"App.tsx"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-tsx",children:"import { CustomTechDocsHome } from './components/techdocs/CustomTechDocsHome';\n// ...\nconst AppRoutes = () => {\n  <FlatRoutes>\n    <Route path=\"/docs\" element={<TechDocsIndexPage />}>\n      <CustomTechDocsHome\n        groups={[\n          {\n            title: 'Recommended Documentation',\n            filterPredicate: entity =>\n              entity?.metadata?.tags?.includes('recommended') ?? false,\n          },\n          {\n            title: 'My Docs',\n            filterPredicate: 'ownedByUser',\n          },\n        ]}\n      />\n    </Route>\n  </FlatRoutes>;\n};\n"})}),"\n",(0,o.jsx)(n.h2,{id:"how-to-customize-the-techdocs-reader-page",children:"How to customize the TechDocs reader page?"}),"\n",(0,o.jsxs)(n.p,{children:["Similar to how it is possible to customize the TechDocs Home, it is also\npossible to customize the TechDocs Reader Page. It is done in your ",(0,o.jsx)(n.code,{children:"app"}),"\npackage. By default, you might see something like this in your ",(0,o.jsx)(n.code,{children:"App.tsx"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-tsx",children:'const AppRoutes = () => {\n  <Route path="/docs/:namespace/:kind/:name/*" element={<TechDocsReaderPage />}>\n    {techDocsPage}\n  </Route>;\n};\n'})}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"techDocsPage"})," is a default techdocs reader page which lives in\n",(0,o.jsx)(n.code,{children:"packages/app/src/components/techdocs"}),". It includes the following without you\nhaving to set anything up."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-tsx",children:'<Page themeId="documentation">\n  <TechDocsReaderPageHeader />\n  <TechDocsReaderPageSubheader />\n  <TechDocsReaderPageContent />\n</Page>\n'})}),"\n",(0,o.jsxs)(n.p,{children:["If you would like to compose your own ",(0,o.jsx)(n.code,{children:"techDocsPage"}),", you can do so by replacing\nthe children of TechDocsPage with something else. Maybe you are ",(0,o.jsx)(n.em,{children:"just"}),"\ninterested in replacing the Header:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-tsx",children:'<Page themeId="documentation">\n  <Header type="documentation" title="Custom Header" />\n  <TechDocsReaderPageContent />\n</Page>\n'})}),"\n",(0,o.jsx)(n.p,{children:"Or maybe you want to disable the in-context search"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-tsx",children:'<Page themeId="documentation">\n  <Header type="documentation" title="Custom Header" />\n  <TechDocsReaderPageContent withSearch={false} />\n</Page>\n'})}),"\n",(0,o.jsx)(n.p,{children:"Or maybe you want to replace the entire TechDocs Page."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-tsx",children:'<Page themeId="documentation">\n  <Header type="documentation" title="Custom Header" />\n  <Content data-testid="techdocs-content">\n    <p>my own content</p>\n  </Content>\n</Page>\n'})}),"\n",(0,o.jsx)(n.h2,{id:"how-to-migrate-from-techdocs-alpha-to-beta",children:"How to migrate from TechDocs Alpha to Beta"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:'This guide only applies to the "recommended" TechDocs deployment method (where\nan external storage provider and external CI/CD is used). If you use the\n"basic" or "out-of-the-box" setup, you can stop here! No action needed.'}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"For the purposes of this guide, TechDocs Beta version is defined as:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"TechDocs Plugin"}),": At least ",(0,o.jsx)(n.code,{children:"v0.11.0"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"TechDocs Backend Plugin"}),": At least ",(0,o.jsx)(n.code,{children:"v0.10.0"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"TechDocs CLI"}),": At least ",(0,o.jsx)(n.code,{children:"v0.7.0"})]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["The beta version of TechDocs made a breaking change to the way TechDocs content\nwas accessed and stored, allowing pages to be accessed with case-insensitive\nentity triplet paths (e.g. ",(0,o.jsx)(n.code,{children:"/docs/namespace/kind/name"})," whereas in prior\nversions, they could only be accessed at ",(0,o.jsx)(n.code,{children:"/docs/namespace/Kind/name"}),"). In order\nto enable this change, documentation has to be stored in an external storage\nprovider using an object key whose entity triplet is lower-cased."]}),"\n",(0,o.jsx)(n.p,{children:"New installations of TechDocs since the beta version will work fine with no\naction, but for those who were running TechDocs prior to this version, a\nmigration will need to be performed so that all existing content in your storage\nbucket matches this lower-case entity triplet expectation."}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Ensure you have the right permissions on your storage provider"}),": In order\nto migrate files in your storage provider, the ",(0,o.jsx)(n.code,{children:"techdocs-cli"})," needs to be\nable to read/copy/rename/move/delete files. The exact instructions vary by\nstorage provider, but check the ",(0,o.jsx)(n.a,{href:"/docs/features/techdocs/using-cloud-storage",children:"using cloud storage"}),"\npage for details."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Run a non-destructive migration of files"}),": Ensure you have the latest\nversion of ",(0,o.jsx)(n.code,{children:"techdocs-cli"})," installed. Then run the following command, using\nthe details relevant for your provider / configuration. This will copy all\nfiles from, e.g. ",(0,o.jsx)(n.code,{children:"namespace/Kind/name/index.html"})," to\n",(0,o.jsx)(n.code,{children:"namespace/kind/name/index.html"}),", without removing the original files."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:"techdocs-cli migrate --publisher-type <awsS3|googleGcs|azureBlobStorage> --storage-name <bucket/container name> --verbose\n"})}),"\n",(0,o.jsxs)(n.ol,{start:"3",children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Deploy the updated versions of the TechDocs plugins"}),": Once the migration\nabove has been run, you can deploy the beta versions of the TechDocs backend\nand frontend plugins to your Backstage instance."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Verify that your TechDocs sites are still loading/accessible"}),": Try\naccessing a TechDocs site using different entity-triplet case variants, e.g.\n",(0,o.jsx)(n.code,{children:"/docs/namespace/KIND/name"})," or ",(0,o.jsx)(n.code,{children:"/docs/namespace/kind/name"}),". Your TechDocs\nsite should load regardless of the URL path casing you use."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Clean up the old objects from storage"}),": Once you've verified that your\nTechDocs site is accessible, you can clean up your storage bucket by\nre-running the ",(0,o.jsx)(n.code,{children:"migrate"})," command on the TechDocs CLI, but with an additional\n",(0,o.jsx)(n.code,{children:"removeOriginal"})," flag passed:"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:"techdocs-cli migrate --publisher-type <awsS3|googleGcs|azureBlobStorage> --storage-name <bucket/container name> --removeOriginal --verbose\n"})}),"\n",(0,o.jsxs)(n.ol,{start:"6",children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Update your CI/CD pipelines to use the beta version of the TechDocs CLI"}),":\nFinally, you can update all of your CI/CD pipelines to use at least v0.x.y of\nthe TechDocs CLI, ensuring that all sites are published to the new,\nlower-cased entity triplet paths going forward."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["If you encounter problems running this migration, please ",(0,o.jsx)(n.a,{href:"https://github.com/backstage/backstage/issues/new?assignees=&labels=bug&template=bug_template.md&title=%5BTechDocs%5D%20Unable%20to%20run%20beta%20migration",children:"report the\nissue"}),". You can temporarily revert to pre-beta storage\nexpectations with a configuration change:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"techdocs:\n  legacyUseCaseSensitiveTripletPaths: true\n"})}),"\n",(0,o.jsx)(n.h2,{id:"how-to-implement-your-own-techdocs-apis",children:"How to implement your own TechDocs APIs"}),"\n",(0,o.jsxs)(n.p,{children:["The TechDocs plugin provides implementations of two primary APIs by default: the\n",(0,o.jsx)(n.a,{href:"https://github.com/backstage/backstage/blob/55114cfeb7045e3e5eeeaf67546b58964f4adcc7/plugins/techdocs/src/api.ts#L33",children:"TechDocsStorageApi"}),",\nwhich is responsible for talking to TechDocs storage to fetch files to render,\nand\n",(0,o.jsx)(n.a,{href:"https://github.com/backstage/backstage/blob/55114cfeb7045e3e5eeeaf67546b58964f4adcc7/plugins/techdocs/src/api.ts#L49",children:"TechDocsApi"}),",\nwhich is responsible for talking to techdocs-backend."]}),"\n",(0,o.jsx)(n.p,{children:"There may be occasions where you need to implement these two APIs yourself, to\ncustomize them to your own needs. The purpose of this guide is to walk you\nthrough how to do that in two steps."}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Implement the ",(0,o.jsx)(n.code,{children:"TechDocsStorageApi"})," and ",(0,o.jsx)(n.code,{children:"TechDocsApi"})," interfaces according to\nyour needs."]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"export class TechDocsCustomStorageApi implements TechDocsStorageApi {\n  // your implementation\n}\n\nexport class TechDocsCustomApiClient implements TechDocsApi {\n  // your implementation\n}\n"})}),"\n",(0,o.jsxs)(n.ol,{start:"2",children:["\n",(0,o.jsxs)(n.li,{children:["Override the API refs ",(0,o.jsx)(n.code,{children:"techdocsStorageApiRef"})," and ",(0,o.jsx)(n.code,{children:"techdocsApiRef"})," with your\nnew implemented APIs in the ",(0,o.jsx)(n.code,{children:"App.tsx"})," using ",(0,o.jsx)(n.code,{children:"ApiFactories"}),".\n",(0,o.jsx)(n.a,{href:"https://backstage.io/docs/api/utility-apis#app-apis",children:"Read more about App APIs"}),"."]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"const app = createApp({\n  apis: [\n    // TechDocsStorageApi\n    createApiFactory({\n      api: techdocsStorageApiRef,\n      deps: { discoveryApi: discoveryApiRef, configApi: configApiRef },\n      factory({ discoveryApi, configApi }) {\n        return new TechDocsCustomStorageApi({ discoveryApi, configApi });\n      },\n    }),\n    // TechDocsApi\n    createApiFactory({\n      api: techdocsApiRef,\n      deps: { discoveryApi: discoveryApiRef },\n      factory({ discoveryApi }) {\n        return new TechDocsCustomApiClient({ discoveryApi });\n      },\n    }),\n  ],\n});\n"})}),"\n",(0,o.jsx)(n.h2,{id:"how-to-add-the-documentation-setup-to-your-software-templates",children:"How to add the documentation setup to your software templates"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.a,{href:"https://backstage.io/docs/features/software-templates/",children:"Software Templates"}),"\nin Backstage is a tool that can help your users to create new components out of\nalready configured templates. It comes with a set of default templates to use,\nbut you can also\n",(0,o.jsx)(n.a,{href:"https://backstage.io/docs/features/software-templates/adding-templates",children:"add your own templates"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"If you have your own templates set up, we highly recommend that you include the\nrequired setup for TechDocs in those templates. When creating a new component,\nyour users will then get a TechDocs site up and running automatically, ready for\nthem to start writing technical documentation."}),"\n",(0,o.jsxs)(n.p,{children:["The purpose of this how-to guide is to walk you through how to add the required\nconfiguration and some default markdown files to your new template. You can use\nthe\n",(0,o.jsx)(n.a,{href:"https://github.com/backstage/software-templates/tree/main/scaffolder-templates/react-ssr-template",children:"react-ssr-template"}),"\nas a reference when walking through the steps."]}),"\n",(0,o.jsx)(n.p,{children:"Prerequisites:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["An existing software template including a ",(0,o.jsx)(n.code,{children:"template.yaml"})," together with a\nskeleton folder including at least a ",(0,o.jsx)(n.code,{children:"catalog-info.yaml"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Update your component's entity description by adding the following lines to\nthe ",(0,o.jsx)(n.code,{children:"catalog-info.yaml"})," in your skeleton folder."]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"annotations:\n  backstage.io/techdocs-ref: dir:.\n"})}),"\n",(0,o.jsxs)(n.p,{children:["The\n",(0,o.jsxs)(n.a,{href:"/docs/features/software-catalog/well-known-annotations#backstageiotechdocs-ref",children:[(0,o.jsx)(n.code,{children:"backstage.io/techdocs-ref"})," annotation"]}),"\nis used by TechDocs to download the documentation source files for generating an\nentity's TechDocs site."]}),"\n",(0,o.jsxs)(n.ol,{start:"2",children:["\n",(0,o.jsxs)(n.li,{children:["Create an ",(0,o.jsx)(n.code,{children:"mkdocs.yml"})," file in the root of your skeleton folder with the\nfollowing content:"]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"site_name: ${{values.component_id}}\nsite_description: ${{values.description}}\n\nnav:\n  - Introduction: index.md\n\nplugins:\n  - techdocs-core\n"})}),"\n",(0,o.jsxs)(n.ol,{start:"3",children:["\n",(0,o.jsxs)(n.li,{children:["Create a ",(0,o.jsx)(n.code,{children:"/docs"})," folder in the skeleton folder with at least an ",(0,o.jsx)(n.code,{children:"index.md"}),"\nfile in it."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"docs/index.md"})," can for example have the following content:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-markdown",children:"# ${{ values.component_id }}\n\n${{ values.description }}\n\n## Getting started\n\nStart writing your documentation by adding more markdown (.md) files to this\nfolder (/docs) or replace the content in this file.\n"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["Note: The values of ",(0,o.jsx)(n.code,{children:"site_name"}),", ",(0,o.jsx)(n.code,{children:"component_id"})," and ",(0,o.jsx)(n.code,{children:"site_description"})," depends\non how you have configured your ",(0,o.jsx)(n.code,{children:"template.yaml"})]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Done! You now have support for TechDocs in your own software template!"}),"\n",(0,o.jsx)(n.h3,{id:"prevent-download-of-google-fonts",children:"Prevent download of Google fonts"}),"\n",(0,o.jsx)(n.p,{children:"If your Backstage instance does not have internet access, the generation will fail. TechDocs tries to download the Roboto font from Google. You can disable it by adding the following lines to mkdocs.yaml:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"theme:\n  name: material\n  font: false\n"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["Note: The addition ",(0,o.jsx)(n.code,{children:"name: material"})," is necessary. Otherwise it will not work"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"how-to-enable-iframes-in-techdocs",children:"How to enable iframes in TechDocs"}),"\n",(0,o.jsxs)(n.p,{children:["TechDocs uses the ",(0,o.jsx)(n.a,{href:"https://github.com/cure53/DOMPurify",children:"DOMPurify"})," library to\nsanitize HTML and prevent XSS attacks."]}),"\n",(0,o.jsxs)(n.p,{children:["It's possible to allow some iframes based on a list of allowed hosts. To do\nthis, add the allowed hosts in the ",(0,o.jsx)(n.code,{children:"techdocs.sanitizer.allowedIframeHosts"}),"\nconfiguration of your ",(0,o.jsx)(n.code,{children:"app-config.yaml"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"For example:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"techdocs:\n  sanitizer:\n    allowedIframeHosts:\n      - drive.google.com\n"})}),"\n",(0,o.jsxs)(n.p,{children:["This way, all iframes where the host in the src attribute is in the\n",(0,o.jsx)(n.code,{children:"sanitizer.allowedIframeHosts"})," list will be displayed."]}),"\n",(0,o.jsx)(n.h2,{id:"how-to-render-plantuml-diagram-in-techdocs",children:"How to render PlantUML diagram in TechDocs"}),"\n",(0,o.jsxs)(n.p,{children:["PlantUML allows you to create diagrams from plain text language. Each diagram description begins with the keyword - (@startXYZ and @endXYZ, depending on the kind of diagram). For UML Diagrams, Keywords @startuml & @enduml should be used. Further details for all types of diagrams can be found at ",(0,o.jsx)(n.a,{href:"https://plantuml.com/guide",children:"PlantUML Language Reference Guide"}),"."]}),"\n",(0,o.jsx)(n.h3,{id:"uml-diagram-details-",children:"UML Diagram Details:-"}),"\n",(0,o.jsx)(n.h4,{id:"embedded-plantuml-diagram-example",children:"Embedded PlantUML Diagram Example"}),"\n",(0,o.jsx)(n.p,{children:"Here, the markdown file itself contains the diagram description."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-md",children:"```plantuml\n@startuml\ntitle Login Sequence\n    ComponentA->ComponentB: Login Request\n    note right of ComponentB: ComponentB logs message\n    ComponentB->ComponentA: Login Response\n@enduml\n```\n"})}),"\n",(0,o.jsx)(n.h4,{id:"referenced-plantuml-diagram-example",children:"Referenced PlantUML Diagram Example"}),"\n",(0,o.jsxs)(n.p,{children:["Here, the markdown file refers to another file (",(0,o.jsx)(n.code,{children:"*.puml"})," or ",(0,o.jsx)(n.code,{children:"*.pu"}),") which contains the diagram description."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-md",children:"```plantuml\n!include umldiagram.puml\n```\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Note: To refer external diagram files, we need to include the diagrams directory in the path. Please refer ",(0,o.jsx)(n.a,{href:"https://github.com/backstage/techdocs-container/blob/main/Dockerfile",children:(0,o.jsx)(n.code,{children:"Dockerfile"})})," for details."]}),"\n",(0,o.jsx)(n.h2,{id:"how-to-add-mermaid-support-in-techdocs",children:"How to add Mermaid support in TechDocs"}),"\n",(0,o.jsxs)(n.p,{children:["To add ",(0,o.jsx)(n.code,{children:"Mermaid"})," support in TechDocs, you can use ",(0,o.jsx)(n.a,{href:"https://kroki.io",children:(0,o.jsx)(n.code,{children:"kroki"})}),"\nthat creates diagrams from Textual descriptions. It is a single rendering\ngateway for all popular diagrams-as-a-code tools. It supports an enormous number\nof diagram types."]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Create and Publish Docker image:"})," Create the Docker image from the\nfollowing ",(0,o.jsx)(n.code,{children:"Dockerfile"})," and publish it to DockerHub."]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-docker",children:'FROM python:3.10-alpine\n\nRUN apk update && apk --no-cache add gcc musl-dev openjdk11-jdk curl graphviz ttf-dejavu fontconfig\n\nRUN pip install --upgrade pip && pip install mkdocs-techdocs-core==1.2.0\n\nRUN pip install mkdocs-kroki-plugin\n\nENTRYPOINT [ "mkdocs" ]\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Create a repository in your DockerHub and run the below command in the same\nfolder where your ",(0,o.jsx)(n.code,{children:"Dockerfile"})," is present:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"docker build . -t dockerHub_Username/repositoryName:tagName\n"})}),"\n",(0,o.jsx)(n.p,{children:"Once the docker image is ready, push it to DockerHub."}),"\n",(0,o.jsxs)(n.ol,{start:"2",children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Update app-config.yaml:"})," So that when your app generates TechDocs, it will\npull your docker image from DockerHub."]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"techdocs:\n  builder: 'local' # Alternatives - 'external'\n  generator:\n    runIn: 'docker' # Alternatives - 'local'\n    dockerImage: dockerHub_Username/repositoryName:tagName\n    pullImage: true\n  publisher:\n    type: 'local' # Alternatives - 'googleGcs' or 'awsS3'. Read documentation for using alternatives.\n"})}),"\n",(0,o.jsxs)(n.ol,{start:"3",children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsxs)(n.strong,{children:["Add the ",(0,o.jsx)(n.code,{children:"kroki"})," plugin in ",(0,o.jsx)(n.code,{children:"mkdocs.yml"}),":"]})}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yml",children:"plugins:\n  - techdocs-core\n  - kroki\n"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["Note: you will very likely want to set a ",(0,o.jsx)(n.code,{children:"kroki"})," ",(0,o.jsx)(n.code,{children:"ServerURL"})," configuration in your\n",(0,o.jsx)(n.code,{children:"mkdocs.yml"})," as well. The default value is the publicly hosted ",(0,o.jsx)(n.code,{children:"kroki.io"}),". If\nyou have sensitive information in your organization's diagrams, you should set\nup a ",(0,o.jsx)(n.a,{href:"https://docs.kroki.io/kroki/setup/install/",children:"server of your own"})," and use it\ninstead. Check out ",(0,o.jsx)(n.a,{href:"https://github.com/AVATEAM-IT-SYSTEMHAUS/mkdocs-kroki-plugin#config",children:"mkdocs-kroki-plugin config"}),"\nfor more plugin configuration details."]}),"\n"]}),"\n",(0,o.jsxs)(n.ol,{start:"4",children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.strong,{children:"Add mermaid code into TechDocs:"})}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-md",children:"```kroki-mermaid\nsequenceDiagram\nGitLab->>Kroki: Request rendering\nKroki->>Mermaid: Request rendering\nMermaid--\x3e>Kroki: Image\nKroki--\x3e>GitLab: Image\n```\n"})}),"\n",(0,o.jsx)(n.p,{children:"Done! Now you have a support of the following diagrams along with mermaid:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"PlantUML"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"BlockDiag"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"BPMN"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"ByteField"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"SeqDiag"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"ActDiag"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"NwDiag"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"PacketDiag"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"RackDiag"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"C4 with PlantUML"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"Ditaa"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"Erd"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"Excalidraw"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"GraphViz"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"Nomnoml"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"Pikchr"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"Svgbob"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"UMlet"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"Vega"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"Vega-Lite"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"WaveDrom"})}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"how-to-implement-a-hybrid-build-strategy",children:"How to implement a hybrid build strategy"}),"\n",(0,o.jsxs)(n.p,{children:["One limitation of the ",(0,o.jsx)(n.a,{href:"/docs/features/techdocs/architecture#recommended-deployment",children:"Recommended deployment"})," is that\nthe experience for users requires modifying their CI/CD process to publish\ntheir TechDocs. For some users, this may be unnecessary, and provides a barrier\nto entry for onboarding users to Backstage. However, a purely local TechDocs\nbuild restricts TechDocs creators to using the tooling provided in Backstage,\nas well as the plugins and features provided in the Backstage-included ",(0,o.jsx)(n.code,{children:"mkdocs"}),"\ninstallation."]}),"\n",(0,o.jsxs)(n.p,{children:["To accommodate both of these use-cases, users can implement a custom ",(0,o.jsx)(n.a,{href:"/docs/features/techdocs/concepts#techdocs-build-strategy",children:"Build Strategy"}),"\nwith logic to encode which TechDocs should be built locally, and which will be\nbuilt externally."]}),"\n",(0,o.jsx)(n.p,{children:"To achieve this hybrid build model:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["In your Backstage instance's ",(0,o.jsx)(n.code,{children:"app-config.yaml"}),", set ",(0,o.jsx)(n.code,{children:"techdocs.builder"})," to\n",(0,o.jsx)(n.code,{children:"'local'"}),". This ensures that Backstage will build docs for users who want the\n'out-of-the-box' experience."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Configure external storage of TechDocs as normal for a production deployment.\nThis allows Backstage to publish documentation to your storage, as well as\nallowing other users to publish documentation from their CI/CD pipelines."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Create a custom build strategy, that implements the ",(0,o.jsx)(n.code,{children:"DocsBuildStrategy"})," interface,\nand which implements your custom logic for determining whether to build docs for\na given entity.\nFor example, to only build docs when an entity has the ",(0,o.jsx)(n.code,{children:"company.com/techdocs-builder"}),"\nannotation set to ",(0,o.jsx)(n.code,{children:"'local'"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"export class AnnotationBasedBuildStrategy {\n  private readonly config: Config;\n\n  constructor(config: Config) {\n    this.config = config;\n  }\n\n  async shouldBuild(_: Entity): Promise<boolean> {\n    return (\n      this.entity.metadata?.annotations?.['company.com/techdocs-builder'] ===\n      'local'\n    );\n  }\n}\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Pass an instance of this Build Strategy as the ",(0,o.jsx)(n.code,{children:"docsBuildStrategy"})," parameter of the\nTechDocs backend ",(0,o.jsx)(n.code,{children:"createRouter"})," method."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Users should now be able to choose to have their documentation built and published by\nthe TechDocs backend by adding the ",(0,o.jsx)(n.code,{children:"company.com/techdocs-builder"})," annotation to their\nentity. If the value of this annotation is ",(0,o.jsx)(n.code,{children:"'local'"}),", the TechDocs backend will build\nand publish the documentation for them. If the value of the ",(0,o.jsx)(n.code,{children:"company.com/techdocs-builder"}),"\nannotation is anything other than ",(0,o.jsx)(n.code,{children:"'local'"}),", the user is responsible for publishing\ndocumentation to the appropriate location in the TechDocs external storage."]}),"\n",(0,o.jsx)(n.h2,{id:"how-to-use-other-mkdocs-plugins",children:"How to use other mkdocs plugins?"}),"\n",(0,o.jsxs)(n.p,{children:["The default plugin ",(0,o.jsx)(n.a,{href:"https://github.com/backstage/mkdocs-techdocs-core",children:"mkdocs-techdocs-core"})," provides a set of plugins that can be viewed as the minimum required plugins to enable TechDocs. Your organization might have needs beyond the core set though, here is the recommended way to enable other plugins."]}),"\n",(0,o.jsx)(n.h3,{id:"install-the-plugin",children:"Install the plugin"}),"\n",(0,o.jsx)(n.h4,{id:"with-ci-generation",children:"With CI generation"}),"\n",(0,o.jsxs)(n.p,{children:["If you generate the HTML files in CI using ",(0,o.jsx)(n.code,{children:"@techdocs/cli"}),", you need to install the desired mkdocs plugin in the runtime where the cli is being executed. This might be e.g. a docker image or a Jenkins node. Use the ",(0,o.jsx)(n.code,{children:"--no-docker"})," flag with the cli to pick up the plugin you just installed."]}),"\n",(0,o.jsx)(n.h4,{id:"with-local-generation",children:"With local generation"}),"\n",(0,o.jsxs)(n.p,{children:["Create a new Docker image that extends ",(0,o.jsx)(n.a,{href:"https://github.com/backstage/techdocs-container",children:"spotify/techdocs"}),", roughly:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-Dockerfile",children:"FROM spotify/techdocs:<version>\n\npip install <the_plugin_you_want>\n...\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Then publish the image and use it in your config under the ",(0,o.jsx)(n.code,{children:"techdocs.generator.dockerImage"})," ",(0,o.jsx)(n.a,{href:"https://github.com/backstage/techdocs-container",children:"key"}),"."]}),"\n",(0,o.jsx)(n.h3,{id:"specify-the-plugin-in-the-mkdocs-config",children:"Specify the plugin in the mkdocs config"}),"\n",(0,o.jsxs)(n.p,{children:["To use the plugin, it has to be listed in the ",(0,o.jsx)(n.code,{children:"mkdocs.yaml"})," file. You can either add the plugin to your applicable files, or specify defaults."]}),"\n",(0,o.jsxs)(n.p,{children:["To make a mkdocs plugin available for all your TechDocs components you can either list it in the ",(0,o.jsx)(n.code,{children:"techdocs.generator.mkdocs.defaultPlugins"})," ",(0,o.jsx)(n.a,{href:"https://github.com/backstage/backstage/blob/master/plugins/techdocs-backend/config.d.ts#L64C14-L64C14",children:"config"}),", or use the ",(0,o.jsx)(n.code,{children:"--defaultPlugin"})," ",(0,o.jsx)(n.a,{href:"https://backstage.io/docs/features/techdocs/cli#generate-techdocs-site-from-a-documentation-project",children:"cli option"})," depending on your setup."]}),"\n",(0,o.jsx)(n.h2,{id:"reference-another-components-techdocs",children:"Reference another components TechDocs"}),"\n",(0,o.jsx)(n.p,{children:"In systems where you might have multiple entities for example a System with a Website and an API, when served from a Monorepo you might want to keep the TechDocs in one location in the repository."}),"\n",(0,o.jsxs)(n.p,{children:["In this case you can add the ",(0,o.jsx)(n.code,{children:"backstage.io/techdocs-entity"})," annotation and point to the owners ",(0,o.jsx)(n.code,{children:"entityRef"})," and use its TechDocs. This allows the Subcomponents to read the parents docs, filling the TechDocs link on the ",(0,o.jsx)(n.code,{children:"AboutCard"})," element and the Techdocs tab"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"apiVersion: backstage.io/v1alpha1\nkind: System\nmetadata:\n  name: example\n  namespace: default\n  title: Example\n  description: This is the parent entity\n  annotations:\n    backstage.io/techdocs-ref: dir:.\n\n---\napiVersion: backstage.io/v1alpha1\nkind: Component\nmetadata:\n  name: example-platfrom\n  title: Example Application Platform\n  namespace: default\n  description: This is the child entity\n  annotations:\n    backstage.io/techdocs-entity: system:default/example\n"})})]})}function h(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},371426:(e,n,t)=>{var o=t(827378),s=Symbol.for("react.element"),i=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,c=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function l(e,n,t){var o,i={},l=null,d=null;for(o in void 0!==t&&(l=""+t),void 0!==n.key&&(l=""+n.key),void 0!==n.ref&&(d=n.ref),n)r.call(n,o)&&!a.hasOwnProperty(o)&&(i[o]=n[o]);if(e&&e.defaultProps)for(o in n=e.defaultProps)void 0===i[o]&&(i[o]=n[o]);return{$$typeof:s,type:e,key:l,ref:d,props:i,_owner:c.current}}n.Fragment=i,n.jsx=l,n.jsxs=l},541535:(e,n)=>{var t=Symbol.for("react.element"),o=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),c=Symbol.for("react.provider"),a=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),p=Symbol.iterator;var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,f={};function x(e,n,t){this.props=e,this.context=n,this.refs=f,this.updater=t||m}function y(){}function j(e,n,t){this.props=e,this.context=n,this.refs=f,this.updater=t||m}x.prototype.isReactComponent={},x.prototype.setState=function(e,n){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,n,"setState")},x.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=x.prototype;var b=j.prototype=new y;b.constructor=j,g(b,x.prototype),b.isPureReactComponent=!0;var w=Array.isArray,k=Object.prototype.hasOwnProperty,v={current:null},T={key:!0,ref:!0,__self:!0,__source:!0};function D(e,n,o){var s,i={},r=null,c=null;if(null!=n)for(s in void 0!==n.ref&&(c=n.ref),void 0!==n.key&&(r=""+n.key),n)k.call(n,s)&&!T.hasOwnProperty(s)&&(i[s]=n[s]);var a=arguments.length-2;if(1===a)i.children=o;else if(1<a){for(var l=Array(a),d=0;d<a;d++)l[d]=arguments[d+2];i.children=l}if(e&&e.defaultProps)for(s in a=e.defaultProps)void 0===i[s]&&(i[s]=a[s]);return{$$typeof:t,type:e,key:r,ref:c,props:i,_owner:v.current}}function C(e){return"object"==typeof e&&null!==e&&e.$$typeof===t}var P=/\/+/g;function R(e,n){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var n={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return n[e]}))}(""+e.key):n.toString(36)}function A(e,n,s,i,r){var c=typeof e;"undefined"!==c&&"boolean"!==c||(e=null);var a=!1;if(null===e)a=!0;else switch(c){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case t:case o:a=!0}}if(a)return r=r(a=e),e=""===i?"."+R(a,0):i,w(r)?(s="",null!=e&&(s=e.replace(P,"$&/")+"/"),A(r,n,s,"",(function(e){return e}))):null!=r&&(C(r)&&(r=function(e,n){return{$$typeof:t,type:e.type,key:n,ref:e.ref,props:e.props,_owner:e._owner}}(r,s+(!r.key||a&&a.key===r.key?"":(""+r.key).replace(P,"$&/")+"/")+e)),n.push(r)),1;if(a=0,i=""===i?".":i+":",w(e))for(var l=0;l<e.length;l++){var d=i+R(c=e[l],l);a+=A(c,n,s,d,r)}else if(d=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"==typeof d)for(e=d.call(e),l=0;!(c=e.next()).done;)a+=A(c=c.value,n,s,d=i+R(c,l++),r);else if("object"===c)throw n=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===n?"object with keys {"+Object.keys(e).join(", ")+"}":n)+"). If you meant to render a collection of children, use an array instead.");return a}function _(e,n,t){if(null==e)return e;var o=[],s=0;return A(e,o,"","",(function(e){return n.call(t,e,s++)})),o}function I(e){if(-1===e._status){var n=e._result;(n=n()).then((function(n){0!==e._status&&-1!==e._status||(e._status=1,e._result=n)}),(function(n){0!==e._status&&-1!==e._status||(e._status=2,e._result=n)})),-1===e._status&&(e._status=0,e._result=n)}if(1===e._status)return e._result.default;throw e._result}var S={current:null},H={transition:null},L={ReactCurrentDispatcher:S,ReactCurrentBatchConfig:H,ReactCurrentOwner:v};n.Children={map:_,forEach:function(e,n,t){_(e,(function(){n.apply(this,arguments)}),t)},count:function(e){var n=0;return _(e,(function(){n++})),n},toArray:function(e){return _(e,(function(e){return e}))||[]},only:function(e){if(!C(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},n.Component=x,n.Fragment=s,n.Profiler=r,n.PureComponent=j,n.StrictMode=i,n.Suspense=d,n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=L,n.cloneElement=function(e,n,o){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var s=g({},e.props),i=e.key,r=e.ref,c=e._owner;if(null!=n){if(void 0!==n.ref&&(r=n.ref,c=v.current),void 0!==n.key&&(i=""+n.key),e.type&&e.type.defaultProps)var a=e.type.defaultProps;for(l in n)k.call(n,l)&&!T.hasOwnProperty(l)&&(s[l]=void 0===n[l]&&void 0!==a?a[l]:n[l])}var l=arguments.length-2;if(1===l)s.children=o;else if(1<l){a=Array(l);for(var d=0;d<l;d++)a[d]=arguments[d+2];s.children=a}return{$$typeof:t,type:e.type,key:i,ref:r,props:s,_owner:c}},n.createContext=function(e){return(e={$$typeof:a,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:c,_context:e},e.Consumer=e},n.createElement=D,n.createFactory=function(e){var n=D.bind(null,e);return n.type=e,n},n.createRef=function(){return{current:null}},n.forwardRef=function(e){return{$$typeof:l,render:e}},n.isValidElement=C,n.lazy=function(e){return{$$typeof:u,_payload:{_status:-1,_result:e},_init:I}},n.memo=function(e,n){return{$$typeof:h,type:e,compare:void 0===n?null:n}},n.startTransition=function(e){var n=H.transition;H.transition={};try{e()}finally{H.transition=n}},n.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},n.useCallback=function(e,n){return S.current.useCallback(e,n)},n.useContext=function(e){return S.current.useContext(e)},n.useDebugValue=function(){},n.useDeferredValue=function(e){return S.current.useDeferredValue(e)},n.useEffect=function(e,n){return S.current.useEffect(e,n)},n.useId=function(){return S.current.useId()},n.useImperativeHandle=function(e,n,t){return S.current.useImperativeHandle(e,n,t)},n.useInsertionEffect=function(e,n){return S.current.useInsertionEffect(e,n)},n.useLayoutEffect=function(e,n){return S.current.useLayoutEffect(e,n)},n.useMemo=function(e,n){return S.current.useMemo(e,n)},n.useReducer=function(e,n,t){return S.current.useReducer(e,n,t)},n.useRef=function(e){return S.current.useRef(e)},n.useState=function(e){return S.current.useState(e)},n.useSyncExternalStore=function(e,n,t){return S.current.useSyncExternalStore(e,n,t)},n.useTransition=function(){return S.current.useTransition()},n.version="18.2.0"},827378:(e,n,t)=>{e.exports=t(541535)},824246:(e,n,t)=>{e.exports=t(371426)},511151:(e,n,t)=>{t.d(n,{Z:()=>c,a:()=>r});var o=t(667294);const s={},i=o.createContext(s);function r(e){const n=o.useContext(i);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);