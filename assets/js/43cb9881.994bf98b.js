/*! For license information please see 43cb9881.994bf98b.js.LICENSE.txt */
"use strict";(self.webpackChunkbackstage_microsite=self.webpackChunkbackstage_microsite||[]).push([[71858],{865569:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>a,contentTitle:()=>i,default:()=>d,frontMatter:()=>s,metadata:()=>c,toc:()=>u});var n=r(824246),o=r(511151);const s={id:"http-auth",title:"Http Auth Service",sidebar_label:"Http Auth",description:"Documentation for the Http Auth service"},i=void 0,c={id:"backend-system/core-services/http-auth",title:"Http Auth Service",description:"Documentation for the Http Auth service",source:"@site/../docs/backend-system/core-services/http-auth.md",sourceDirName:"backend-system/core-services",slug:"/backend-system/core-services/http-auth",permalink:"/docs/backend-system/core-services/http-auth",draft:!1,unlisted:!1,editUrl:"https://github.com/backstage/backstage/edit/master/docs/../docs/backend-system/core-services/http-auth.md",tags:[],version:"current",frontMatter:{id:"http-auth",title:"Http Auth Service",sidebar_label:"Http Auth",description:"Documentation for the Http Auth service"},sidebar:"docs",previous:{title:"Discovery",permalink:"/docs/backend-system/core-services/discovery"},next:{title:"Http Router",permalink:"/docs/backend-system/core-services/http-router"}},a={},u=[{value:"Using the Service",id:"using-the-service",level:2},{value:"Getting Request Credentials",id:"getting-request-credentials",level:3},{value:"Issuing Cookies",id:"issuing-cookies",level:3},{value:"Configuring the service",id:"configuring-the-service",level:2}];function l(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,o.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.code,{children:"httpAuth"})," service deals with submitting and receiving credentials on Express\nHTTP request/response objects. This service is frequently used in plugins that\nhave REST interfaces."]}),"\n",(0,n.jsxs)(t.p,{children:["If you want to deal with raw tokens and do low level credentials handling, see\nalso ",(0,n.jsxs)(t.a,{href:"/docs/backend-system/core-services/auth",children:["the ",(0,n.jsx)(t.code,{children:"auth"})," service"]}),". If you want to extract more details about\nauthenticated users such as their ownership entity refs, use ",(0,n.jsxs)(t.a,{href:"/docs/backend-system/core-services/user-info",children:["the ",(0,n.jsx)(t.code,{children:"userInfo"})," service"]}),"."]}),"\n",(0,n.jsx)(t.h2,{id:"using-the-service",children:"Using the Service"}),"\n",(0,n.jsxs)(t.p,{children:["In the following code examples, the ",(0,n.jsx)(t.code,{children:"auth"})," and ",(0,n.jsx)(t.code,{children:"httpAuth"})," variables are assumed\nto be dependency-injected instances of the ",(0,n.jsx)(t.code,{children:"coreServices.auth"})," and\n",(0,n.jsx)(t.code,{children:"coreServices.httpAuth"})," service, respectively. For a backend plugin, it might\nlook like this:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-ts",children:"export default createBackendPlugin({\n  pluginId: 'my-plugin',\n  register(env) {\n    env.registerInit({\n      deps: {\n        auth: coreServices.auth,\n        httpAuth: coreServices.httpAuth,\n        httpRouter: coreServices.httpRouter,\n      },\n      async init({ auth, httpAuth, httpRouter }) {\n        // Your code goes here\n      },\n    });\n  },\n});\n"})}),"\n",(0,n.jsx)(t.h3,{id:"getting-request-credentials",children:"Getting Request Credentials"}),"\n",(0,n.jsx)(t.p,{children:"If you need to extract the validated credentials out of an incoming request, you\ncan do so like this:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-ts",children:"router.get('/some-request', async (req, res) => {\n  const credentials = await httpAuth.credentials(req, { allow: ['user'] });\n  // Do something with the credentials here\n"})}),"\n",(0,n.jsxs)(t.p,{children:["The second argument is optional, but in this example we specified that we only\nwant to allow user based requests. The credentials returned will then have a\nnarrowed TypeScript type that reflects that the principal is known to be of the\nuser type. This second argument can also specify ",(0,n.jsx)(t.code,{children:"allowLimitedAccess: true"})," if\nyou specifically built a plugin that deals with cookie based access, which is\nrare."]}),"\n",(0,n.jsx)(t.p,{children:"The default is to accept both service and user credentials (excluding limited\naccess), but in the example above, any attempt to call this endpoint with\nservice credentials will result in an Unauthorized error being thrown."}),"\n",(0,n.jsx)(t.admonition,{title:"Note",type:"note",children:(0,n.jsxs)(t.p,{children:["You don't need to call ",(0,n.jsx)(t.code,{children:"httpAuth.credentials"})," ",(0,n.jsx)(t.em,{children:"just"})," to ensure that incoming\ncredentials are valid in the first place; only use this method if you actually\nneed to act upon the credentials somehow. The Backstage backend framework will have\nensured the actual validity of any incoming token before your backend code is\nreached. The policy for these upfront framework level rules is controlled using\n",(0,n.jsxs)(t.a,{href:"/docs/backend-system/core-services/http-router",children:["the ",(0,n.jsx)(t.code,{children:"httpRouter"})," service"]})," when you register your routes."]})}),"\n",(0,n.jsxs)(t.p,{children:["If you want to further work with the credentials object, ",(0,n.jsxs)(t.a,{href:"/docs/backend-system/core-services/auth",children:["the ",(0,n.jsx)(t.code,{children:"auth"})," service"]}),"\nhas helper methods for that."]}),"\n",(0,n.jsx)(t.h3,{id:"issuing-cookies",children:"Issuing Cookies"}),"\n",(0,n.jsxs)(t.p,{children:["For some rare use cases, plugins may want to issue cookies with ",(0,n.jsx)(t.em,{children:"limited access"}),"\nuser credentials. This is mostly relevant when browsers need to be able to\nrequest static resources, such as in the TechDocs plugin."]}),"\n",(0,n.jsxs)(t.p,{children:["Plugins should almost never interact with the cookie functionality of the\n",(0,n.jsx)(t.code,{children:"httpAuth"})," service directly. The framework has builtin handling of cookie\ncreation/deletion requests on a dedicated well-known endpoint. All you normally\nhave to do to accept limited user access is to inform ",(0,n.jsxs)(t.a,{href:"/docs/backend-system/core-services/http-router",children:["the ",(0,n.jsx)(t.code,{children:"httpRouter"})," service"]}),"\nwhen creating your route that you want to permit\ncookie based access for a specific route, and then setting ",(0,n.jsx)(t.code,{children:"allowLimitedAccess"}),"\nto ",(0,n.jsx)(t.code,{children:"true"})," when extracting credentials."]}),"\n",(0,n.jsxs)(t.p,{children:["Due to the above, we do not document the ",(0,n.jsx)(t.code,{children:"httpAuth.issueUserCookie"})," method here."]}),"\n",(0,n.jsx)(t.h2,{id:"configuring-the-service",children:"Configuring the service"}),"\n",(0,n.jsx)(t.admonition,{title:"Note",type:"note",children:(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.code,{children:"httpAuth"})," service is not suitable for having its implementation replaced\nentirely in your private repo. If you desire additional service auth related\nfeatures, don't hesitate to ",(0,n.jsx)(t.a,{href:"https://github.com/backstage/backstage/issues/new/choose",children:"file an issue"}),"\nor ",(0,n.jsx)(t.a,{href:"https://github.com/backstage/backstage/blob/master/CONTRIBUTING.md",children:"contribute"})," to the open source features."]})}),"\n",(0,n.jsxs)(t.p,{children:["This service has no configuration options, but it abides by the policies you\nhave set up using ",(0,n.jsxs)(t.a,{href:"/docs/backend-system/core-services/http-router",children:["the ",(0,n.jsx)(t.code,{children:"httpRouter"})," service"]})," for your routes,\nif any."]})]})}function d(e={}){const{wrapper:t}={...(0,o.a)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}},371426:(e,t,r)=>{var n=r(827378),o=Symbol.for("react.element"),s=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,c=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function u(e,t,r){var n,s={},u=null,l=null;for(n in void 0!==r&&(u=""+r),void 0!==t.key&&(u=""+t.key),void 0!==t.ref&&(l=t.ref),t)i.call(t,n)&&!a.hasOwnProperty(n)&&(s[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===s[n]&&(s[n]=t[n]);return{$$typeof:o,type:e,key:u,ref:l,props:s,_owner:c.current}}t.Fragment=s,t.jsx=u,t.jsxs=u},541535:(e,t)=>{var r=Symbol.for("react.element"),n=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),c=Symbol.for("react.provider"),a=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),f=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,m={};function v(e,t,r){this.props=e,this.context=t,this.refs=m,this.updater=r||p}function b(){}function g(e,t,r){this.props=e,this.context=t,this.refs=m,this.updater=r||p}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=v.prototype;var x=g.prototype=new b;x.constructor=g,y(x,v.prototype),x.isPureReactComponent=!0;var k=Array.isArray,j=Object.prototype.hasOwnProperty,w={current:null},_={key:!0,ref:!0,__self:!0,__source:!0};function S(e,t,n){var o,s={},i=null,c=null;if(null!=t)for(o in void 0!==t.ref&&(c=t.ref),void 0!==t.key&&(i=""+t.key),t)j.call(t,o)&&!_.hasOwnProperty(o)&&(s[o]=t[o]);var a=arguments.length-2;if(1===a)s.children=n;else if(1<a){for(var u=Array(a),l=0;l<a;l++)u[l]=arguments[l+2];s.children=u}if(e&&e.defaultProps)for(o in a=e.defaultProps)void 0===s[o]&&(s[o]=a[o]);return{$$typeof:r,type:e,key:i,ref:c,props:s,_owner:w.current}}function R(e){return"object"==typeof e&&null!==e&&e.$$typeof===r}var C=/\/+/g;function E(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function T(e,t,o,s,i){var c=typeof e;"undefined"!==c&&"boolean"!==c||(e=null);var a=!1;if(null===e)a=!0;else switch(c){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case r:case n:a=!0}}if(a)return i=i(a=e),e=""===s?"."+E(a,0):s,k(i)?(o="",null!=e&&(o=e.replace(C,"$&/")+"/"),T(i,t,o,"",(function(e){return e}))):null!=i&&(R(i)&&(i=function(e,t){return{$$typeof:r,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(i,o+(!i.key||a&&a.key===i.key?"":(""+i.key).replace(C,"$&/")+"/")+e)),t.push(i)),1;if(a=0,s=""===s?".":s+":",k(e))for(var u=0;u<e.length;u++){var l=s+E(c=e[u],u);a+=T(c,t,o,l,i)}else if(l=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"==typeof l)for(e=l.call(e),u=0;!(c=e.next()).done;)a+=T(c=c.value,t,o,l=s+E(c,u++),i);else if("object"===c)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return a}function A(e,t,r){if(null==e)return e;var n=[],o=0;return T(e,n,"","",(function(e){return t.call(r,e,o++)})),n}function I(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var $={current:null},O={transition:null},P={ReactCurrentDispatcher:$,ReactCurrentBatchConfig:O,ReactCurrentOwner:w};t.Children={map:A,forEach:function(e,t,r){A(e,(function(){t.apply(this,arguments)}),r)},count:function(e){var t=0;return A(e,(function(){t++})),t},toArray:function(e){return A(e,(function(e){return e}))||[]},only:function(e){if(!R(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=o,t.Profiler=i,t.PureComponent=g,t.StrictMode=s,t.Suspense=l,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=P,t.cloneElement=function(e,t,n){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var o=y({},e.props),s=e.key,i=e.ref,c=e._owner;if(null!=t){if(void 0!==t.ref&&(i=t.ref,c=w.current),void 0!==t.key&&(s=""+t.key),e.type&&e.type.defaultProps)var a=e.type.defaultProps;for(u in t)j.call(t,u)&&!_.hasOwnProperty(u)&&(o[u]=void 0===t[u]&&void 0!==a?a[u]:t[u])}var u=arguments.length-2;if(1===u)o.children=n;else if(1<u){a=Array(u);for(var l=0;l<u;l++)a[l]=arguments[l+2];o.children=a}return{$$typeof:r,type:e.type,key:s,ref:i,props:o,_owner:c}},t.createContext=function(e){return(e={$$typeof:a,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:c,_context:e},e.Consumer=e},t.createElement=S,t.createFactory=function(e){var t=S.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:u,render:e}},t.isValidElement=R,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:I}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=O.transition;O.transition={};try{e()}finally{O.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return $.current.useCallback(e,t)},t.useContext=function(e){return $.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return $.current.useDeferredValue(e)},t.useEffect=function(e,t){return $.current.useEffect(e,t)},t.useId=function(){return $.current.useId()},t.useImperativeHandle=function(e,t,r){return $.current.useImperativeHandle(e,t,r)},t.useInsertionEffect=function(e,t){return $.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return $.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return $.current.useMemo(e,t)},t.useReducer=function(e,t,r){return $.current.useReducer(e,t,r)},t.useRef=function(e){return $.current.useRef(e)},t.useState=function(e){return $.current.useState(e)},t.useSyncExternalStore=function(e,t,r){return $.current.useSyncExternalStore(e,t,r)},t.useTransition=function(){return $.current.useTransition()},t.version="18.2.0"},827378:(e,t,r)=>{e.exports=r(541535)},824246:(e,t,r)=>{e.exports=r(371426)},511151:(e,t,r)=>{r.d(t,{Z:()=>c,a:()=>i});var n=r(667294);const o={},s=n.createContext(o);function i(e){const t=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),n.createElement(s.Provider,{value:t},e.children)}}}]);