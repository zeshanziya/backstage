/*! For license information please see 334af791.66f6698e.js.LICENSE.txt */
"use strict";(self.webpackChunkbackstage_microsite=self.webpackChunkbackstage_microsite||[]).push([[478638],{114865:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>l});var r=n(824246),o=n(511151);const i={id:"discovery",title:"GitLab Discovery",sidebar_label:"Discovery",description:"Automatically discovering catalog entities from repositories in GitLab"},a=void 0,s={id:"integrations/gitlab/discovery",title:"GitLab Discovery",description:"Automatically discovering catalog entities from repositories in GitLab",source:"@site/../docs/integrations/gitlab/discovery.md",sourceDirName:"integrations/gitlab",slug:"/integrations/gitlab/discovery",permalink:"/docs/integrations/gitlab/discovery",draft:!1,unlisted:!1,editUrl:"https://github.com/backstage/backstage/edit/master/docs/../docs/integrations/gitlab/discovery.md",tags:[],version:"current",frontMatter:{id:"discovery",title:"GitLab Discovery",sidebar_label:"Discovery",description:"Automatically discovering catalog entities from repositories in GitLab"},sidebar:"docs",previous:{title:"Locations",permalink:"/docs/integrations/gitlab/locations"},next:{title:"Org Data",permalink:"/docs/integrations/gitlab/org"}},c={},l=[{value:"Alternative processor",id:"alternative-processor",level:2}];function u(e){const t=Object.assign({p:"p",a:"a",code:"code",pre:"pre",h2:"h2",ul:"ul",li:"li"},(0,o.ah)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.p,{children:"The GitLab integration has a special entity provider for discovering catalog\nentities from GitLab. The entity provider will crawl the GitLab instance and register\nentities matching the configured paths. This can be useful as an alternative to\nstatic locations or manually adding things to the catalog."}),"\n",(0,r.jsxs)(t.p,{children:["To use the discovery provider, you'll need a GitLab integration\n",(0,r.jsx)(t.a,{href:"/docs/integrations/gitlab/locations",children:"set up"})," with a ",(0,r.jsx)(t.code,{children:"token"}),". Then you can add a provider config per group\nto the catalog configuration:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:'catalog:\n  providers:\n    gitlab:\n      yourProviderId:\n        host: gitlab-host # Identifies one of the hosts set up in the integrations\n        branch: main # Optional. Used to discover on a specific branch\n        fallbackBranch: main # Optional. Fallback to be used if there is no default branch configured at the Gitlab repository. It is only used, if `branch` is undefined. Uses `master` as default\n        skipForkedRepos: false # Optional. If the project is a fork, skip repository\n        group: example-group # Optional. Group and subgroup (if needed) to look for repositories. If not present the whole instance will be scanned\n        entityFilename: catalog-info.yaml # Optional. Defaults to `catalog-info.yaml`\n        projectPattern: \'[\\s\\S]*\' # Optional. Filters found projects based on provided patter. Defaults to `[\\s\\S]*`, which means to not filter anything\n        schedule: # optional; same options as in TaskScheduleDefinition\n          # supports cron, ISO duration, "human duration" as used in code\n          frequency: { minutes: 30 }\n          # supports ISO duration, "human duration" as used in code\n          timeout: { minutes: 3 }\n'})}),"\n",(0,r.jsx)(t.p,{children:"As this provider is not one of the default providers, you will first need to install\nthe gitlab catalog plugin:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"# From your Backstage root directory\nyarn --cwd packages/backend add @backstage/plugin-catalog-backend-module-gitlab\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Once you've done that, you'll also need to add the segment below to ",(0,r.jsx)(t.code,{children:"packages/backend/src/plugins/catalog.ts"}),":"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",metastring:'title="packages/backend/src/plugins/catalog.ts"',children:"import { GitlabDiscoveryEntityProvider } from '@backstage/plugin-catalog-backend-module-gitlab';\n\nconst builder = await CatalogBuilder.create(env);\n/** ... other processors and/or providers ... */\nbuilder.addEntityProvider(\n  ...GitlabDiscoveryEntityProvider.fromConfig(env.config, {\n    logger: env.logger,\n    // optional: alternatively, use scheduler with schedule defined in app-config.yaml\n    schedule: env.scheduler.createScheduledTaskRunner({\n      frequency: { minutes: 30 },\n      timeout: { minutes: 3 },\n    }),\n    // optional: alternatively, use schedule\n    scheduler: env.scheduler,\n  }),\n);\n"})}),"\n",(0,r.jsx)(t.h2,{id:"alternative-processor",children:"Alternative processor"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"catalog:\n  locations:\n    - type: gitlab-discovery\n      target: https://gitlab.com/group/subgroup/blob/main/catalog-info.yaml\n"})}),"\n",(0,r.jsxs)(t.p,{children:["As alternative to the entity provider ",(0,r.jsx)(t.code,{children:"GitlabDiscoveryEntityProvider"}),"\nyou can still use the ",(0,r.jsx)(t.code,{children:"GitLabDiscoveryProcessor"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["Note the ",(0,r.jsx)(t.code,{children:"gitlab-discovery"})," type, as this is not a regular ",(0,r.jsx)(t.code,{children:"url"})," processor."]}),"\n",(0,r.jsx)(t.p,{children:"The target is composed of three parts:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["The base URL, ",(0,r.jsx)(t.code,{children:"https://gitlab.com"})," in this case"]}),"\n",(0,r.jsxs)(t.li,{children:["The group path, ",(0,r.jsx)(t.code,{children:"group/subgroup"})," in this case. This is optional: If you omit\nthis path the processor will scan the entire GitLab instance instead."]}),"\n",(0,r.jsxs)(t.li,{children:["The path within each repository to find the catalog YAML file. This will\nusually be ",(0,r.jsx)(t.code,{children:"/blob/main/catalog-info.yaml"}),", ",(0,r.jsx)(t.code,{children:"/blob/master/catalog-info.yaml"})," or\na similar variation for catalog files stored in the root directory of each\nrepository. If you want to use the repository's default branch use the ",(0,r.jsx)(t.code,{children:"*"}),"\nwildcard, e.g.: ",(0,r.jsx)(t.code,{children:"/blob/*/catalog-info.yaml"})]}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"Finally, you will have to add the processor in the catalog initialization code\nof your backend."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",metastring:'title="packages/backend/src/plugins/catalog.ts"',children:"/* highlight-add-next-line */\nimport { GitLabDiscoveryProcessor } from '@backstage/plugin-catalog-backend-module-gitlab';\n\nexport default async function createPlugin(\n  env: PluginEnvironment,\n): Promise<Router> {\n  const builder = await CatalogBuilder.create(env);\n  /* highlight-add-start */\n  builder.addProcessor(\n    GitLabDiscoveryProcessor.fromConfig(env.config, { logger: env.logger }),\n  );\n  /* highlight-add-end */\n\n  // ..\n}\n"})}),"\n",(0,r.jsxs)(t.p,{children:["If you don't want create location object if file with component definition do not exists in project, you can set the ",(0,r.jsx)(t.code,{children:"skipReposWithoutExactFileMatch"})," option. That can reduce count of request to gitlab with 404 status code."]}),"\n",(0,r.jsxs)(t.p,{children:["If you don't want to create location object if the project is a fork, you can set the ",(0,r.jsx)(t.code,{children:"skipForkedRepos"})," option."]})]})}const d=function(e={}){const{wrapper:t}=Object.assign({},(0,o.ah)(),e.components);return t?(0,r.jsx)(t,Object.assign({},e,{children:(0,r.jsx)(u,e)})):u(e)}},371426:(e,t,n)=>{var r=n(827378),o=Symbol.for("react.element"),i=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,n){var r,i={},l=null,u=null;for(r in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(u=t.ref),t)a.call(t,r)&&!c.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:o,type:e,key:l,ref:u,props:i,_owner:s.current}}t.Fragment=i,t.jsx=l,t.jsxs=l},541535:(e,t)=>{var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),c=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),p=Symbol.iterator;var h={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,g={};function b(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||h}function m(){}function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||h}b.prototype.isReactComponent={},b.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},b.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},m.prototype=b.prototype;var j=v.prototype=new m;j.constructor=v,y(j,b.prototype),j.isPureReactComponent=!0;var _=Array.isArray,x=Object.prototype.hasOwnProperty,k={current:null},w={key:!0,ref:!0,__self:!0,__source:!0};function S(e,t,r){var o,i={},a=null,s=null;if(null!=t)for(o in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(a=""+t.key),t)x.call(t,o)&&!w.hasOwnProperty(o)&&(i[o]=t[o]);var c=arguments.length-2;if(1===c)i.children=r;else if(1<c){for(var l=Array(c),u=0;u<c;u++)l[u]=arguments[u+2];i.children=l}if(e&&e.defaultProps)for(o in c=e.defaultProps)void 0===i[o]&&(i[o]=c[o]);return{$$typeof:n,type:e,key:a,ref:s,props:i,_owner:k.current}}function E(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}var O=/\/+/g;function R(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function P(e,t,o,i,a){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var c=!1;if(null===e)c=!0;else switch(s){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case n:case r:c=!0}}if(c)return a=a(c=e),e=""===i?"."+R(c,0):i,_(a)?(o="",null!=e&&(o=e.replace(O,"$&/")+"/"),P(a,t,o,"",(function(e){return e}))):null!=a&&(E(a)&&(a=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,o+(!a.key||c&&c.key===a.key?"":(""+a.key).replace(O,"$&/")+"/")+e)),t.push(a)),1;if(c=0,i=""===i?".":i+":",_(e))for(var l=0;l<e.length;l++){var u=i+R(s=e[l],l);c+=P(s,t,o,u,a)}else if(u=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"==typeof u)for(e=u.call(e),l=0;!(s=e.next()).done;)c+=P(s=s.value,t,o,u=i+R(s,l++),a);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return c}function C(e,t,n){if(null==e)return e;var r=[],o=0;return P(e,r,"","",(function(e){return t.call(n,e,o++)})),r}function L(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var T={current:null},$={transition:null},D={ReactCurrentDispatcher:T,ReactCurrentBatchConfig:$,ReactCurrentOwner:k};t.Children={map:C,forEach:function(e,t,n){C(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return C(e,(function(){t++})),t},toArray:function(e){return C(e,(function(e){return e}))||[]},only:function(e){if(!E(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=b,t.Fragment=o,t.Profiler=a,t.PureComponent=v,t.StrictMode=i,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=D,t.cloneElement=function(e,t,r){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var o=y({},e.props),i=e.key,a=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,s=k.current),void 0!==t.key&&(i=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(l in t)x.call(t,l)&&!w.hasOwnProperty(l)&&(o[l]=void 0===t[l]&&void 0!==c?c[l]:t[l])}var l=arguments.length-2;if(1===l)o.children=r;else if(1<l){c=Array(l);for(var u=0;u<l;u++)c[u]=arguments[u+2];o.children=c}return{$$typeof:n,type:e.type,key:i,ref:a,props:o,_owner:s}},t.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=S,t.createFactory=function(e){var t=S.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=E,t.lazy=function(e){return{$$typeof:f,_payload:{_status:-1,_result:e},_init:L}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=$.transition;$.transition={};try{e()}finally{$.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return T.current.useCallback(e,t)},t.useContext=function(e){return T.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return T.current.useDeferredValue(e)},t.useEffect=function(e,t){return T.current.useEffect(e,t)},t.useId=function(){return T.current.useId()},t.useImperativeHandle=function(e,t,n){return T.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return T.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return T.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return T.current.useMemo(e,t)},t.useReducer=function(e,t,n){return T.current.useReducer(e,t,n)},t.useRef=function(e){return T.current.useRef(e)},t.useState=function(e){return T.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return T.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return T.current.useTransition()},t.version="18.2.0"},827378:(e,t,n)=>{e.exports=n(541535)},824246:(e,t,n)=>{e.exports=n(371426)},511151:(e,t,n)=>{n.d(t,{Zo:()=>s,ah:()=>i});var r=n(667294);const o=r.createContext({});function i(e){const t=r.useContext(o);return r.useMemo((()=>"function"==typeof e?e(t):{...t,...e}),[t,e])}const a={};function s({components:e,children:t,disableParentContext:n}){let s;return s=n?"function"==typeof e?e({}):e||a:i(e),r.createElement(o.Provider,{value:s},t)}}}]);