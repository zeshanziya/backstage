/*! For license information please see 4d57b9a2.9408a970.js.LICENSE.txt */
"use strict";(self.webpackChunkbackstage_microsite=self.webpackChunkbackstage_microsite||[]).push([[475917],{773433:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>s,toc:()=>l});var o=n(824246),r=n(511151);const a={id:"migrating-away-from-core",title:"Migrating away from @backstage/core",description:"Guide on how to migrate to the new Backstage core libraries."},i=void 0,s={id:"tutorials/migrating-away-from-core",title:"Migrating away from @backstage/core",description:"Guide on how to migrate to the new Backstage core libraries.",source:"@site/../docs/tutorials/migrating-away-from-core.md",sourceDirName:"tutorials",slug:"/tutorials/migrating-away-from-core",permalink:"/docs/tutorials/migrating-away-from-core",draft:!1,unlisted:!1,editUrl:"https://github.com/backstage/backstage/edit/master/docs/../docs/tutorials/migrating-away-from-core.md",tags:[],version:"current",frontMatter:{id:"migrating-away-from-core",title:"Migrating away from @backstage/core",description:"Guide on how to migrate to the new Backstage core libraries."},sidebar:"docs",previous:{title:"Package Role Migration",permalink:"/docs/tutorials/package-role-migration"},next:{title:"Configuring Plugin Databases",permalink:"/docs/tutorials/configuring-plugin-databases"}},c={},l=[{value:"Migration",id:"migration",level:2},{value:"Step 1 - Run codemod",id:"step-1---run-codemod",level:3},{value:"Step 2 - Update dependencies",id:"step-2---update-dependencies",level:3},{value:"Step 3 - Manual review",id:"step-3---manual-review",level:3},{value:"Breaking Changes",id:"breaking-changes",level:2},{value:"Removed <code>IconKey</code> type",id:"removed-iconkey-type",level:3},{value:"Constrained <code>IconComponent</code> type",id:"constrained-iconcomponent-type",level:3}];function u(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,r.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(t.p,{children:["The ",(0,o.jsx)(t.code,{children:"@backstage/core"})," package has been split into three separate packages,\n",(0,o.jsx)(t.code,{children:"@backstage/core-app-api"}),", ",(0,o.jsx)(t.code,{children:"@backstage/core-plugin-api"}),", and\n",(0,o.jsx)(t.code,{children:"@backstage/core-components"}),". For more information about the reasoning behind\nthis change and the naming of the packages, see the\n",(0,o.jsx)(t.a,{href:"https://github.com/backstage/backstage/issues/4872",children:"original RFC"})," and\n",(0,o.jsx)(t.a,{href:"https://github.com/backstage/backstage/pull/5825",children:"initial PR"}),"."]}),"\n",(0,o.jsx)(t.p,{children:"The main purpose of the split is to make plugins more decoupled from the app,\nand open up for the possibility of combining plugins using many different\nversions of the core libraries. This should significantly reduce the maintenance\nburden on plugin authors, as well as reduce the impact of breaking changes in\nthe core APIs."}),"\n",(0,o.jsx)(t.h2,{id:"migration",children:"Migration"}),"\n",(0,o.jsxs)(t.p,{children:["At a high level the migration is done by simply replacing usages of\n",(0,o.jsx)(t.code,{children:"@backstage/core"})," with one or more of the three new core libraries. There are a\nfew breaking changes in the new packages that are listed below, but for most\nplugins the migration is a simple replacement. In order to make the migration as\nsmooth as possible we provide a collection of tools to automate the majority of\nthe migration effort."]}),"\n",(0,o.jsx)(t.p,{children:"Below is a list of steps that should get most projects completely migrated, the\norder of the steps is a recommendation but not required, so don't worry if you\nneed to go back to previous steps to fix things."}),"\n",(0,o.jsx)(t.h3,{id:"step-1---run-codemod",children:"Step 1 - Run codemod"}),"\n",(0,o.jsxs)(t.p,{children:["The first step is to run\n",(0,o.jsx)(t.a,{href:"https://www.npmjs.com/package/@backstage/codemods",children:(0,o.jsx)(t.code,{children:"@backstage/codemods"})}),"\nacross your project. This will automatically convert all module imports in your\nsource code to use one of the three new core packages instead. For example, the\nfollowing change might occur:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-ts",children:"/* highlight-remove-next-line */\nimport { useApi, configApiRef, InfoCard } from '@backstage/core';\n/* highlight-add-start */\nimport { useApi, configApiRef } from '@backstage/core-plugin-api';\nimport { InfoCard } from '@backstage/core-components';\n/* highlight-add-end */\n"})}),"\n",(0,o.jsxs)(t.p,{children:["In a typical app created with ",(0,o.jsx)(t.code,{children:"@backstage/create-app"}),", you would run the\nfollowing:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-shell",children:"npx @backstage/codemods apply core-imports packages plugins\n"})}),"\n",(0,o.jsxs)(t.p,{children:["The last two arguments, ",(0,o.jsx)(t.code,{children:"packages"})," and ",(0,o.jsx)(t.code,{children:"plugins"}),", are the folders that the\ncodemod should be applied to. Add or remove folders as needed for your project."]}),"\n",(0,o.jsxs)(t.p,{children:["The codemod might fail for some files because of the missing ",(0,o.jsx)(t.code,{children:"IconKey"})," type in\nany of the new packages. This is one of the few breaking changes. To fix, remove\nany ",(0,o.jsx)(t.code,{children:"IconKey"})," imports and replace usages of it with the ",(0,o.jsx)(t.code,{children:"string"})," type, see the\nbreaking changes section below for details. Once usages of ",(0,o.jsx)(t.code,{children:"IconKey"})," type have\nbeen removed, you can re-run the codemod for those files."]}),"\n",(0,o.jsxs)(t.p,{children:["Note that while the codemod tries to stick to using the existing formatting in\nyour project, it doesn't always manage to do that. If you're using ",(0,o.jsx)(t.code,{children:"prettier"})," to\nformat the code in your project, it's best to run ",(0,o.jsx)(t.code,{children:"prettier --write"})," on any\nfiles that were changed by the codemod."]}),"\n",(0,o.jsx)(t.h3,{id:"step-2---update-dependencies",children:"Step 2 - Update dependencies"}),"\n",(0,o.jsxs)(t.p,{children:["The next step is to update dependencies in your ",(0,o.jsx)(t.code,{children:"package.json"})," files. Any\npackage that currently depends on ",(0,o.jsx)(t.code,{children:"@backstage/core"})," will need to have it\nreplaced by one or more of the new packages. The app package should have all\nthree packages added to ",(0,o.jsx)(t.code,{children:"dependencies"}),", while for plugins and additional non-app\npackages, the ",(0,o.jsx)(t.code,{children:"@backstage/core-plugin-api"})," and ",(0,o.jsx)(t.code,{children:"@backstage/core-components"}),"\npackages should be added to the set of regular ",(0,o.jsx)(t.code,{children:"dependencies"}),", and\n",(0,o.jsx)(t.code,{children:"@backstage/core-app-api"})," should be added to ",(0,o.jsx)(t.code,{children:"devDependencies"})," for usage in\ntests."]}),"\n",(0,o.jsxs)(t.p,{children:["A tool that can help out with step is the ",(0,o.jsx)(t.code,{children:"plugin:diff"})," command from the\n",(0,o.jsx)(t.code,{children:"@backstage/cli"}),", it will compare your plugin to the base plugin template and\nsuggest changes where the plugin deviates. A quick way to get this step done if\nyou have up-to-date project is to run the following in the project root:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"# The --yes flag causes all suggested changes to be accepted automatically\nyarn diff --yes\n"})}),"\n",(0,o.jsxs)(t.p,{children:["If you do not have the ",(0,o.jsx)(t.code,{children:"diff"})," command set up in ",(0,o.jsx)(t.code,{children:"package.json"}),", you can also\nmanually execute the following in each plugin folder:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"yarn backstage-cli plugin:diff --yes\n"})}),"\n",(0,o.jsx)(t.h3,{id:"step-3---manual-review",children:"Step 3 - Manual review"}),"\n",(0,o.jsxs)(t.p,{children:["At this point your app is either completely or very close to being migrated. Run\ntype checks with ",(0,o.jsx)(t.code,{children:"yarn tsc"})," to check if you hit any of the breaking changes\nbelow or if there are any other things to fix. It can also be worthwhile\nsearching for occurrences of ",(0,o.jsx)(t.code,{children:"@backstage/core"})," in the codebase, as that might\nfind usages in for example ",(0,o.jsx)(t.code,{children:"jest"})," mock calls, which aren't handled by the\ncodemod."]}),"\n",(0,o.jsx)(t.p,{children:"As a final step you'll want to boot up the app and take it through any regular\nverification step that you have set up for your project. Don't hesitate to open\na GitHub issue, PR, or reach out on Discord if you hit any snags, or if there\nare any additional steps or hints that you think should be added to this guide!"}),"\n",(0,o.jsx)(t.h2,{id:"breaking-changes",children:"Breaking Changes"}),"\n",(0,o.jsxs)(t.p,{children:["The following is a list of breaking changes between ",(0,o.jsx)(t.code,{children:"@backstage/core"})," and the\nthree new core packages. Not that this list may not be exhaustive depending on\nwhen you migrate your app, as new releases of the new core packages may bring\nfurther changes."]}),"\n",(0,o.jsxs)(t.h3,{id:"removed-iconkey-type",children:["Removed ",(0,o.jsx)(t.code,{children:"IconKey"})," type"]}),"\n",(0,o.jsxs)(t.p,{children:["The ",(0,o.jsx)(t.code,{children:"IconKey"})," type used to be a string union of all known keys used for the app\nicons available through ",(0,o.jsx)(t.code,{children:"useApp().getSystemIcon(key)"}),". The type has been removed\nsince the set of allowed icon keys is no longer constrained, and there is\ninstead only a guarantee that the app provides a minimum set of icons, but can\nprovide any icons it wants beyond that. Migration is done by simply replacing\nold usages by the ",(0,o.jsx)(t.code,{children:"string"})," type."]}),"\n",(0,o.jsxs)(t.h3,{id:"constrained-iconcomponent-type",children:["Constrained ",(0,o.jsx)(t.code,{children:"IconComponent"})," type"]}),"\n",(0,o.jsxs)(t.p,{children:["The ",(0,o.jsx)(t.code,{children:"IconComponent"})," type used to allow all of the props from the Material UI ",(0,o.jsx)(t.code,{children:"SvgIcon"}),".\nThis encouraged some bad patterns in open source plugins such as applying colors\nto the icons, which in turn hurt the ability to replace the icons with custom\nones. The ",(0,o.jsx)(t.code,{children:"IconComponent"})," type, which is now exported from\n",(0,o.jsx)(t.code,{children:"@backstage/core-plugin-api"}),", now only accepts a ",(0,o.jsx)(t.code,{children:"fontSize"})," prop used to set the\nsize of the icon. The type is compatible with the Material UI ",(0,o.jsx)(t.code,{children:"SvgIcon"}),", but there may\nbe situations where an icon needs an explicit cast to ",(0,o.jsx)(t.code,{children:"IconComponent"})," in order\nto narrow the type."]})]})}function d(e={}){const{wrapper:t}={...(0,r.a)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}},371426:(e,t,n)=>{var o=n(827378),r=Symbol.for("react.element"),a=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,s=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,n){var o,a={},l=null,u=null;for(o in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(u=t.ref),t)i.call(t,o)&&!c.hasOwnProperty(o)&&(a[o]=t[o]);if(e&&e.defaultProps)for(o in t=e.defaultProps)void 0===a[o]&&(a[o]=t[o]);return{$$typeof:r,type:e,key:l,ref:u,props:a,_owner:s.current}}t.Fragment=a,t.jsx=l,t.jsxs=l},541535:(e,t)=>{var n=Symbol.for("react.element"),o=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),c=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),h=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,y={};function m(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||f}function b(){}function k(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||f}m.prototype.isReactComponent={},m.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},m.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=m.prototype;var j=k.prototype=new b;j.constructor=k,g(j,m.prototype),j.isPureReactComponent=!0;var x=Array.isArray,w=Object.prototype.hasOwnProperty,v={current:null},_={key:!0,ref:!0,__self:!0,__source:!0};function S(e,t,o){var r,a={},i=null,s=null;if(null!=t)for(r in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(i=""+t.key),t)w.call(t,r)&&!_.hasOwnProperty(r)&&(a[r]=t[r]);var c=arguments.length-2;if(1===c)a.children=o;else if(1<c){for(var l=Array(c),u=0;u<c;u++)l[u]=arguments[u+2];a.children=l}if(e&&e.defaultProps)for(r in c=e.defaultProps)void 0===a[r]&&(a[r]=c[r]);return{$$typeof:n,type:e,key:i,ref:s,props:a,_owner:v.current}}function C(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}var R=/\/+/g;function I(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function E(e,t,r,a,i){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var c=!1;if(null===e)c=!0;else switch(s){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case n:case o:c=!0}}if(c)return i=i(c=e),e=""===a?"."+I(c,0):a,x(i)?(r="",null!=e&&(r=e.replace(R,"$&/")+"/"),E(i,t,r,"",(function(e){return e}))):null!=i&&(C(i)&&(i=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(i,r+(!i.key||c&&c.key===i.key?"":(""+i.key).replace(R,"$&/")+"/")+e)),t.push(i)),1;if(c=0,a=""===a?".":a+":",x(e))for(var l=0;l<e.length;l++){var u=a+I(s=e[l],l);c+=E(s,t,r,u,i)}else if(u=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=h&&e[h]||e["@@iterator"])?e:null}(e),"function"==typeof u)for(e=u.call(e),l=0;!(s=e.next()).done;)c+=E(s=s.value,t,r,u=a+I(s,l++),i);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return c}function T(e,t,n){if(null==e)return e;var o=[],r=0;return E(e,o,"","",(function(e){return t.call(n,e,r++)})),o}function $(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var P={current:null},O={transition:null},A={ReactCurrentDispatcher:P,ReactCurrentBatchConfig:O,ReactCurrentOwner:v};t.Children={map:T,forEach:function(e,t,n){T(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return T(e,(function(){t++})),t},toArray:function(e){return T(e,(function(e){return e}))||[]},only:function(e){if(!C(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=m,t.Fragment=r,t.Profiler=i,t.PureComponent=k,t.StrictMode=a,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=A,t.cloneElement=function(e,t,o){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=g({},e.props),a=e.key,i=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(i=t.ref,s=v.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(l in t)w.call(t,l)&&!_.hasOwnProperty(l)&&(r[l]=void 0===t[l]&&void 0!==c?c[l]:t[l])}var l=arguments.length-2;if(1===l)r.children=o;else if(1<l){c=Array(l);for(var u=0;u<l;u++)c[u]=arguments[u+2];r.children=c}return{$$typeof:n,type:e.type,key:a,ref:i,props:r,_owner:s}},t.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=S,t.createFactory=function(e){var t=S.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=C,t.lazy=function(e){return{$$typeof:p,_payload:{_status:-1,_result:e},_init:$}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=O.transition;O.transition={};try{e()}finally{O.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return P.current.useCallback(e,t)},t.useContext=function(e){return P.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return P.current.useDeferredValue(e)},t.useEffect=function(e,t){return P.current.useEffect(e,t)},t.useId=function(){return P.current.useId()},t.useImperativeHandle=function(e,t,n){return P.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return P.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return P.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return P.current.useMemo(e,t)},t.useReducer=function(e,t,n){return P.current.useReducer(e,t,n)},t.useRef=function(e){return P.current.useRef(e)},t.useState=function(e){return P.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return P.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return P.current.useTransition()},t.version="18.2.0"},827378:(e,t,n)=>{e.exports=n(541535)},824246:(e,t,n)=>{e.exports=n(371426)},511151:(e,t,n)=>{n.d(t,{Z:()=>s,a:()=>i});var o=n(667294);const r={},a=o.createContext(r);function i(e){const t=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),o.createElement(a.Provider,{value:t},e.children)}}}]);