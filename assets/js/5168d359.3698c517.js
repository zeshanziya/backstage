/*! For license information please see 5168d359.3698c517.js.LICENSE.txt */
"use strict";(self.webpackChunkbackstage_microsite=self.webpackChunkbackstage_microsite||[]).push([[883920],{636525:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>s,metadata:()=>i,toc:()=>l});var r=n(824246),o=n(511151);const s={id:"plugins",title:"Backend Plugins",sidebar_label:"Plugins",description:"Backend plugins"},a=void 0,i={id:"backend-system/architecture/plugins",title:"Backend Plugins",description:"Backend plugins",source:"@site/../docs/backend-system/architecture/04-plugins.md",sourceDirName:"backend-system/architecture",slug:"/backend-system/architecture/plugins",permalink:"/docs/backend-system/architecture/plugins",draft:!1,unlisted:!1,editUrl:"https://github.com/backstage/backstage/edit/master/docs/../docs/backend-system/architecture/04-plugins.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{id:"plugins",title:"Backend Plugins",sidebar_label:"Plugins",description:"Backend plugins"},sidebar:"docs",previous:{title:"Services",permalink:"/docs/backend-system/architecture/services"},next:{title:"Extension Points",permalink:"/docs/backend-system/architecture/extension-points"}},c={},l=[{value:"Defining a Plugin",id:"defining-a-plugin",level:2},{value:"Rules of Plugins",id:"rules-of-plugins",level:2},{value:"Scalable",id:"scalable",level:3},{value:"Isolated",id:"isolated",level:3}];function u(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,o.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.p,{children:"Plugins provide the actual base features of a Backstage backend. Each plugin operates completely independently of all other plugins and they only communicate with each other through network calls. This means that there is a strong degree of isolation between plugins, and that each plugin can be considered a separate microservice. While a default Backstage project has all plugins installed within a single backend, it is also possible to split this setup into multiple backends, with each backend housing one or more plugins."}),"\n",(0,r.jsx)(t.h2,{id:"defining-a-plugin",children:"Defining a Plugin"}),"\n",(0,r.jsxs)(t.p,{children:["Plugins are created using the ",(0,r.jsx)(t.code,{children:"createBackendPlugin"})," function, and should typically be exported from a plugin package. All plugins must have an ID and a ",(0,r.jsx)(t.code,{children:"register"})," method, where the ID matches the plugin ID in the package name, without the ",(0,r.jsx)(t.code,{children:"-backend"})," suffix. See also the ",(0,r.jsx)(t.a,{href:"/docs/backend-system/architecture/naming-patterns",children:"dedicated section"})," about proper naming patterns."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",children:"// plugins/example-backend/src/plugin.ts\nimport {\n  coreServices,\n  createBackendPlugin,\n} from '@backstage/backend-plugin-api';\n\nexport const examplePlugin = createBackendPlugin({\n  pluginId: 'example',\n  register(env) {\n    env.registerInit({\n      deps: {\n        logger: coreServices.logger,\n      },\n      async init({ logger }) {\n        logger.info('Hello from example plugin');\n      },\n    });\n  },\n});\n"})}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"env"})," object passed to the ",(0,r.jsx)(t.code,{children:"register"})," callback contains different methods that declare the external surface of the plugin. The ",(0,r.jsx)(t.code,{children:"env.registerInit"})," method is used to register an initialization function that is run when the backend starts up. The ",(0,r.jsx)(t.code,{children:"deps"})," argument is used to declare service dependencies, and the ",(0,r.jsx)(t.code,{children:"init"})," callback is passed an object with the resolved dependencies. In this case, we declare a dependency on the logger service, which is one of the core services available to all Backstage backend plugins. For a full list of core services as well as documentation for each services, see the ",(0,r.jsx)(t.a,{href:"/docs/backend-system/core-services/index",children:"core services section"}),". Plugins can of course also depend on services exported by other libraries."]}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"createBackendPlugin"})," return value is exported as ",(0,r.jsx)(t.code,{children:"examplePlugin"}),", which is a factory function used to create the actual plugin instance. For example, to install the plugin in your backend instance, you would do the following:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",children:"import { examplePlugin } from 'backstage-plugin-example-backend';\n\nbackend.add(examplePlugin());\n"})}),"\n",(0,r.jsx)(t.p,{children:"By convention every plugin package should export its plugin instance as the default export from the package:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",children:"// plugins/example-backend/src/index.ts\nexport { examplePlugin as default } from './plugin.ts';\n"})}),"\n",(0,r.jsx)(t.p,{children:"This allows you to install the plugin in your backend instance by just referencing the package:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",children:"backend.add(import('backstage-plugin-example-backend'));\n"})}),"\n",(0,r.jsxs)(t.p,{children:["To make your plugins customizable you should generally prefer to use ",(0,r.jsx)(t.a,{href:"/docs/conf/defining",children:"static configuration"}),". By convention plugins should place their configuration under a top-level configuration key that matches the plugin ID. For example, our example plugin might be configured as follows:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"example:\n  message: Welcome to the example plugin\n"})}),"\n",(0,r.jsxs)(t.p,{children:["For situations where static configuration is too limiting, you can instead register extension points for your plugin. Extension Points are covered in the ",(0,r.jsx)(t.a,{href:"/docs/backend-system/architecture/extension-points",children:"next section"}),"."]}),"\n",(0,r.jsx)(t.h2,{id:"rules-of-plugins",children:"Rules of Plugins"}),"\n",(0,r.jsxs)(t.p,{children:["The following rules apply to the production setup of Backstage plugins in the broader Backstage plugin ecosystem. Any plugin that is maintained under the ",(0,r.jsx)(t.code,{children:"@backstage"})," package namespace should follow these rules, and it is recommended that all widely distributed plugins follow these rules as well."]}),"\n",(0,r.jsx)(t.p,{children:"An exception to these rules are made for development or test setups, where shortcuts can be taken in order to streamline development and keep things simple."}),"\n",(0,r.jsx)(t.h3,{id:"scalable",children:"Scalable"}),"\n",(0,r.jsx)(t.p,{children:"Plugins must always be designed to be horizontally scalable. This means that you should not keep any state in memory, or make sure that replicating this state across multiple instances is not an issue. Plugins should either be stateless, or store their state in an external service, such as a database."}),"\n",(0,r.jsx)(t.h3,{id:"isolated",children:"Isolated"}),"\n",(0,r.jsxs)(t.p,{children:["Plugins must never communicate with each other directly through code, they may only communicate over the network. Plugins that wish to expose an external interface for other plugins and modules to use are recommended to do so through a ",(0,r.jsx)(t.a,{href:"/docs/local-dev/cli-build-system#package-roles",children:"node-library"})," package. The library should export an API client service to make calls to your plugin, or similar construct."]})]})}function d(e={}){const{wrapper:t}={...(0,o.a)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},371426:(e,t,n)=>{var r=n(827378),o=Symbol.for("react.element"),s=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,i=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,n){var r,s={},l=null,u=null;for(r in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(u=t.ref),t)a.call(t,r)&&!c.hasOwnProperty(r)&&(s[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===s[r]&&(s[r]=t[r]);return{$$typeof:o,type:e,key:l,ref:u,props:s,_owner:i.current}}t.Fragment=s,t.jsx=l,t.jsxs=l},541535:(e,t)=>{var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),i=Symbol.for("react.provider"),c=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),f=Symbol.iterator;var h={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,m={};function y(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||h}function b(){}function x(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||h}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=y.prototype;var k=x.prototype=new b;k.constructor=x,g(k,y.prototype),k.isPureReactComponent=!0;var v=Array.isArray,_=Object.prototype.hasOwnProperty,j={current:null},w={key:!0,ref:!0,__self:!0,__source:!0};function P(e,t,r){var o,s={},a=null,i=null;if(null!=t)for(o in void 0!==t.ref&&(i=t.ref),void 0!==t.key&&(a=""+t.key),t)_.call(t,o)&&!w.hasOwnProperty(o)&&(s[o]=t[o]);var c=arguments.length-2;if(1===c)s.children=r;else if(1<c){for(var l=Array(c),u=0;u<c;u++)l[u]=arguments[u+2];s.children=l}if(e&&e.defaultProps)for(o in c=e.defaultProps)void 0===s[o]&&(s[o]=c[o]);return{$$typeof:n,type:e,key:a,ref:i,props:s,_owner:j.current}}function S(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}var E=/\/+/g;function R(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function C(e,t,o,s,a){var i=typeof e;"undefined"!==i&&"boolean"!==i||(e=null);var c=!1;if(null===e)c=!0;else switch(i){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case n:case r:c=!0}}if(c)return a=a(c=e),e=""===s?"."+R(c,0):s,v(a)?(o="",null!=e&&(o=e.replace(E,"$&/")+"/"),C(a,t,o,"",(function(e){return e}))):null!=a&&(S(a)&&(a=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,o+(!a.key||c&&c.key===a.key?"":(""+a.key).replace(E,"$&/")+"/")+e)),t.push(a)),1;if(c=0,s=""===s?".":s+":",v(e))for(var l=0;l<e.length;l++){var u=s+R(i=e[l],l);c+=C(i,t,o,u,a)}else if(u=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"==typeof u)for(e=u.call(e),l=0;!(i=e.next()).done;)c+=C(i=i.value,t,o,u=s+R(i,l++),a);else if("object"===i)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return c}function $(e,t,n){if(null==e)return e;var r=[],o=0;return C(e,r,"","",(function(e){return t.call(n,e,o++)})),r}function I(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var O={current:null},T={transition:null},B={ReactCurrentDispatcher:O,ReactCurrentBatchConfig:T,ReactCurrentOwner:j};t.Children={map:$,forEach:function(e,t,n){$(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return $(e,(function(){t++})),t},toArray:function(e){return $(e,(function(e){return e}))||[]},only:function(e){if(!S(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=y,t.Fragment=o,t.Profiler=a,t.PureComponent=x,t.StrictMode=s,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=B,t.cloneElement=function(e,t,r){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var o=g({},e.props),s=e.key,a=e.ref,i=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,i=j.current),void 0!==t.key&&(s=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(l in t)_.call(t,l)&&!w.hasOwnProperty(l)&&(o[l]=void 0===t[l]&&void 0!==c?c[l]:t[l])}var l=arguments.length-2;if(1===l)o.children=r;else if(1<l){c=Array(l);for(var u=0;u<l;u++)c[u]=arguments[u+2];o.children=c}return{$$typeof:n,type:e.type,key:s,ref:a,props:o,_owner:i}},t.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:i,_context:e},e.Consumer=e},t.createElement=P,t.createFactory=function(e){var t=P.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=S,t.lazy=function(e){return{$$typeof:p,_payload:{_status:-1,_result:e},_init:I}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=T.transition;T.transition={};try{e()}finally{T.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return O.current.useCallback(e,t)},t.useContext=function(e){return O.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return O.current.useDeferredValue(e)},t.useEffect=function(e,t){return O.current.useEffect(e,t)},t.useId=function(){return O.current.useId()},t.useImperativeHandle=function(e,t,n){return O.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return O.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return O.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return O.current.useMemo(e,t)},t.useReducer=function(e,t,n){return O.current.useReducer(e,t,n)},t.useRef=function(e){return O.current.useRef(e)},t.useState=function(e){return O.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return O.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return O.current.useTransition()},t.version="18.2.0"},827378:(e,t,n)=>{e.exports=n(541535)},824246:(e,t,n)=>{e.exports=n(371426)},511151:(e,t,n)=>{n.d(t,{Z:()=>i,a:()=>a});var r=n(667294);const o={},s=r.createContext(o);function a(e){const t=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),r.createElement(s.Provider,{value:t},e.children)}}}]);