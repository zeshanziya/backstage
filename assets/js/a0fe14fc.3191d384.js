/*! For license information please see a0fe14fc.3191d384.js.LICENSE.txt */
"use strict";(self.webpackChunkbackstage_microsite=self.webpackChunkbackstage_microsite||[]).push([[59129],{435834:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>s,metadata:()=>a,toc:()=>c});var r=n(824246),i=n(511151);const s={id:"getting-started",title:"Getting Started",description:"How to get started with the permission framework as an integrator"},o=void 0,a={id:"permissions/getting-started",title:"Getting Started",description:"How to get started with the permission framework as an integrator",source:"@site/../docs/permissions/getting-started.md",sourceDirName:"permissions",slug:"/permissions/getting-started",permalink:"/docs/permissions/getting-started",draft:!1,unlisted:!1,editUrl:"https://github.com/backstage/backstage/edit/master/docs/../docs/permissions/getting-started.md",tags:[],version:"current",frontMatter:{id:"getting-started",title:"Getting Started",description:"How to get started with the permission framework as an integrator"},sidebar:"docs",previous:{title:"Concepts",permalink:"/docs/permissions/concepts"},next:{title:"Writing a permission policy",permalink:"/docs/permissions/writing-a-policy"}},l={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Upgrade to the latest version of Backstage",id:"upgrade-to-the-latest-version-of-backstage",level:3},{value:"Supply an identity resolver to populate group membership on sign in",id:"supply-an-identity-resolver-to-populate-group-membership-on-sign-in",level:3},{value:"Test Permission Policy",id:"test-permission-policy",level:2},{value:"Enable and test the permissions system",id:"enable-and-test-the-permissions-system",level:2}];function u(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,i.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.admonition,{type:"info",children:(0,r.jsxs)(t.p,{children:["This documentation is written for ",(0,r.jsx)(t.a,{href:"/docs/backend-system/",children:"the new backend system"})," which is the default since Backstage ",(0,r.jsx)(t.a,{href:"/docs/releases/v1.24.0",children:"version 1.24"}),". If you are still on the old backend system, you may want to read ",(0,r.jsx)(t.a,{href:"/docs/permissions/getting-started--old",children:"its own article"})," instead, and ",(0,r.jsx)(t.a,{href:"/docs/backend-system/building-backends/migrating",children:"consider migrating"}),"!"]})}),"\n",(0,r.jsx)(t.p,{children:"Backstage integrators control permissions by writing a policy. In general terms, a policy is simply an async function which receives a request to authorize a specific action for a user and (optional) resource, and returns a decision on whether to authorize that permission. Integrators can implement their own policies from scratch, or adopt reusable policies written by others."}),"\n",(0,r.jsx)(t.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsx)(t.p,{children:"The permissions framework depends on a few other Backstage systems, which must be set up before we can dive into writing a policy."}),"\n",(0,r.jsx)(t.h3,{id:"upgrade-to-the-latest-version-of-backstage",children:"Upgrade to the latest version of Backstage"}),"\n",(0,r.jsxs)(t.p,{children:["To ensure your version of Backstage has all the latest permission-related functionality, it\u2019s important to upgrade to the latest version. The ",(0,r.jsx)(t.a,{href:"https://backstage.github.io/upgrade-helper/",children:"Backstage upgrade helper"})," is a great tool to help ensure that you\u2019ve made all the necessary changes during the upgrade!"]}),"\n",(0,r.jsx)(t.h3,{id:"supply-an-identity-resolver-to-populate-group-membership-on-sign-in",children:"Supply an identity resolver to populate group membership on sign in"}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Note"}),": If you are working off of an existing Backstage instance, you likely already have some form of an identity resolver set up."]}),"\n",(0,r.jsx)(t.p,{children:"Like many other parts of Backstage, the permissions framework relies on information about group membership. This simplifies authoring policies through the use of groups, rather than requiring each user to be listed in the configuration. Group membership is also often useful for conditional permissions, for example allowing permissions to act on an entity to be granted when a user is a member of a group that owns that entity."}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.a,{href:"/docs/auth/identity-resolver",children:"The IdentityResolver docs"})," describe the process for resolving group membership on sign in."]}),"\n",(0,r.jsx)(t.h2,{id:"test-permission-policy",children:"Test Permission Policy"}),"\n",(0,r.jsx)(t.p,{children:"To help validate the permission framework is setup we'll create a Test Permission Policy:"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsx)(t.p,{children:"Backstage ships with a default Allow All Policy, we want to remove that as it would override our Test Permission Policy. To do this remove the following line:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",metastring:'title="packages/backend/src/index.ts"',children:"// permission plugin\nbackend.add(import('@backstage/plugin-permission-backend/alpha'));\n/* highlight-remove-start */\nbackend.add(\n  import('@backstage/plugin-permission-backend-module-allow-all-policy'),\n);\n/* highlight-remove-end */\n"})}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:["Now we need to add the ",(0,r.jsx)(t.code,{children:"@backstage/backend-plugin-api"})," package:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",metastring:'title="from your Backstage root directory"',children:"yarn --cwd packages/backend add @backstage/backend-plugin-api\n"})}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:["Next we will create an ",(0,r.jsx)(t.code,{children:"extensions"})," folder under ",(0,r.jsx)(t.code,{children:"packages/backend/src"})]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:["In this new ",(0,r.jsx)(t.code,{children:"extensions"})," folder we will add a new file called: ",(0,r.jsx)(t.code,{children:"permissionsPolicyExtension.ts"})]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:["Copy the following into the new ",(0,r.jsx)(t.code,{children:"permissionsPolicyExtension.ts"})," file:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",metastring:'title="packages/backend/src/extensions/permissionsPolicyExtension.ts"',children:"import { createBackendModule } from '@backstage/backend-plugin-api';\nimport {\n  PolicyDecision,\n  AuthorizeResult,\n} from '@backstage/plugin-permission-common';\nimport { PermissionPolicy } from '@backstage/plugin-permission-node';\nimport { policyExtensionPoint } from '@backstage/plugin-permission-node/alpha';\n\nclass TestPermissionPolicy implements PermissionPolicy {\n  async handle(): Promise<PolicyDecision> {\n    return { result: AuthorizeResult.ALLOW };\n  }\n}\n\nexport default createBackendModule({\n  pluginId: 'permission',\n  moduleId: 'permission-policy',\n  register(reg) {\n    reg.registerInit({\n      deps: { policy: policyExtensionPoint },\n      async init({ policy }) {\n        policy.setPolicy(new TestPermissionPolicy());\n      },\n    });\n  },\n});\n"})}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsx)(t.p,{children:"We now need to register this in the backend. We will do this by adding the follow line:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",metastring:'title="packages/backend/src/index.ts"',children:"// permission plugin\nbackend.add(import('@backstage/plugin-permission-backend/alpha'));\n/* highlight-add-next-line */\nbackend.add(import('./extensions/permissionPolicyExtension'));\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"You now have a Test Permission Policy in place, this will help us test that the permission framework is working in the next section."}),"\n",(0,r.jsx)(t.h2,{id:"enable-and-test-the-permissions-system",children:"Enable and test the permissions system"}),"\n",(0,r.jsx)(t.p,{children:"Now lets test end to end that the permissions framework is setup and configured properly we will use the Test Permission Policy we create above as is, then modify it do deny access which will confirm everything is working as expected. Here's how to do that:"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:["Set the property ",(0,r.jsx)(t.code,{children:"permission.enabled"})," to ",(0,r.jsx)(t.code,{children:"true"})," in ",(0,r.jsx)(t.code,{children:"app-config.yaml"}),"."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'title="app-config.yaml"',children:"permission:\n  enabled: true\n"})}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:["Now run ",(0,r.jsx)(t.code,{children:"yarn dev"}),", Backstage should load up in your browser"]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsx)(t.p,{children:"You should see that you have entities in your Catalog, pretty simple"}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:["Let's change this line in our Test Permission Policy ",(0,r.jsx)(t.code,{children:"return { result: AuthorizeResult.ALLOW };"})," to be ",(0,r.jsx)(t.code,{children:"return { result: AuthorizeResult.DENY };"})]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:["Run ",(0,r.jsx)(t.code,{children:"yarn dev"})," once again, Backstage should load up in your browser"]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsx)(t.p,{children:"This time you should not see any entities in your Catalog, if you do then something went wrong along the way and you'll need to review the steps above"}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:["Revert the change we made in step 4 so that the line looks like this: ",(0,r.jsx)(t.code,{children:"return { result: AuthorizeResult.ALLOW };"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["Congratulations! Now that the framework is fully configured, you can craft a permission policy that works best for your organization by ",(0,r.jsx)(t.a,{href:"/docs/permissions/writing-a-policy",children:"writing your own policy"}),"!"]})]})}function d(e={}){const{wrapper:t}={...(0,i.a)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},371426:(e,t,n)=>{var r=n(827378),i=Symbol.for("react.element"),s=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,a=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,s={},c=null,u=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)o.call(t,r)&&!l.hasOwnProperty(r)&&(s[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===s[r]&&(s[r]=t[r]);return{$$typeof:i,type:e,key:c,ref:u,props:s,_owner:a.current}}t.Fragment=s,t.jsx=c,t.jsxs=c},541535:(e,t)=>{var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),h=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,y={};function g(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||f}function b(){}function x(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||f}g.prototype.isReactComponent={},g.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=g.prototype;var w=x.prototype=new b;w.constructor=x,m(w,g.prototype),w.isPureReactComponent=!0;var k=Array.isArray,v=Object.prototype.hasOwnProperty,j={current:null},_={key:!0,ref:!0,__self:!0,__source:!0};function P(e,t,r){var i,s={},o=null,a=null;if(null!=t)for(i in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(o=""+t.key),t)v.call(t,i)&&!_.hasOwnProperty(i)&&(s[i]=t[i]);var l=arguments.length-2;if(1===l)s.children=r;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];s.children=c}if(e&&e.defaultProps)for(i in l=e.defaultProps)void 0===s[i]&&(s[i]=l[i]);return{$$typeof:n,type:e,key:o,ref:a,props:s,_owner:j.current}}function S(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}var E=/\/+/g;function R(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function C(e,t,i,s,o){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var l=!1;if(null===e)l=!0;else switch(a){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case r:l=!0}}if(l)return o=o(l=e),e=""===s?"."+R(l,0):s,k(o)?(i="",null!=e&&(i=e.replace(E,"$&/")+"/"),C(o,t,i,"",(function(e){return e}))):null!=o&&(S(o)&&(o=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,i+(!o.key||l&&l.key===o.key?"":(""+o.key).replace(E,"$&/")+"/")+e)),t.push(o)),1;if(l=0,s=""===s?".":s+":",k(e))for(var c=0;c<e.length;c++){var u=s+R(a=e[c],c);l+=C(a,t,i,u,o)}else if(u=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=h&&e[h]||e["@@iterator"])?e:null}(e),"function"==typeof u)for(e=u.call(e),c=0;!(a=e.next()).done;)l+=C(a=a.value,t,i,u=s+R(a,c++),o);else if("object"===a)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function T(e,t,n){if(null==e)return e;var r=[],i=0;return C(e,r,"","",(function(e){return t.call(n,e,i++)})),r}function $(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var O={current:null},I={transition:null},N={ReactCurrentDispatcher:O,ReactCurrentBatchConfig:I,ReactCurrentOwner:j};function B(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:T,forEach:function(e,t,n){T(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return T(e,(function(){t++})),t},toArray:function(e){return T(e,(function(e){return e}))||[]},only:function(e){if(!S(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=g,t.Fragment=i,t.Profiler=o,t.PureComponent=x,t.StrictMode=s,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=N,t.act=B,t.cloneElement=function(e,t,r){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=m({},e.props),s=e.key,o=e.ref,a=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,a=j.current),void 0!==t.key&&(s=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)v.call(t,c)&&!_.hasOwnProperty(c)&&(i[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)i.children=r;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];i.children=l}return{$$typeof:n,type:e.type,key:s,ref:o,props:i,_owner:a}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},t.createElement=P,t.createFactory=function(e){var t=P.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=S,t.lazy=function(e){return{$$typeof:p,_payload:{_status:-1,_result:e},_init:$}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=I.transition;I.transition={};try{e()}finally{I.transition=t}},t.unstable_act=B,t.useCallback=function(e,t){return O.current.useCallback(e,t)},t.useContext=function(e){return O.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return O.current.useDeferredValue(e)},t.useEffect=function(e,t){return O.current.useEffect(e,t)},t.useId=function(){return O.current.useId()},t.useImperativeHandle=function(e,t,n){return O.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return O.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return O.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return O.current.useMemo(e,t)},t.useReducer=function(e,t,n){return O.current.useReducer(e,t,n)},t.useRef=function(e){return O.current.useRef(e)},t.useState=function(e){return O.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return O.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return O.current.useTransition()},t.version="18.3.1"},827378:(e,t,n)=>{e.exports=n(541535)},824246:(e,t,n)=>{e.exports=n(371426)},511151:(e,t,n)=>{n.d(t,{Z:()=>a,a:()=>o});var r=n(667294);const i={},s=r.createContext(i);function o(e){const t=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(s.Provider,{value:t},e.children)}}}]);