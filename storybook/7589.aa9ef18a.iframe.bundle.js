"use strict";(self.webpackChunkstorybook=self.webpackChunkstorybook||[]).push([[7589],{"../plugins/gcalendar/src/components/CalendarCard/index.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{HomePageCalendar:()=>HomePageCalendar});var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/react/index.js"),queryClient=__webpack_require__("../node_modules/@tanstack/query-core/build/lib/queryClient.mjs"),QueryClientProvider=__webpack_require__("../node_modules/@tanstack/react-query/build/lib/QueryClientProvider.mjs"),lodash=__webpack_require__("../node_modules/lodash/lodash.js"),luxon=__webpack_require__("../node_modules/luxon/src/luxon.js"),InfoCard=__webpack_require__("../packages/core-components/src/layout/InfoCard/InfoCard.tsx"),Progress=__webpack_require__("../packages/core-components/src/components/Progress/Progress.tsx"),useAnalytics=__webpack_require__("../packages/core-plugin-api/src/analytics/useAnalytics.tsx"),Box=__webpack_require__("../node_modules/@material-ui/core/esm/Box/Box.js"),IconButton=__webpack_require__("../node_modules/@material-ui/core/esm/IconButton/IconButton.js"),Typography=__webpack_require__("../node_modules/@material-ui/core/esm/Typography/Typography.js"),NavigateBefore=__webpack_require__("../node_modules/@material-ui/icons/NavigateBefore.js"),NavigateNext=__webpack_require__("../node_modules/@material-ui/icons/NavigateNext.js"),useApi=__webpack_require__("../packages/core-plugin-api/src/apis/system/useApi.tsx"),auth=__webpack_require__("../packages/core-plugin-api/src/apis/definitions/auth.ts");var useQuery=__webpack_require__("../node_modules/@tanstack/react-query/build/lib/useQuery.mjs"),ErrorApi=__webpack_require__("../packages/core-plugin-api/src/apis/definitions/ErrorApi.ts"),client=__webpack_require__("../plugins/gcalendar/src/api/client.ts");var LocalStorageKeys,StorageApi=__webpack_require__("../packages/core-plugin-api/src/apis/definitions/StorageApi.ts"),useObservable=__webpack_require__("../node_modules/react-use/lib/useObservable.js"),src_plugin=__webpack_require__("../plugins/gcalendar/src/plugin.ts");!function(LocalStorageKeys){LocalStorageKeys.selectedCalendars="google_calendars_selected"}(LocalStorageKeys||(LocalStorageKeys={}));var utils=__webpack_require__("../node_modules/@tanstack/query-core/build/lib/utils.mjs"),notifyManager=__webpack_require__("../node_modules/@tanstack/query-core/build/lib/notifyManager.mjs"),queryObserver=__webpack_require__("../node_modules/@tanstack/query-core/build/lib/queryObserver.mjs"),subscribable=__webpack_require__("../node_modules/@tanstack/query-core/build/lib/subscribable.mjs");class QueriesObserver extends subscribable.Q{constructor(client,queries){super(),this.client=client,this.queries=[],this.result=[],this.observers=[],this.observersMap={},queries&&this.setQueries(queries)}onSubscribe(){1===this.listeners.size&&this.observers.forEach((observer=>{observer.subscribe((result=>{this.onUpdate(observer,result)}))}))}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,this.observers.forEach((observer=>{observer.destroy()}))}setQueries(queries,notifyOptions){this.queries=queries,notifyManager.j.batch((()=>{const prevObservers=this.observers,newObserverMatches=this.findMatchingObservers(this.queries);newObserverMatches.forEach((match=>match.observer.setOptions(match.defaultedQueryOptions,notifyOptions)));const newObservers=newObserverMatches.map((match=>match.observer)),newObserversMap=Object.fromEntries(newObservers.map((observer=>[observer.options.queryHash,observer]))),newResult=newObservers.map((observer=>observer.getCurrentResult())),hasIndexChange=newObservers.some(((observer,index)=>observer!==prevObservers[index]));(prevObservers.length!==newObservers.length||hasIndexChange)&&(this.observers=newObservers,this.observersMap=newObserversMap,this.result=newResult,this.hasListeners()&&((0,utils.iv)(prevObservers,newObservers).forEach((observer=>{observer.destroy()})),(0,utils.iv)(newObservers,prevObservers).forEach((observer=>{observer.subscribe((result=>{this.onUpdate(observer,result)}))})),this.notify()))}))}getCurrentResult(){return this.result}getQueries(){return this.observers.map((observer=>observer.getCurrentQuery()))}getObservers(){return this.observers}getOptimisticResult(queries){return this.findMatchingObservers(queries).map((match=>match.observer.getOptimisticResult(match.defaultedQueryOptions)))}findMatchingObservers(queries){const prevObservers=this.observers,prevObserversMap=new Map(prevObservers.map((observer=>[observer.options.queryHash,observer]))),defaultedQueryOptions=queries.map((options=>this.client.defaultQueryOptions(options))),matchingObservers=defaultedQueryOptions.flatMap((defaultedOptions=>{const match=prevObserversMap.get(defaultedOptions.queryHash);return null!=match?[{defaultedQueryOptions:defaultedOptions,observer:match}]:[]})),matchedQueryHashes=new Set(matchingObservers.map((match=>match.defaultedQueryOptions.queryHash))),unmatchedQueries=defaultedQueryOptions.filter((defaultedOptions=>!matchedQueryHashes.has(defaultedOptions.queryHash))),matchingObserversSet=new Set(matchingObservers.map((match=>match.observer))),unmatchedObservers=prevObservers.filter((prevObserver=>!matchingObserversSet.has(prevObserver))),getObserver=options=>{const defaultedOptions=this.client.defaultQueryOptions(options),currentObserver=this.observersMap[defaultedOptions.queryHash];return null!=currentObserver?currentObserver:new queryObserver.$(this.client,defaultedOptions)},newOrReusedObservers=unmatchedQueries.map(((options,index)=>{if(options.keepPreviousData){const previouslyUsedObserver=unmatchedObservers[index];if(void 0!==previouslyUsedObserver)return{defaultedQueryOptions:options,observer:previouslyUsedObserver}}return{defaultedQueryOptions:options,observer:getObserver(options)}}));return matchingObservers.concat(newOrReusedObservers).sort(((a,b)=>defaultedQueryOptions.indexOf(a.defaultedQueryOptions)-defaultedQueryOptions.indexOf(b.defaultedQueryOptions)))}onUpdate(observer,result){const index=this.observers.indexOf(observer);-1!==index&&(this.result=(0,utils._D)(this.result,index,result),this.notify())}notify(){notifyManager.j.batch((()=>{this.listeners.forEach((({listener})=>{listener(this.result)}))}))}}var useSyncExternalStore=__webpack_require__("../node_modules/@tanstack/react-query/build/lib/useSyncExternalStore.mjs"),lib_isRestoring=__webpack_require__("../node_modules/@tanstack/react-query/build/lib/isRestoring.mjs"),QueryErrorResetBoundary=__webpack_require__("../node_modules/@tanstack/react-query/build/lib/QueryErrorResetBoundary.mjs"),errorBoundaryUtils=__webpack_require__("../node_modules/@tanstack/react-query/build/lib/errorBoundaryUtils.mjs"),suspense=__webpack_require__("../node_modules/@tanstack/react-query/build/lib/suspense.mjs");const useEventsQuery=({selectedCalendars=[],calendars=[],enabled,timeMin,timeMax,timeZone})=>{const calendarApi=(0,useApi.gf)(client.d),eventQueries=function useQueries({queries,context}){const queryClient=(0,QueryClientProvider.jE)({context}),isRestoring=(0,lib_isRestoring.w)(),errorResetBoundary=(0,QueryErrorResetBoundary.h)(),defaultedQueries=react.useMemo((()=>queries.map((options=>{const defaultedOptions=queryClient.defaultQueryOptions(options);return defaultedOptions._optimisticResults=isRestoring?"isRestoring":"optimistic",defaultedOptions}))),[queries,queryClient,isRestoring]);defaultedQueries.forEach((query=>{(0,suspense.tu)(query),(0,errorBoundaryUtils.LJ)(query,errorResetBoundary)})),(0,errorBoundaryUtils.wZ)(errorResetBoundary);const[observer]=react.useState((()=>new QueriesObserver(queryClient,defaultedQueries))),optimisticResult=observer.getOptimisticResult(defaultedQueries);(0,useSyncExternalStore.r)(react.useCallback((onStoreChange=>isRestoring?()=>{}:observer.subscribe(notifyManager.j.batchCalls(onStoreChange))),[observer,isRestoring]),(()=>observer.getCurrentResult()),(()=>observer.getCurrentResult())),react.useEffect((()=>{observer.setQueries(defaultedQueries,{listeners:!1})}),[defaultedQueries,observer]);const suspensePromises=optimisticResult.some(((result,index)=>(0,suspense.EU)(defaultedQueries[index],result,isRestoring)))?optimisticResult.flatMap(((result,index)=>{const options=defaultedQueries[index],queryObserver=observer.getObservers()[index];if(options&&queryObserver){if((0,suspense.EU)(options,result,isRestoring))return(0,suspense.iL)(options,queryObserver,errorResetBoundary);(0,suspense.nE)(result,isRestoring)&&(0,suspense.iL)(options,queryObserver,errorResetBoundary)}return[]})):[];if(suspensePromises.length>0)throw Promise.all(suspensePromises);const observerQueries=observer.getQueries(),firstSingleResultWhichShouldThrow=optimisticResult.find(((result,index)=>{var _defaultedQueries$ind,_defaultedQueries$ind2;return(0,errorBoundaryUtils.$1)({result,errorResetBoundary,useErrorBoundary:null!=(_defaultedQueries$ind=null==(_defaultedQueries$ind2=defaultedQueries[index])?void 0:_defaultedQueries$ind2.useErrorBoundary)&&_defaultedQueries$ind,query:observerQueries[index]})}));if(null!=firstSingleResultWhichShouldThrow&&firstSingleResultWhichShouldThrow.error)throw firstSingleResultWhichShouldThrow.error;return optimisticResult}({queries:selectedCalendars.filter((id=>calendars.find((c=>c.id===id)))).map((calendarId=>{const calendar=calendars.find((c=>c.id===calendarId));return{queryKey:["calendarEvents",calendarId,timeMin,timeMax],enabled,initialData:[],refetchInterval:6e4,refetchIntervalInBackground:!0,queryFn:async()=>((await calendarApi.getEvents(calendarId,{calendarId,timeMin,timeMax,showDeleted:!1,singleEvents:!0,maxResults:100,orderBy:"startTime",timeZone})).items||[]).map((event=>{var _event_attendees_find,_event_attendees;const responseStatus=null===(_event_attendees=event.attendees)||void 0===_event_attendees||null===(_event_attendees_find=_event_attendees.find((a=>!!a.self)))||void 0===_event_attendees_find?void 0:_event_attendees_find.responseStatus;return{...event,summary:(0,lodash.unescape)(event.summary||""),calendarId,backgroundColor:null==calendar?void 0:calendar.backgroundColor,primary:!!(null==calendar?void 0:calendar.primary),responseStatus}}))}}))}),events=(0,react.useMemo)((()=>(0,lodash.compact)(eventQueries.map((({data})=>data)).flat())),[eventQueries]);return{events,isLoading:!!eventQueries.find((q=>q.isFetching))&&0===events.length}},calendarIcon_namespaceObject=__webpack_require__.p+"static/media/calendarIcon.b666a6e5.svg";var classnames=__webpack_require__("../node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames),hooks=__webpack_require__("../node_modules/material-ui-popup-state/hooks.js"),Link=__webpack_require__("../packages/core-components/src/components/Link/Link.tsx"),makeStyles=__webpack_require__("../node_modules/@material-ui/core/esm/styles/makeStyles.js"),Paper=__webpack_require__("../node_modules/@material-ui/core/esm/Paper/Paper.js"),Tooltip=__webpack_require__("../node_modules/@material-ui/core/esm/Tooltip/Tooltip.js"),Popover=__webpack_require__("../node_modules/@material-ui/core/esm/Popover/Popover.js");const zoomIcon_namespaceObject=__webpack_require__.p+"static/media/zoomIcon.748bc7a7.svg";var ResponseStatus,purify=__webpack_require__("../node_modules/dompurify/dist/purify.js"),purify_default=__webpack_require__.n(purify),Divider=__webpack_require__("../node_modules/@material-ui/core/esm/Divider/Divider.js"),ArrowForward=__webpack_require__("../node_modules/@material-ui/icons/ArrowForward.js"),Badge=__webpack_require__("../node_modules/@material-ui/core/esm/Badge/Badge.js"),Chip=__webpack_require__("../node_modules/@material-ui/core/esm/Chip/Chip.js"),Cancel=__webpack_require__("../node_modules/@material-ui/icons/Cancel.js"),CheckCircle=__webpack_require__("../node_modules/@material-ui/icons/CheckCircle.js");!function(ResponseStatus){ResponseStatus.needsAction="needsAction",ResponseStatus.accepted="accepted",ResponseStatus.declined="declined",ResponseStatus.maybe="tentative"}(ResponseStatus||(ResponseStatus={}));const useStyles=(0,makeStyles.A)((theme=>({responseStatus:{color:({responseStatus})=>(responseStatus=>responseStatus?{[ResponseStatus.accepted]:theme.palette.status.ok,[ResponseStatus.declined]:theme.palette.status.error}[responseStatus]:theme.palette.primary.light)(responseStatus)},badge:{right:10,top:5,"& svg":{height:16,width:16,background:theme.palette.common.white}}}))),ResponseIcon=({responseStatus})=>responseStatus===ResponseStatus.accepted?(0,jsx_runtime.jsx)(CheckCircle.A,{"data-testid":"accepted-icon"}):responseStatus===ResponseStatus.declined?(0,jsx_runtime.jsx)(Cancel.A,{"data-testid":"declined-icon"}):null,AttendeeChip=({user})=>{const classes=useStyles({responseStatus:user.responseStatus});return(0,jsx_runtime.jsx)(Badge.A,{classes:{root:classes.responseStatus,badge:classes.badge},badgeContent:(0,jsx_runtime.jsx)(ResponseIcon,{responseStatus:user.responseStatus}),children:(0,jsx_runtime.jsx)(Chip.A,{size:"small",variant:"outlined",label:user.email,color:"primary"})})};try{AttendeeChip.displayName="AttendeeChip",AttendeeChip.__docgenInfo={description:"",displayName:"AttendeeChip",props:{user:{defaultValue:null,description:"",name:"user",required:!0,type:{name:"EventAttendee"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../plugins/gcalendar/src/components/CalendarCard/AttendeeChip.tsx#AttendeeChip"]={docgenInfo:AttendeeChip.__docgenInfo,name:"AttendeeChip",path:"../plugins/gcalendar/src/components/CalendarCard/AttendeeChip.tsx#AttendeeChip"})}catch(__react_docgen_typescript_loader_error){}function getZoomLink(event){var _event_conferenceData_entryPoints,_event_conferenceData;const videoEntrypoint=null===(_event_conferenceData=event.conferenceData)||void 0===_event_conferenceData||null===(_event_conferenceData_entryPoints=_event_conferenceData.entryPoints)||void 0===_event_conferenceData_entryPoints?void 0:_event_conferenceData_entryPoints.find((e=>"video"===e.entryPointType));var _videoEntrypoint_uri;return null!==(_videoEntrypoint_uri=null==videoEntrypoint?void 0:videoEntrypoint.uri)&&void 0!==_videoEntrypoint_uri?_videoEntrypoint_uri:""}function getTimePeriod(event){var _event_start,_event_end;if(isAllDay(event))return function getAllDayTimePeriod(event){var _event_start,_event_start1,_event_end,_event_end1;const format={month:"long",day:"numeric"},startTime=luxon.c9.fromISO((null===(_event_start=event.start)||void 0===_event_start?void 0:_event_start.dateTime)||(null===(_event_start1=event.start)||void 0===_event_start1?void 0:_event_start1.date)||""),endTime=luxon.c9.fromISO((null===(_event_end=event.end)||void 0===_event_end?void 0:_event_end.dateTime)||(null===(_event_end1=event.end)||void 0===_event_end1?void 0:_event_end1.date)||"").minus({day:1});if(startTime.toISO()===endTime.toISO())return startTime.toLocaleString(format);return`${startTime.toLocaleString(format)} - ${endTime.toLocaleString(format)}`}(event);const format={hour:"2-digit",minute:"2-digit"},startTime=luxon.c9.fromISO((null===(_event_start=event.start)||void 0===_event_start?void 0:_event_start.dateTime)||""),endTime=luxon.c9.fromISO((null===(_event_end=event.end)||void 0===_event_end?void 0:_event_end.dateTime)||"");return`${startTime.toLocaleString(format)} - ${endTime.toLocaleString(format)}`}function isPassed(event){var _event_end,_event_end1,_event_end2,_event_end3;if(!(null===(_event_end=event.end)||void 0===_event_end?void 0:_event_end.dateTime)&&!(null===(_event_end1=event.end)||void 0===_event_end1?void 0:_event_end1.date))return!1;const eventDate=luxon.c9.fromISO((null===(_event_end2=event.end)||void 0===_event_end2?void 0:_event_end2.dateTime)||(null===(_event_end3=event.end)||void 0===_event_end3?void 0:_event_end3.date));return luxon.c9.now()>=eventDate}function isAllDay(event){var _event_start,_event_end,_event_start1,_event_end1;if((null===(_event_start=event.start)||void 0===_event_start?void 0:_event_start.date)||(null===(_event_end=event.end)||void 0===_event_end?void 0:_event_end.date))return!0;const startTime=luxon.c9.fromISO((null===(_event_start1=event.start)||void 0===_event_start1?void 0:_event_start1.dateTime)||"");return luxon.c9.fromISO((null===(_event_end1=event.end)||void 0===_event_end1?void 0:_event_end1.dateTime)||"").diff(startTime,"day").days>=1}function getStartDate(event){var _event_start,_event_start1;return luxon.c9.fromISO((null===(_event_start=event.start)||void 0===_event_start?void 0:_event_start.dateTime)||(null===(_event_start1=event.start)||void 0===_event_start1?void 0:_event_start1.date)||"")}const CalendarEventPopoverContent_useStyles=(0,makeStyles.A)((theme=>({description:{wordBreak:"break-word","& a":{color:theme.palette.primary.main,fontWeight:500}},divider:{marginTop:theme.spacing(2),marginBottom:theme.spacing(2)}})),{name:"GCalendarEventPopoverContent"}),CalendarEventPopoverContent=({event})=>{const classes=CalendarEventPopoverContent_useStyles({event}),analytics=(0,useAnalytics.s)(),zoomLink=getZoomLink(event);return(0,jsx_runtime.jsxs)(Box.A,{display:"flex",flexDirection:"column",width:400,p:2,children:[(0,jsx_runtime.jsxs)(Box.A,{display:"flex",alignItems:"center",children:[(0,jsx_runtime.jsxs)(Box.A,{flex:1,children:[(0,jsx_runtime.jsx)(Typography.A,{variant:"h6",children:event.summary}),(0,jsx_runtime.jsx)(Typography.A,{variant:"subtitle2",children:getTimePeriod(event)})]}),event.htmlLink&&(0,jsx_runtime.jsx)(Tooltip.Ay,{title:"Open in Calendar",children:(0,jsx_runtime.jsx)(Link.N_,{"data-testid":"open-calendar-link",to:event.htmlLink,onClick:_e=>analytics.captureEvent("click","open in calendar"),noTrack:!0,children:(0,jsx_runtime.jsx)(IconButton.A,{children:(0,jsx_runtime.jsx)(ArrowForward.A,{})})})})]}),zoomLink&&(0,jsx_runtime.jsx)(Link.N_,{to:zoomLink,onClick:_e=>analytics.captureEvent("click","zoom link"),noTrack:!0,children:"Join Zoom Meeting"}),event.description&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(Divider.A,{className:classes.divider,variant:"fullWidth"}),(0,jsx_runtime.jsx)(Box.A,{className:classes.description,dangerouslySetInnerHTML:{__html:purify_default().sanitize(event.description,{USE_PROFILES:{html:!0}})}})]}),event.attendees&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(Divider.A,{className:classes.divider,variant:"fullWidth"}),(0,jsx_runtime.jsxs)(Box.A,{children:[(0,jsx_runtime.jsx)(Typography.A,{variant:"subtitle2",children:"Attendees"}),(0,jsx_runtime.jsx)(Box.A,{mb:1}),(0,lodash.sortBy)(event.attendees||[],"email").map((user=>(0,jsx_runtime.jsx)(AttendeeChip,{user},user.email)))]})]})]})};try{CalendarEventPopoverContent.displayName="CalendarEventPopoverContent",CalendarEventPopoverContent.__docgenInfo={description:"",displayName:"CalendarEventPopoverContent",props:{event:{defaultValue:null,description:"",name:"event",required:!0,type:{name:"GCalendarEvent"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../plugins/gcalendar/src/components/CalendarCard/CalendarEventPopoverContent.tsx#CalendarEventPopoverContent"]={docgenInfo:CalendarEventPopoverContent.__docgenInfo,name:"CalendarEventPopoverContent",path:"../plugins/gcalendar/src/components/CalendarCard/CalendarEventPopoverContent.tsx#CalendarEventPopoverContent"})}catch(__react_docgen_typescript_loader_error){}const CalendarEvent_useStyles=(0,makeStyles.A)((theme=>({event:{display:"flex",alignItems:"center",marginBottom:theme.spacing(1),cursor:"pointer",paddingRight:12},declined:{textDecoration:"line-through"},passed:{opacity:.6,transition:"opacity 0.15s ease-in-out","&:hover":{opacity:1}},link:{width:48,height:48,display:"inline-block",padding:8,borderRadius:"50%","&:hover":{backgroundColor:theme.palette.grey[100]}},calendarColor:({event})=>({width:8,borderTopLeftRadius:4,borderBottomLeftRadius:4,backgroundColor:event.primary?theme.palette.primary.light:event.backgroundColor})})),{name:"GCalendarEvent"}),CalendarEvent=({event})=>{const classes=CalendarEvent_useStyles({event}),popoverState=(0,hooks.T6)({variant:"popover",popupId:event.id,disableAutoFocus:!0}),[hovered,setHovered]=(0,react.useState)(!1),analytics=(0,useAnalytics.s)(),zoomLink=getZoomLink(event),{onClick,...restBindProps}=(0,hooks.cO)(popoverState);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)(Paper.A,{onClick:e=>{onClick(e),analytics.captureEvent("click","event info")},...restBindProps,onMouseEnter:()=>setHovered(!0),onMouseLeave:()=>setHovered(!1),elevation:hovered?4:1,className:classnames_default()(classes.event,{[classes.passed]:isPassed(event)}),"data-testid":"calendar-event",children:[(0,jsx_runtime.jsx)(Box.A,{className:classes.calendarColor,mr:1,alignSelf:"stretch"}),(0,jsx_runtime.jsxs)(Box.A,{flex:1,pt:1,pb:1,children:[(0,jsx_runtime.jsx)(Typography.A,{variant:"subtitle2",className:classnames_default()({[classes.declined]:event.responseStatus===ResponseStatus.declined}),children:event.summary}),!isAllDay(event)&&(0,jsx_runtime.jsx)(Typography.A,{variant:"body2","data-testid":"calendar-event-time",children:getTimePeriod(event)})]}),zoomLink&&(0,jsx_runtime.jsx)(Tooltip.Ay,{title:"Join Zoom Meeting",children:(0,jsx_runtime.jsx)(Link.N_,{"data-testid":"calendar-event-zoom-link",className:classes.link,to:zoomLink,onClick:e=>{e.stopPropagation(),analytics.captureEvent("click","zoom link")},noTrack:!0,children:(0,jsx_runtime.jsx)("img",{src:zoomIcon_namespaceObject,alt:"Zoom link"})})})]}),(0,jsx_runtime.jsx)(Popover.Ay,{...(0,hooks.dB)(popoverState),anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"center"},"data-testid":"calendar-event-popover",children:(0,jsx_runtime.jsx)(CalendarEventPopoverContent,{event})})]})};try{CalendarEvent.displayName="CalendarEvent",CalendarEvent.__docgenInfo={description:"",displayName:"CalendarEvent",props:{event:{defaultValue:null,description:"",name:"event",required:!0,type:{name:"GCalendarEvent"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../plugins/gcalendar/src/components/CalendarCard/CalendarEvent.tsx#CalendarEvent"]={docgenInfo:CalendarEvent.__docgenInfo,name:"CalendarEvent",path:"../plugins/gcalendar/src/components/CalendarCard/CalendarEvent.tsx#CalendarEvent"})}catch(__react_docgen_typescript_loader_error){}var FormControl=__webpack_require__("../node_modules/@material-ui/core/esm/FormControl/FormControl.js"),Select=__webpack_require__("../node_modules/@material-ui/core/esm/Select/Select.js"),Input=__webpack_require__("../node_modules/@material-ui/core/esm/Input/Input.js"),MenuItem=__webpack_require__("../node_modules/@material-ui/core/esm/MenuItem/MenuItem.js"),Checkbox=__webpack_require__("../node_modules/@material-ui/core/esm/Checkbox/Checkbox.js"),ListItemText=__webpack_require__("../node_modules/@material-ui/core/esm/ListItemText/ListItemText.js");const CalendarSelect_useStyles=(0,makeStyles.A)({formControl:{width:120},selectedCalendars:{textOverflow:"ellipsis",overflow:"hidden"}},{name:"GCalendarSelect"}),CalendarSelect=({disabled,selectedCalendars=[],setSelectedCalendars,calendars})=>{const classes=CalendarSelect_useStyles();return(0,jsx_runtime.jsx)(FormControl.A,{className:classes.formControl,children:(0,jsx_runtime.jsx)(Select.A,{labelId:"calendars-label",disabled:disabled||0===calendars.length,multiple:!0,value:selectedCalendars,onChange:async e=>setSelectedCalendars(e.target.value),input:(0,jsx_runtime.jsx)(Input.A,{}),renderValue:selected=>(0,jsx_runtime.jsx)(Typography.A,{className:classes.selectedCalendars,variant:"body2",children:calendars.filter((c=>c.id&&selected.includes(c.id))).map((c=>c.summary)).join(", ")}),MenuProps:{PaperProps:{style:{width:350}}},children:(0,lodash.sortBy)(calendars,"summary").map((c=>(0,jsx_runtime.jsxs)(MenuItem.A,{value:c.id,children:[(0,jsx_runtime.jsx)(Checkbox.A,{checked:selectedCalendars.includes(c.id)}),(0,jsx_runtime.jsx)(ListItemText.A,{primary:c.summary})]},c.id)))})})};try{CalendarSelect.displayName="CalendarSelect",CalendarSelect.__docgenInfo={description:"",displayName:"CalendarSelect",props:{disabled:{defaultValue:null,description:"",name:"disabled",required:!0,type:{name:"boolean"}},selectedCalendars:{defaultValue:{value:"[]"},description:"",name:"selectedCalendars",required:!1,type:{name:"string[]"}},setSelectedCalendars:{defaultValue:null,description:"",name:"setSelectedCalendars",required:!0,type:{name:"(value: string[]) => void"}},calendars:{defaultValue:null,description:"",name:"calendars",required:!0,type:{name:"CalendarListEntry[]"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../plugins/gcalendar/src/components/CalendarCard/CalendarSelect.tsx#CalendarSelect"]={docgenInfo:CalendarSelect.__docgenInfo,name:"CalendarSelect",path:"../plugins/gcalendar/src/components/CalendarCard/CalendarSelect.tsx#CalendarSelect"})}catch(__react_docgen_typescript_loader_error){}var styled=__webpack_require__("../node_modules/@material-ui/core/esm/styles/styled.js"),Button=__webpack_require__("../node_modules/@material-ui/core/esm/Button/Button.js");const eventsMock=[{id:"1",htmlLink:"https://www.google.com/calendar/",summary:"Backstage Community Sessions",start:{dateTime:"2021-12-07T09:00:00+01:00",timeZone:"Europe/London"},end:{dateTime:"2021-12-07T10:00:00+01:00",timeZone:"Europe/London"}},{id:"2",htmlLink:"https://www.google.com/calendar/",summary:"Backstage Community Sessions",start:{dateTime:"2021-12-07T10:30:00+01:00",timeZone:"Europe/London"},end:{dateTime:"2021-12-07T10:45:00+01:00",timeZone:"Europe/London"},conferenceData:{entryPoints:[{entryPointType:"video",uri:"https://zoom.us"}]}},{id:"3",htmlLink:"https://www.google.com/calendar",summary:"Backstage Community Sessions",start:{dateTime:"2021-12-07T12:00:00+01:00",timeZone:"Europe/London"},end:{dateTime:"2021-12-07T13:00:00+01:00",timeZone:"Europe/London"},conferenceData:{entryPoints:[{entryPointType:"video",uri:"https://zoom.us",label:"zoom.us"}]}},{id:"4",htmlLink:"https://www.google.com/calendar",summary:"Backstage Community Sessions",start:{dateTime:"2021-12-07T15:00:00+01:00",timeZone:"Europe/London"},end:{dateTime:"2021-12-07T16:30:00+01:00",timeZone:"Europe/London"},conferenceData:{entryPoints:[{entryPointType:"video",uri:"https://zoom.us"}]}},{id:"5",htmlLink:"https://www.google.com/calendar",summary:"Backstage Community Sessions",start:{dateTime:"2021-12-07T17:00:00+01:00",timeZone:"Europe/London"},end:{dateTime:"2021-12-07T17:30:00+01:00",timeZone:"Europe/London"},conferenceData:{entryPoints:[{entryPointType:"video",uri:"https://zoom.us"}]}}],TransparentBox=(0,styled.A)(Box.A)({opacity:.3,filter:"blur(1.5px)"}),SignInContent=({handleAuthClick,events=eventsMock})=>(0,jsx_runtime.jsxs)(Box.A,{position:"relative",height:"100%",width:"100%",children:[(0,jsx_runtime.jsx)(TransparentBox,{p:1,children:events.map((event=>(0,jsx_runtime.jsx)(CalendarEvent,{event},event.id)))}),(0,jsx_runtime.jsx)(Box.A,{height:"100%",width:"100%",display:"flex",justifyContent:"center",alignItems:"center",position:"absolute",left:0,top:0,children:(0,jsx_runtime.jsx)(Button.A,{variant:"contained",color:"primary",onClick:handleAuthClick,size:"large",children:"Sign in"})})]});try{SignInContent.displayName="SignInContent",SignInContent.__docgenInfo={description:"",displayName:"SignInContent",props:{handleAuthClick:{defaultValue:null,description:"",name:"handleAuthClick",required:!0,type:{name:"React.MouseEventHandler<HTMLElement>"}},events:{defaultValue:{value:"[\n  {\n    id: '1',\n    htmlLink: 'https://www.google.com/calendar/',\n    summary: 'Backstage Community Sessions',\n    start: {\n      dateTime: '2021-12-07T09:00:00+01:00',\n      timeZone: 'Europe/London',\n    },\n    end: {\n      dateTime: '2021-12-07T10:00:00+01:00',\n      timeZone: 'Europe/London',\n    },\n  },\n  {\n    id: '2',\n    htmlLink: 'https://www.google.com/calendar/',\n    summary: 'Backstage Community Sessions',\n    start: {\n      dateTime: '2021-12-07T10:30:00+01:00',\n      timeZone: 'Europe/London',\n    },\n    end: {\n      dateTime: '2021-12-07T10:45:00+01:00',\n      timeZone: 'Europe/London',\n    },\n    conferenceData: {\n      entryPoints: [\n        {\n          entryPointType: 'video',\n          uri: 'https://zoom.us',\n        },\n      ],\n    },\n  },\n  {\n    id: '3',\n    htmlLink: 'https://www.google.com/calendar',\n    summary: 'Backstage Community Sessions',\n    start: {\n      dateTime: '2021-12-07T12:00:00+01:00',\n      timeZone: 'Europe/London',\n    },\n    end: {\n      dateTime: '2021-12-07T13:00:00+01:00',\n      timeZone: 'Europe/London',\n    },\n    conferenceData: {\n      entryPoints: [\n        {\n          entryPointType: 'video',\n          uri: 'https://zoom.us',\n          label: 'zoom.us',\n        },\n      ],\n    },\n  },\n  {\n    id: '4',\n    htmlLink: 'https://www.google.com/calendar',\n    summary: 'Backstage Community Sessions',\n    start: {\n      dateTime: '2021-12-07T15:00:00+01:00',\n      timeZone: 'Europe/London',\n    },\n    end: {\n      dateTime: '2021-12-07T16:30:00+01:00',\n      timeZone: 'Europe/London',\n    },\n    conferenceData: {\n      entryPoints: [\n        {\n          entryPointType: 'video',\n          uri: 'https://zoom.us',\n        },\n      ],\n    },\n  },\n  {\n    id: '5',\n    htmlLink: 'https://www.google.com/calendar',\n    summary: 'Backstage Community Sessions',\n    start: {\n      dateTime: '2021-12-07T17:00:00+01:00',\n      timeZone: 'Europe/London',\n    },\n    end: {\n      dateTime: '2021-12-07T17:30:00+01:00',\n      timeZone: 'Europe/London',\n    },\n    conferenceData: {\n      entryPoints: [\n        {\n          entryPointType: 'video',\n          uri: 'https://zoom.us',\n        },\n      ],\n    },\n  },\n]"},description:"",name:"events",required:!1,type:{name:"GCalendarEvent[]"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../plugins/gcalendar/src/components/CalendarCard/SignInContent.tsx#SignInContent"]={docgenInfo:SignInContent.__docgenInfo,name:"SignInContent",path:"../plugins/gcalendar/src/components/CalendarCard/SignInContent.tsx#SignInContent"})}catch(__react_docgen_typescript_loader_error){}var useAsync=__webpack_require__("../node_modules/react-use/lib/useAsync.js");const CalendarCard=()=>{var _calendars_find;const[date,setDate]=(0,react.useState)(luxon.c9.now()),analytics=(0,useAnalytics.s)(),changeDay=(offset=1)=>{setDate((prev=>prev.plus({day:offset}))),analytics.captureEvent("click","change date")},{isSignedIn,isInitialized,signIn}=(()=>{const[isSignedIn,setSignedIn]=(0,react.useState)(!1),[isInitialized,setInitialized]=(0,react.useState)(!1),authApi=(0,useApi.gf)(auth.Vk);return{isSignedIn,isInitialized,signIn:(0,react.useCallback)((async(optional=!1)=>{const token=await authApi.getAccessToken(["https://www.googleapis.com/auth/calendar.readonly","https://www.googleapis.com/auth/userinfo.email"],{optional,instantPopup:!optional});setSignedIn(!!token),setInitialized(!0)}),[authApi,setSignedIn])}})();(0,useAsync.A)((async()=>signIn(!0)),[signIn]);const{isLoading:isCalendarLoading,isFetching:isCalendarFetching,data:calendars=[]}=(({enabled})=>{const calendarApi=(0,useApi.gf)(client.d),errorApi=(0,useApi.gf)(ErrorApi.m);return(0,useQuery.I)(["calendars"],(async()=>{const calendars=[];let token="";do{const{nextPageToken="",items=[]}=await calendarApi.getCalendars({maxResults:100,minAccessRole:"reader",pageToken:token});token=nextPageToken,calendars.push(...items)}while(token);return calendars}),{enabled,keepPreviousData:!0,refetchInterval:36e5,onError:()=>{errorApi.post({name:"API error",message:"Failed to fetch calendars."})}})})({enabled:isSignedIn}),primaryCalendarId=null===(_calendars_find=calendars.find((c=>!0===c.primary)))||void 0===_calendars_find?void 0:_calendars_find.id,defaultSelectedCalendars=primaryCalendarId?[primaryCalendarId]:[],[storedCalendars,setStoredCalendars]=function useStoredCalendars(defaultValue){const storageBucket=src_plugin.z.getId(),storageKey="google_calendars_selected",storageApi=(0,useApi.gf)(StorageApi.F).forBucket(storageBucket),snapshot=(0,useObservable.A)(storageApi.observe$(storageKey),storageApi.snapshot(storageKey));let result;return result="absent"===snapshot.presence?defaultValue:snapshot.value,[result,value=>{storageApi.set(storageKey,value)}]}(defaultSelectedCalendars);var _date_zoneName;const{events,isLoading:isEventLoading}=useEventsQuery({calendars,selectedCalendars:storedCalendars,enabled:isSignedIn&&calendars.length>0,timeMin:date.startOf("day").toISO(),timeMax:date.endOf("day").toISO(),timeZone:null!==(_date_zoneName=date.zoneName)&&void 0!==_date_zoneName?_date_zoneName:"UTC"}),showLoader=isCalendarLoading&&isCalendarFetching||isEventLoading||!isInitialized;return(0,jsx_runtime.jsx)(InfoCard.n,{noPadding:!0,title:(0,jsx_runtime.jsxs)(Box.A,{display:"flex",alignItems:"center",children:[(0,jsx_runtime.jsx)(Box.A,{height:24,width:24,mr:1,children:(0,jsx_runtime.jsx)("img",{src:calendarIcon_namespaceObject,alt:"Google Calendar"})}),isSignedIn?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(IconButton.A,{onClick:()=>changeDay(-1),size:"small",children:(0,jsx_runtime.jsx)(NavigateBefore.A,{})}),(0,jsx_runtime.jsx)(IconButton.A,{onClick:()=>changeDay(1),size:"small",children:(0,jsx_runtime.jsx)(NavigateNext.A,{})}),(0,jsx_runtime.jsx)(Box.A,{mr:.5}),(0,jsx_runtime.jsx)(Typography.A,{variant:"h6",children:date.toLocaleString({weekday:"short",month:"short",day:"numeric"})}),(0,jsx_runtime.jsx)(Box.A,{flex:1}),(0,jsx_runtime.jsx)(CalendarSelect,{calendars,selectedCalendars:storedCalendars,setSelectedCalendars:setStoredCalendars,disabled:isCalendarFetching&&isCalendarLoading||!isSignedIn})]}):(0,jsx_runtime.jsx)(Typography.A,{variant:"h6",children:"Agenda"})]}),deepLink:{link:"https://calendar.google.com/",title:"Go to Calendar"},children:(0,jsx_runtime.jsxs)(Box.A,{children:[showLoader&&(0,jsx_runtime.jsx)(Box.A,{py:2,children:(0,jsx_runtime.jsx)(Progress.k,{variant:"query"})}),!isSignedIn&&isInitialized&&(0,jsx_runtime.jsx)(SignInContent,{handleAuthClick:()=>signIn(!1)}),!isEventLoading&&!isCalendarLoading&&isSignedIn&&(0,jsx_runtime.jsxs)(Box.A,{p:1,pb:0,maxHeight:602,overflow:"auto",children:[0===events.length&&(0,jsx_runtime.jsx)(Box.A,{pt:2,pb:2,children:(0,jsx_runtime.jsx)(Typography.A,{align:"center",variant:"h6",children:"No events"})}),(0,lodash.sortBy)(events,[getStartDate]).map((event=>(0,jsx_runtime.jsx)(CalendarEvent,{event},`${event.calendarId}-${event.id}`)))]})]})})},HomePageCalendar_queryClient=new queryClient.E,HomePageCalendar=()=>(0,jsx_runtime.jsx)(QueryClientProvider.Ht,{client:HomePageCalendar_queryClient,children:(0,jsx_runtime.jsx)(CalendarCard,{})})}}]);